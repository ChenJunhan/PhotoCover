var MouseType;
(function (MouseType) {
    MouseType[MouseType["PEN"] = 0] = "PEN";
    MouseType[MouseType["ERASER"] = 1] = "ERASER";
})(MouseType || (MouseType = {}));
var PhotoCover = (function () {
    function PhotoCover(selector) {
        this.isMobile = navigator.userAgent.indexOf('iPhone') > -1 || navigator.userAgent.indexOf('Android') > -1;
        // cache window, document and body for speed up performance
        this.win = window;
        this.doc = document;
        this.body = document.body;
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');
        // init value
        this.mouseType = MouseType.PEN; // default mouse pointer
        this.radius = PhotoCover.DEFAULT_RADIUS; // default radius of pen
        this.maxWidth = PhotoCover.DEFAULT_MAX_WIDTH; // default max width of image
        this.color = PhotoCover.DEFAULT_COLOR; // default color of canvas
        this.lineCap = PhotoCover.DEFAULT_LINECAP; // default linecap of line on canvas
        this.lineJoin = PhotoCover.DEFAULT_LINEJOIN; // default lineJoin of line on canvas
        this.histories = []; // operate history
        this.bindedEvents = []; // registered events [node, type, function]
        if (typeof selector === 'object') {
            this.img = selector;
        }
        else if (typeof selector === 'string') {
            this.img = document.querySelector(selector);
        }
        // initial canvas and its size and position
        this.canvas.width = this.img.width;
        this.canvas.height = this.img.height;
        this.init();
    }
    PhotoCover.prototype.init = function () {
        var _this = this;
        var _a = [this.body, this.win], body = _a[0], win = _a[1];
        this.async();
        body.appendChild(this.canvas);
        if (!this.isMobile) {
            this.initMouse();
        }
        // async canvas position and size during browser resize
        var resize = (function () {
            _this.async();
        }).bind(this);
        win.addEventListener('resize', resize, false);
        this.bindedEvents.push([win, 'resize', resize]);
        var currentOperate = [];
        var canvasMouseDown = (function (e) {
            e.preventDefault();
            var _a = _this.getCoordinateByEvent(e), x = _a[0], y = _a[1];
            currentOperate = [];
            if (_this.isOnCanvas(e.pageX, e.pageY)) {
                _this.ctx.beginPath();
                currentOperate.push(['MOVE_TO', x, y]);
                currentOperate.push(_this.drawByEvent(e));
                _this.ctx.beginPath();
                currentOperate.push(['MOVE_TO', x, y]);
                if (!_this.isMobile) {
                    win.addEventListener('mousemove', canvasMouseMove, false);
                }
                else {
                    win.addEventListener('touchmove', canvasMouseMove, false);
                }
            }
        }).bind(this);
        var canvasMouseMove = (function (e) {
            e.preventDefault();
            currentOperate.push(_this.drawByEvent(e));
        }).bind(this);
        var canvasMouseUp = (function (e) {
            e.preventDefault();
            if (!_this.isMobile) {
                win.removeEventListener('mousemove', canvasMouseMove, false);
            }
            else {
                win.removeEventListener('touchmove', canvasMouseMove, false);
            }
            var _a = [e.pageX, e.pageY], x = _a[0], y = _a[1];
            if (_this.isOnCanvas(x, y)) {
                _this.histories.push(currentOperate);
                currentOperate = [];
            }
        }).bind(this);
        // canvas down
        if (!this.isMobile) {
            win.addEventListener('mousedown', canvasMouseDown, false);
            this.bindedEvents.push([win, 'mousedown', canvasMouseDown]);
            win.addEventListener('mouseup', canvasMouseUp, false);
            this.bindedEvents.push([win, 'mouseup', canvasMouseUp]);
        }
        else {
            win.addEventListener('touchstart', canvasMouseDown, false);
            this.bindedEvents.push([win, 'touchstart', canvasMouseDown]);
            win.addEventListener('touchend', canvasMouseUp, false);
            this.bindedEvents.push([win, 'touchend', canvasMouseUp]);
        }
    };
    // async x and y from image to canvas
    PhotoCover.prototype.async = function () {
        this.canvas.style.cssText = "\n      position: absolute;\n      left: " + this.img.offsetLeft + "px;\n      top: " + this.img.offsetTop + "px;\n      use-select: none;\n    ";
    };
    // initial mouse shape where mouse on canvas
    PhotoCover.prototype.initMouse = function () {
        var _this = this;
        var _a = [this.body, this.win], body = _a[0], win = _a[1];
        var mouse = document.createElement('div');
        mouse.style.cssText = "\n      display: none;\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 10001;\n      width: " + this.radius * 2 + "px;\n      height: " + this.radius * 2 + "px;\n      border: 1px solid red;\n      border-radius: 100%;\n    ";
        this.mouse = mouse;
        body.appendChild(mouse);
        var mouseMove = (function (e) {
            var _a = [e.pageX, e.pageY], x = _a[0], y = _a[1];
            var isOnCanvas = _this.isOnCanvas(x, y);
            mouse.style.transform = "translate(" + (x - _this.radius - 1) + "px, " + (y - _this.radius - 1) + "px)"; // minus border width of mouse type
            if (!isOnCanvas) {
                mouse.style.display = 'none';
                body.style.cursor = 'default';
            }
            else {
                mouse.style.display = 'block';
                body.style.cursor = 'none';
            }
        }).bind(this);
        // change mouse style
        if (!this.isMobile) {
            win.addEventListener('mousemove', mouseMove, false);
            this.bindedEvents.push([win, 'mousemove', mouseMove]);
        }
        else {
            win.addEventListener('touchmove', mouseMove, false);
            this.bindedEvents.push([win, 'touchmove', mouseMove]);
        }
    };
    PhotoCover.prototype.setRadius = function (radius) {
        if (radius < 2 || radius > 100) {
            return;
        }
        this.radius = radius;
        var mouse = this.mouse;
        if (mouse) {
            mouse.style.width = radius * 2 + 'px';
            mouse.style.height = radius * 2 + 'px';
        }
    };
    PhotoCover.prototype.zoomIn = function (radius) {
        if (radius === void 0) { radius = 2; }
        this.setRadius(this.radius + radius);
    };
    PhotoCover.prototype.zoomOut = function (radius) {
        if (radius === void 0) { radius = 2; }
        this.setRadius(this.radius - radius);
    };
    PhotoCover.prototype.lineTo = function (x, y) {
        var ctx = this.ctx;
        ctx.lineCap = this.lineCap;
        ctx.lineJoin = 'round';
        ctx.strokeStyle = this.color;
        ctx.lineWidth = this.radius * 2;
        ctx.lineTo(x, y);
        ctx.stroke();
    };
    PhotoCover.prototype.drawCircle = function (x, y, radius) {
        var ctx = this.ctx;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(x + 1, y + 1, radius || this.radius, 0, 360);
        ctx.fill();
        ctx.closePath();
        return [MouseType.PEN, this.color, x, y, this.radius];
    };
    PhotoCover.prototype.drawLine = function (x, y) {
        this.ctx.globalCompositeOperation = 'source-over';
        this.lineCap = 'round';
        this.lineJoin = 'round';
        this.lineTo(x, y);
        return [MouseType.PEN, this.color, x, y, this.radius];
    };
    PhotoCover.prototype.erase = function (x, y) {
        this.ctx.globalCompositeOperation = 'destination-out';
        this.lineCap = 'round';
        this.lineJoin = 'round';
        this.lineTo(x, y);
        return [MouseType.ERASER, x, y, this.radius];
    };
    PhotoCover.prototype.drawByEvent = function (event) {
        var _a = this.getCoordinateByEvent(event), x = _a[0], y = _a[1];
        if (this.mouseType === MouseType.PEN) {
            return this.drawLine(x, y);
        }
        else if (this.mouseType === MouseType.ERASER) {
            return this.erase(x, y);
        }
        else {
            return [];
        }
    };
    PhotoCover.prototype.getCoordinateByEvent = function (event) {
        var x, y;
        if (this.isMobile) {
            event = event.changedTouches[0];
        }
        x = event.pageX - this.canvas.offsetLeft;
        y = event.pageY - this.canvas.offsetTop;
        return [x, y];
    };
    PhotoCover.prototype.isOnCanvas = function (pageX, pageY) {
        if (pageX < this.img.offsetLeft ||
            pageX > (this.img.offsetLeft + this.img.width) ||
            pageY < this.img.offsetTop ||
            pageY > (this.img.offsetTop + this.img.height)) {
            return false;
        }
        return true;
    };
    PhotoCover.prototype.setMaxWidth = function (width) {
        this.maxWidth = width;
    };
    PhotoCover.prototype.setColor = function (color) {
        this.color = color;
    };
    /**
     * set tool as mouse type
     * @param tool MouseType
     */
    PhotoCover.prototype.setTool = function (tool) {
        this.mouseType = tool;
        if (tool === MouseType.PEN) {
            this.setPen();
        }
        else if (tool === MouseType.ERASER) {
            this.setEraser();
        }
    };
    PhotoCover.prototype.setPen = function () {
        if (this.mouse) {
            Object.assign(this.mouse.style, {
                borderRadius: '100%',
                border: "1px solid " + PhotoCover.DEFAULT_PEN_BORDER_COLOR
            });
        }
        this.mouseType = MouseType.PEN;
    };
    PhotoCover.prototype.setEraser = function () {
        if (this.mouse) {
            Object.assign(this.mouse.style, {
                borderRadius: '100%',
                border: "1px dashed " + PhotoCover.DEFAULT_ERASER_BORDER_COLOR
            });
        }
        this.mouseType = MouseType.ERASER;
    };
    PhotoCover.prototype.undo = function () {
        var _this = this;
        var ctx = this.ctx;
        var color = this.color;
        ctx.save();
        ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.histories.pop();
        this.histories.map(function (steps) {
            steps.map(function (step) {
                if (step[0] === MouseType.PEN) {
                    _this.color = step[1];
                    _this.setRadius(step[4]);
                    _this.drawLine(step[2], step[3]);
                }
                else if (step[0] === MouseType.ERASER) {
                    _this.setRadius(step[3]);
                    _this.erase(step[1], step[2]);
                }
                else if (step[0] === 'MOVE_TO') {
                    ctx.beginPath();
                    ctx.moveTo.apply(ctx, step.slice(1));
                }
            });
        });
        this.color = color;
        ctx.restore();
    };
    /**
     * get image origin size
     * @param  {String}   src      iamge source url
     * @param  {Function} callback callback function, width as first parameter and height as second
     * @return {undefined}
     */
    PhotoCover.prototype.getImageOriginSize = function (src, callback) {
        var img = new Image();
        img.onload = function () {
            var width = img.width;
            var height = img.height;
            callback && callback(width, height);
        };
        img.src = src;
    };
    PhotoCover.prototype.getDataURL = function (type, quality, callback) {
        var _this = this;
        if (type === void 0) { type = 'image/jpeg'; }
        if (quality === void 0) { quality = 0.8; }
        var src = this.img.src;
        this.getImageOriginSize(src, function (width, height) {
            var tempCanvas = document.createElement('canvas');
            tempCanvas.width = width;
            tempCanvas.height = height;
            var tempCtx = tempCanvas.getContext('2d');
            if (tempCtx) {
                tempCtx.drawImage(_this.img, 0, 0, width, height);
                tempCtx.drawImage(_this.canvas, 0, 0, width, height);
                callback && callback(tempCanvas.toDataURL(type, quality));
            }
        });
    };
    /**
     * remove dom that added into body,
     * remove all events that registered
     */
    PhotoCover.prototype.destroy = function () {
        this.canvas.parentNode && this.canvas.parentNode.removeChild(this.canvas);
        this.mouse.parentNode && this.mouse.parentNode.removeChild(this.mouse);
        this.img.src = '';
        this.bindedEvents.forEach(function (v) {
            v[0].removeEventListener(v[1], v[2], false);
        });
        // delete this
    };
    PhotoCover.DEFAULT_RADIUS = 20;
    PhotoCover.DEFAULT_MAX_WIDTH = 800;
    PhotoCover.DEFAULT_COLOR = 'black';
    PhotoCover.DEFAULT_PEN_BORDER_COLOR = 'red';
    PhotoCover.DEFAULT_ERASER_BORDER_COLOR = '#666';
    PhotoCover.DEFAULT_LINECAP = 'round';
    PhotoCover.DEFAULT_LINEJOIN = 'round';
    return PhotoCover;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFBO0lBQzFCLDRCQUFpQixHQUFVLEdBQUcsQ0FBQTtJQUM5Qix3QkFBYSxHQUFXLE9BQU8sQ0FBQTtJQUMvQixtQ0FBd0IsR0FBVyxLQUFLLENBQUE7SUFDeEMsc0NBQTJCLEdBQVUsTUFBTSxDQUFBO0lBQzNDLDBCQUFlLEdBQVcsT0FBTyxDQUFBO0lBQ2pDLDJCQUFnQixHQUFXLE9BQU8sQ0FBQTtJQWlZM0MsaUJBQUM7Q0F4WUQsQUF3WUMsSUFBQSIsImZpbGUiOiJwaG90b2NvdmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZW51bSBNb3VzZVR5cGUgeyBQRU4sIEVSQVNFUiB9XHJcblxyXG5jbGFzcyBQaG90b0NvdmVyIHtcclxuICBzdGF0aWMgREVGQVVMVF9SQURJVVM6bnVtYmVyID0gMjBcclxuICBzdGF0aWMgREVGQVVMVF9NQVhfV0lEVEg6bnVtYmVyID0gODAwXHJcbiAgc3RhdGljIERFRkFVTFRfQ09MT1I6IHN0cmluZyA9ICdibGFjaydcclxuICBzdGF0aWMgREVGQVVMVF9QRU5fQk9SREVSX0NPTE9SOiBzdHJpbmcgPSAncmVkJ1xyXG4gIHN0YXRpYyBERUZBVUxUX0VSQVNFUl9CT1JERVJfQ09MT1I6c3RyaW5nID0gJyM2NjYnXHJcbiAgc3RhdGljIERFRkFVTFRfTElORUNBUDogc3RyaW5nID0gJ3JvdW5kJ1xyXG4gIHN0YXRpYyBERUZBVUxUX0xJTkVKT0lOOiBzdHJpbmcgPSAncm91bmQnXHJcblxyXG4gIHJlYWRvbmx5IGlzTW9iaWxlID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdpUGhvbmUnKSA+IC0xIHx8IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQW5kcm9pZCcpID4gLTFcclxuXHJcbiAgLy8gY2FjaGUgd2luZG93LCBkb2N1bWVudCBhbmQgYm9keSBmb3Igc3BlZWQgdXAgcGVyZm9ybWFuY2VcclxuICB3aW46IFdpbmRvdyA9IHdpbmRvd1xyXG4gIGRvYzogSFRNTERvY3VtZW50ID0gZG9jdW1lbnRcclxuICBib2R5OiBIVE1MRWxlbWVudCA9IGRvY3VtZW50LmJvZHlcclxuXHJcbiAgbW91c2U6IEhUTUxEaXZFbGVtZW50ICAgLy8gbW91c2UgcG9pbnRlciBvbiBjYW52YXNcclxuICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcclxuICBpbWc6IEhUTUxJbWFnZUVsZW1lbnQgIC8vIGltYWdlIHRoYXQgeW91IHdhbnQgdG8gY2hhbmdlIFxyXG5cclxuICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJykgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEXHJcblxyXG4gIC8vIGluaXQgdmFsdWVcclxuICBtb3VzZVR5cGU6IE1vdXNlVHlwZSA9IE1vdXNlVHlwZS5QRU4gICAgLy8gZGVmYXVsdCBtb3VzZSBwb2ludGVyXHJcbiAgcmFkaXVzID0gIFBob3RvQ292ZXIuREVGQVVMVF9SQURJVVMgICAgLy8gZGVmYXVsdCByYWRpdXMgb2YgcGVuXHJcbiAgbWF4V2lkdGggPSBQaG90b0NvdmVyLkRFRkFVTFRfTUFYX1dJRFRIICAgICAvLyBkZWZhdWx0IG1heCB3aWR0aCBvZiBpbWFnZVxyXG4gIGNvbG9yID0gUGhvdG9Db3Zlci5ERUZBVUxUX0NPTE9SICAgIC8vIGRlZmF1bHQgY29sb3Igb2YgY2FudmFzXHJcbiAgbGluZUNhcCA9IFBob3RvQ292ZXIuREVGQVVMVF9MSU5FQ0FQICAgIC8vIGRlZmF1bHQgbGluZWNhcCBvZiBsaW5lIG9uIGNhbnZhc1xyXG4gIGxpbmVKb2luID0gUGhvdG9Db3Zlci5ERUZBVUxUX0xJTkVKT0lOIC8vIGRlZmF1bHQgbGluZUpvaW4gb2YgbGluZSBvbiBjYW52YXNcclxuXHJcbiAgaGlzdG9yaWVzOiBhbnlbXVtdID0gW10gICAgLy8gb3BlcmF0ZSBoaXN0b3J5XHJcbiAgYmluZGVkRXZlbnRzOiBhbnlbXVtdID0gW10gICAgLy8gcmVnaXN0ZXJlZCBldmVudHMgW25vZGUsIHR5cGUsIGZ1bmN0aW9uXVxyXG5cclxuICBjb25zdHJ1Y3RvcihzZWxlY3RvcjogSFRNTEltYWdlRWxlbWVudCB8IHN0cmluZykge1xyXG5cclxuICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICdvYmplY3QnKSB7IHRoaXMuaW1nID0gc2VsZWN0b3IgfVxyXG4gICAgZWxzZSBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykgeyB0aGlzLmltZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpIGFzIEhUTUxJbWFnZUVsZW1lbnQgfVxyXG4gICAgXHJcbiAgICAvLyBpbml0aWFsIGNhbnZhcyBhbmQgaXRzIHNpemUgYW5kIHBvc2l0aW9uXHJcbiAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHRoaXMuaW1nLndpZHRoXHJcbiAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB0aGlzLmltZy5oZWlnaHRcclxuXHJcbiAgICB0aGlzLmluaXQoKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0KCk6IHZvaWQge1xyXG5cclxuICAgIGxldCBbYm9keSwgd2luXSA9IFt0aGlzLmJvZHksIHRoaXMud2luXVxyXG5cclxuICAgIHRoaXMuYXN5bmMoKVxyXG4gICAgYm9keS5hcHBlbmRDaGlsZCh0aGlzLmNhbnZhcylcclxuXHJcbiAgICBpZiAoIXRoaXMuaXNNb2JpbGUpIHsgdGhpcy5pbml0TW91c2UoKSB9XHJcblxyXG4gICAgLy8gYXN5bmMgY2FudmFzIHBvc2l0aW9uIGFuZCBzaXplIGR1cmluZyBicm93c2VyIHJlc2l6ZVxyXG4gICAgbGV0IHJlc2l6ZSA9ICgoKSA9PiB7XHJcbiAgICAgIHRoaXMuYXN5bmMoKVxyXG4gICAgfSkuYmluZCh0aGlzKVxyXG4gICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHJlc2l6ZSwgZmFsc2UpXHJcbiAgICB0aGlzLmJpbmRlZEV2ZW50cy5wdXNoKFt3aW4sICdyZXNpemUnLCByZXNpemVdKVxyXG5cclxuXHJcbiAgICBsZXQgY3VycmVudE9wZXJhdGU6IGFueVtdW10gPSBbXVxyXG5cclxuICAgIGxldCBjYW52YXNNb3VzZURvd24gPSAoKGU6IGFueSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcclxuXHJcbiAgICAgIGNvbnN0IFt4LCB5XSA9IHRoaXMuZ2V0Q29vcmRpbmF0ZUJ5RXZlbnQoZSlcclxuXHJcbiAgICAgIGN1cnJlbnRPcGVyYXRlID0gW11cclxuXHJcbiAgICAgIGlmICh0aGlzLmlzT25DYW52YXMoZS5wYWdlWCwgZS5wYWdlWSkpIHtcclxuXHJcbiAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKClcclxuICAgICAgICBjdXJyZW50T3BlcmF0ZS5wdXNoKFsnTU9WRV9UTycsIHgsIHldKVxyXG4gICAgICAgIGN1cnJlbnRPcGVyYXRlLnB1c2godGhpcy5kcmF3QnlFdmVudChlKSlcclxuXHJcbiAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKClcclxuICAgICAgICBjdXJyZW50T3BlcmF0ZS5wdXNoKFsnTU9WRV9UTycsIHgsIHldKVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuaXNNb2JpbGUpIHsgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGNhbnZhc01vdXNlTW92ZSwgZmFsc2UpIH1cclxuICAgICAgICBlbHNlIHsgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGNhbnZhc01vdXNlTW92ZSwgZmFsc2UpIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgIH0pLmJpbmQodGhpcylcclxuXHJcbiAgICBsZXQgY2FudmFzTW91c2VNb3ZlID0gKChlOiBhbnkpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXHJcbiAgICAgIGN1cnJlbnRPcGVyYXRlLnB1c2godGhpcy5kcmF3QnlFdmVudChlKSlcclxuICAgIH0pLmJpbmQodGhpcylcclxuXHJcbiAgICBsZXQgY2FudmFzTW91c2VVcCA9ICgoZTogYW55KSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxyXG5cclxuICAgICAgaWYgKCF0aGlzLmlzTW9iaWxlKSB7IHdpbi5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBjYW52YXNNb3VzZU1vdmUsIGZhbHNlKSB9XHJcbiAgICAgIGVsc2UgeyB3aW4ucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgY2FudmFzTW91c2VNb3ZlLCBmYWxzZSkgfVxyXG4gICAgICBcclxuICAgICAgbGV0IFt4LCB5XSA9IFtlLnBhZ2VYLCBlLnBhZ2VZXVxyXG5cclxuICAgICAgaWYgKHRoaXMuaXNPbkNhbnZhcyh4LCB5KSkge1xyXG4gICAgICAgIHRoaXMuaGlzdG9yaWVzLnB1c2goY3VycmVudE9wZXJhdGUpXHJcbiAgICAgICAgY3VycmVudE9wZXJhdGUgPSBbXVxyXG4gICAgICB9XHJcbiAgICB9KS5iaW5kKHRoaXMpXHJcblxyXG4gICAgLy8gY2FudmFzIGRvd25cclxuICAgIGlmICghdGhpcy5pc01vYmlsZSkge1xyXG4gICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgY2FudmFzTW91c2VEb3duLCBmYWxzZSlcclxuICAgICAgdGhpcy5iaW5kZWRFdmVudHMucHVzaChbd2luLCAnbW91c2Vkb3duJywgY2FudmFzTW91c2VEb3duXSlcclxuXHJcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgY2FudmFzTW91c2VVcCwgZmFsc2UpXHJcbiAgICAgIHRoaXMuYmluZGVkRXZlbnRzLnB1c2goW3dpbiwgJ21vdXNldXAnLCBjYW52YXNNb3VzZVVwXSkgXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGNhbnZhc01vdXNlRG93biwgZmFsc2UpXHJcbiAgICAgIHRoaXMuYmluZGVkRXZlbnRzLnB1c2goW3dpbiwgJ3RvdWNoc3RhcnQnLCBjYW52YXNNb3VzZURvd25dKVxyXG5cclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgY2FudmFzTW91c2VVcCwgZmFsc2UpXHJcbiAgICAgIHRoaXMuYmluZGVkRXZlbnRzLnB1c2goW3dpbiwgJ3RvdWNoZW5kJywgY2FudmFzTW91c2VVcF0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBhc3luYyB4IGFuZCB5IGZyb20gaW1hZ2UgdG8gY2FudmFzXHJcbiAgcHJpdmF0ZSBhc3luYygpIHtcclxuICAgIHRoaXMuY2FudmFzLnN0eWxlLmNzc1RleHQgPSBgXHJcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICAgICAgbGVmdDogJHt0aGlzLmltZy5vZmZzZXRMZWZ0fXB4O1xyXG4gICAgICB0b3A6ICR7dGhpcy5pbWcub2Zmc2V0VG9wfXB4O1xyXG4gICAgICB1c2Utc2VsZWN0OiBub25lO1xyXG4gICAgYFxyXG4gIH1cclxuXHJcbiAgLy8gaW5pdGlhbCBtb3VzZSBzaGFwZSB3aGVyZSBtb3VzZSBvbiBjYW52YXNcclxuICBwcml2YXRlIGluaXRNb3VzZSgpIHtcclxuICAgIGxldCBbYm9keSwgd2luXSA9IFt0aGlzLmJvZHksIHRoaXMud2luXVxyXG4gICAgbGV0IG1vdXNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuICAgIG1vdXNlLnN0eWxlLmNzc1RleHQgPSBgXHJcbiAgICAgIGRpc3BsYXk6IG5vbmU7XHJcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICAgICAgbGVmdDogMDtcclxuICAgICAgdG9wOiAwO1xyXG4gICAgICB6LWluZGV4OiAxMDAwMTtcclxuICAgICAgd2lkdGg6ICR7dGhpcy5yYWRpdXMgKiAyfXB4O1xyXG4gICAgICBoZWlnaHQ6ICR7dGhpcy5yYWRpdXMgKiAyfXB4O1xyXG4gICAgICBib3JkZXI6IDFweCBzb2xpZCByZWQ7XHJcbiAgICAgIGJvcmRlci1yYWRpdXM6IDEwMCU7XHJcbiAgICBgXHJcbiAgICB0aGlzLm1vdXNlID0gbW91c2VcclxuXHJcbiAgICBib2R5LmFwcGVuZENoaWxkKG1vdXNlKVxyXG5cclxuICAgIGxldCBtb3VzZU1vdmUgPSAoKGU6IGFueSkgPT4ge1xyXG4gICAgICBsZXQgW3gsIHldID0gW2UucGFnZVgsIGUucGFnZVldXHJcbiAgICAgIGxldCBpc09uQ2FudmFzID0gdGhpcy5pc09uQ2FudmFzKHgsIHkpXHJcblxyXG4gICAgICBtb3VzZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7eCAtIHRoaXMucmFkaXVzIC0gMX1weCwgJHt5IC0gdGhpcy5yYWRpdXMgLSAxfXB4KWAgLy8gbWludXMgYm9yZGVyIHdpZHRoIG9mIG1vdXNlIHR5cGVcclxuXHJcbiAgICAgIGlmICghaXNPbkNhbnZhcykge1xyXG4gICAgICAgIG1vdXNlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcclxuICAgICAgICBib2R5LnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0J1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1vdXNlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snXHJcbiAgICAgICAgYm9keS5zdHlsZS5jdXJzb3IgPSAnbm9uZSdcclxuICAgICAgfVxyXG4gICAgfSkuYmluZCh0aGlzKVxyXG5cclxuICAgIC8vIGNoYW5nZSBtb3VzZSBzdHlsZVxyXG4gICAgaWYgKCF0aGlzLmlzTW9iaWxlKSB7XHJcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBtb3VzZU1vdmUsIGZhbHNlKVxyXG4gICAgICB0aGlzLmJpbmRlZEV2ZW50cy5wdXNoKFt3aW4sICdtb3VzZW1vdmUnLCBtb3VzZU1vdmVdKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIG1vdXNlTW92ZSwgZmFsc2UpXHJcbiAgICAgIHRoaXMuYmluZGVkRXZlbnRzLnB1c2goW3dpbiwgJ3RvdWNobW92ZScsIG1vdXNlTW92ZV0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRSYWRpdXMocmFkaXVzOiBudW1iZXIpIHtcclxuICAgIGlmIChyYWRpdXMgPCAyIHx8IHJhZGl1cyA+IDEwMCkge1xyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnJhZGl1cyA9IHJhZGl1c1xyXG5cclxuICAgIGxldCBtb3VzZSA9IHRoaXMubW91c2VcclxuXHJcbiAgICBpZiAobW91c2UpIHtcclxuICAgICAgbW91c2Uuc3R5bGUud2lkdGggPSByYWRpdXMgKiAyICsgJ3B4J1xyXG4gICAgICBtb3VzZS5zdHlsZS5oZWlnaHQgPSByYWRpdXMgKiAyICsgJ3B4J1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgem9vbUluKHJhZGl1czpudW1iZXIgPSAyKSB7XHJcbiAgICB0aGlzLnNldFJhZGl1cyh0aGlzLnJhZGl1cyArIHJhZGl1cylcclxuICB9XHJcblxyXG4gIHpvb21PdXQocmFkaXVzOm51bWJlciA9IDIpIHtcclxuICAgIHRoaXMuc2V0UmFkaXVzKHRoaXMucmFkaXVzIC0gcmFkaXVzKVxyXG4gIH1cclxuXHJcblxyXG4gIGxpbmVUbyh4OiBudW1iZXIsIHk6IG51bWJlcik6IHZvaWQge1xyXG4gICAgY29uc3QgY3R4ID0gdGhpcy5jdHhcclxuICAgIGN0eC5saW5lQ2FwID0gdGhpcy5saW5lQ2FwXHJcbiAgICBjdHgubGluZUpvaW4gPSAncm91bmQnXHJcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yXHJcbiAgICBjdHgubGluZVdpZHRoID0gdGhpcy5yYWRpdXMgKiAyXHJcbiAgICBjdHgubGluZVRvKHgsIHkpXHJcbiAgICBjdHguc3Ryb2tlKClcclxuICB9XHJcblxyXG4gIGRyYXdDaXJjbGUoeDogbnVtYmVyLCB5OiBudW1iZXIsIHJhZGl1cz86IG51bWJlcik6IGFueVtdIHtcclxuICAgIGxldCBjdHggPSB0aGlzLmN0eFxyXG4gICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29sb3I7XHJcbiAgICBjdHguYmVnaW5QYXRoKClcclxuICAgIGN0eC5hcmMoeCArIDEsIHkgKyAxLCByYWRpdXMgfHwgdGhpcy5yYWRpdXMsIDAsIDM2MClcclxuICAgIGN0eC5maWxsKClcclxuICAgIGN0eC5jbG9zZVBhdGgoKVxyXG5cclxuICAgIHJldHVybiBbTW91c2VUeXBlLlBFTiwgdGhpcy5jb2xvciwgeCwgeSwgdGhpcy5yYWRpdXNdXHJcbiAgfVxyXG5cclxuICBkcmF3TGluZSh4OiBudW1iZXIsIHk6IG51bWJlcik6IGFueVtdIHtcclxuICAgIHRoaXMuY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzb3VyY2Utb3ZlcidcclxuICAgIHRoaXMubGluZUNhcCA9ICdyb3VuZCdcclxuICAgIHRoaXMubGluZUpvaW4gPSAncm91bmQnXHJcbiAgICB0aGlzLmxpbmVUbyh4LCB5KVxyXG4gICAgcmV0dXJuIFtNb3VzZVR5cGUuUEVOLCB0aGlzLmNvbG9yLCB4LCB5LCB0aGlzLnJhZGl1c11cclxuICB9XHJcblxyXG4gIGVyYXNlKHg6IG51bWJlciwgeTogbnVtYmVyKTogYW55W10ge1xyXG4gICAgdGhpcy5jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2Rlc3RpbmF0aW9uLW91dCdcclxuICAgIHRoaXMubGluZUNhcCA9ICdyb3VuZCdcclxuICAgIHRoaXMubGluZUpvaW4gPSAncm91bmQnXHJcbiAgICB0aGlzLmxpbmVUbyh4LCB5KVxyXG4gICAgcmV0dXJuIFtNb3VzZVR5cGUuRVJBU0VSLCB4LCB5LCB0aGlzLnJhZGl1c11cclxuICB9XHJcblxyXG4gIGRyYXdCeUV2ZW50KGV2ZW50OiBhbnkpOiBhbnlbXSB7XHJcbiAgICBsZXQgW3gsIHldID0gdGhpcy5nZXRDb29yZGluYXRlQnlFdmVudChldmVudClcclxuXHJcbiAgICBpZiAodGhpcy5tb3VzZVR5cGUgPT09IE1vdXNlVHlwZS5QRU4pIHsgcmV0dXJuIHRoaXMuZHJhd0xpbmUoeCwgeSkgfVxyXG4gICAgZWxzZSBpZiAodGhpcy5tb3VzZVR5cGUgPT09IE1vdXNlVHlwZS5FUkFTRVIpIHsgcmV0dXJuIHRoaXMuZXJhc2UoeCwgeSkgfVxyXG4gICAgZWxzZSB7IHJldHVybiBbXSB9XHJcbiAgfVxyXG5cclxuICBnZXRDb29yZGluYXRlQnlFdmVudChldmVudDogYW55KSB7XHJcbiAgICBsZXQgeCwgeVxyXG4gICAgaWYgKHRoaXMuaXNNb2JpbGUpIHsgZXZlbnQgPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXSB9XHJcblxyXG4gICAgeCA9IGV2ZW50LnBhZ2VYIC0gdGhpcy5jYW52YXMub2Zmc2V0TGVmdFxyXG4gICAgeSA9IGV2ZW50LnBhZ2VZIC0gdGhpcy5jYW52YXMub2Zmc2V0VG9wXHJcblxyXG4gICAgcmV0dXJuIFt4LCB5XVxyXG4gIH1cclxuXHJcblxyXG4gIGlzT25DYW52YXMocGFnZVg6IG51bWJlciwgcGFnZVk6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgaWYgKFxyXG4gICAgICBwYWdlWCA8IHRoaXMuaW1nLm9mZnNldExlZnQgfHxcclxuICAgICAgcGFnZVggPiAodGhpcy5pbWcub2Zmc2V0TGVmdCArIHRoaXMuaW1nLndpZHRoKSB8fFxyXG4gICAgICBwYWdlWSA8IHRoaXMuaW1nLm9mZnNldFRvcCB8fFxyXG4gICAgICBwYWdlWSA+ICh0aGlzLmltZy5vZmZzZXRUb3AgKyB0aGlzLmltZy5oZWlnaHQpXHJcbiAgICApIHsgcmV0dXJuIGZhbHNlfVxyXG5cclxuICAgIHJldHVybiB0cnVlXHJcbiAgfVxyXG5cclxuICBzZXRNYXhXaWR0aCh3aWR0aDogbnVtYmVyKSB7XHJcbiAgICB0aGlzLm1heFdpZHRoID0gd2lkdGhcclxuICB9XHJcblxyXG4gIHNldENvbG9yKGNvbG9yOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvclxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogc2V0IHRvb2wgYXMgbW91c2UgdHlwZVxyXG4gICAqIEBwYXJhbSB0b29sIE1vdXNlVHlwZVxyXG4gICAqL1xyXG4gIHNldFRvb2wodG9vbDogTW91c2VUeXBlKSB7XHJcbiAgICB0aGlzLm1vdXNlVHlwZSA9IHRvb2xcclxuXHJcbiAgICBpZiAodG9vbCA9PT0gTW91c2VUeXBlLlBFTikge1xyXG4gICAgICB0aGlzLnNldFBlbigpXHJcbiAgICB9IGVsc2UgaWYgKHRvb2wgPT09IE1vdXNlVHlwZS5FUkFTRVIpIHtcclxuICAgICAgdGhpcy5zZXRFcmFzZXIoKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0UGVuKCkge1xyXG4gICAgaWYgKHRoaXMubW91c2UpIHtcclxuICAgICAgKE9iamVjdCBhcyBhbnkpLmFzc2lnbih0aGlzLm1vdXNlLnN0eWxlLCB7XHJcbiAgICAgICAgYm9yZGVyUmFkaXVzOiAnMTAwJScsXHJcbiAgICAgICAgYm9yZGVyOiBgMXB4IHNvbGlkICR7UGhvdG9Db3Zlci5ERUZBVUxUX1BFTl9CT1JERVJfQ09MT1J9YFxyXG4gICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubW91c2VUeXBlID0gTW91c2VUeXBlLlBFTlxyXG4gIH1cclxuXHJcbiAgc2V0RXJhc2VyKCkge1xyXG4gICAgaWYgKHRoaXMubW91c2UpIHtcclxuICAgICAgKE9iamVjdCBhcyBhbnkpLmFzc2lnbih0aGlzLm1vdXNlLnN0eWxlLCB7XHJcbiAgICAgICAgYm9yZGVyUmFkaXVzOiAnMTAwJScsXHJcbiAgICAgICAgYm9yZGVyOiBgMXB4IGRhc2hlZCAke1Bob3RvQ292ZXIuREVGQVVMVF9FUkFTRVJfQk9SREVSX0NPTE9SfWBcclxuICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm1vdXNlVHlwZSA9IE1vdXNlVHlwZS5FUkFTRVJcclxuICB9XHJcblxyXG4gIHVuZG8oKSB7XHJcbiAgICBsZXQgY3R4ID0gdGhpcy5jdHhcclxuICAgIGxldCBjb2xvciA9IHRoaXMuY29sb3JcclxuXHJcbiAgICBjdHguc2F2ZSgpXHJcblxyXG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KVxyXG4gICAgdGhpcy5oaXN0b3JpZXMucG9wKClcclxuXHJcbiAgICB0aGlzLmhpc3Rvcmllcy5tYXAoKHN0ZXBzOiBBcnJheTxhbnk+KSA9PiB7XHJcbiAgICAgIHN0ZXBzLm1hcCgoc3RlcDogQXJyYXk8YW55PikgPT4ge1xyXG4gICAgICAgIGlmIChzdGVwWzBdID09PSBNb3VzZVR5cGUuUEVOKSB7XHJcbiAgICAgICAgICB0aGlzLmNvbG9yID0gc3RlcFsxXVxyXG4gICAgICAgICAgdGhpcy5zZXRSYWRpdXMoc3RlcFs0XSlcclxuICAgICAgICAgIHRoaXMuZHJhd0xpbmUoc3RlcFsyXSwgc3RlcFszXSlcclxuICAgICAgICB9IGVsc2UgaWYgKHN0ZXBbMF0gPT09IE1vdXNlVHlwZS5FUkFTRVIpIHtcclxuICAgICAgICAgIHRoaXMuc2V0UmFkaXVzKHN0ZXBbM10pXHJcbiAgICAgICAgICB0aGlzLmVyYXNlKHN0ZXBbMV0sIHN0ZXBbMl0pXHJcbiAgICAgICAgfSBlbHNlIGlmIChzdGVwWzBdID09PSAnTU9WRV9UTycpIHtcclxuICAgICAgICAgIGN0eC5iZWdpblBhdGgoKVxyXG4gICAgICAgICAgY3R4Lm1vdmVUby5hcHBseShjdHgsIHN0ZXAuc2xpY2UoMSkpXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLmNvbG9yID0gY29sb3JcclxuICAgIGN0eC5yZXN0b3JlKClcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBnZXQgaW1hZ2Ugb3JpZ2luIHNpemVcclxuICAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgc3JjICAgICAgaWFtZ2Ugc291cmNlIHVybFxyXG4gICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayBjYWxsYmFjayBmdW5jdGlvbiwgd2lkdGggYXMgZmlyc3QgcGFyYW1ldGVyIGFuZCBoZWlnaHQgYXMgc2Vjb25kXHJcbiAgICogQHJldHVybiB7dW5kZWZpbmVkfVxyXG4gICAqL1xyXG4gIGdldEltYWdlT3JpZ2luU2l6ZShzcmM6IHN0cmluZywgY2FsbGJhY2s/OiBGdW5jdGlvbikge1xyXG4gICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpXHJcblxyXG4gICAgaW1nLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgbGV0IHdpZHRoID0gaW1nLndpZHRoXHJcbiAgICAgIGxldCBoZWlnaHQgPSBpbWcuaGVpZ2h0XHJcblxyXG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh3aWR0aCwgaGVpZ2h0KVxyXG4gICAgfVxyXG5cclxuICAgIGltZy5zcmMgPSBzcmNcclxuICB9XHJcblxyXG4gIGdldERhdGFVUkwodHlwZSA9ICdpbWFnZS9qcGVnJywgcXVhbGl0eSA9IDAuOCwgY2FsbGJhY2s/OiBGdW5jdGlvbikge1xyXG5cclxuICAgIGxldCBzcmMgPSB0aGlzLmltZy5zcmNcclxuXHJcbiAgICB0aGlzLmdldEltYWdlT3JpZ2luU2l6ZShzcmMsICh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikgPT4ge1xyXG4gICAgICBsZXQgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpXHJcbiAgICAgIHRlbXBDYW52YXMud2lkdGggPSB3aWR0aFxyXG4gICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IGhlaWdodFxyXG4gICAgICBsZXQgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxyXG4gICAgICBpZiAodGVtcEN0eCkge1xyXG4gICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKHRoaXMuaW1nLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KVxyXG4gICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKHRoaXMuY2FudmFzLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KVxyXG5cclxuICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh0ZW1wQ2FudmFzLnRvRGF0YVVSTCh0eXBlLCBxdWFsaXR5KSlcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHJlbW92ZSBkb20gdGhhdCBhZGRlZCBpbnRvIGJvZHksXHJcbiAgICogcmVtb3ZlIGFsbCBldmVudHMgdGhhdCByZWdpc3RlcmVkXHJcbiAgICovXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIHRoaXMuY2FudmFzLnBhcmVudE5vZGUgJiYgdGhpcy5jYW52YXMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmNhbnZhcylcclxuICAgIHRoaXMubW91c2UucGFyZW50Tm9kZSAmJiB0aGlzLm1vdXNlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5tb3VzZSlcclxuXHJcbiAgICB0aGlzLmltZy5zcmMgPSAnJ1xyXG5cclxuICAgIHRoaXMuYmluZGVkRXZlbnRzLmZvckVhY2godiA9PiB7XHJcbiAgICAgIHZbMF0ucmVtb3ZlRXZlbnRMaXN0ZW5lcih2WzFdLCB2WzJdLCBmYWxzZSlcclxuICAgIH0pXHJcbiAgICAvLyBkZWxldGUgdGhpc1xyXG4gIH1cclxufVxyXG4iXX0=
