var MouseType;
(function (MouseType) {
    MouseType[MouseType["PEN"] = 0] = "PEN";
    MouseType[MouseType["ERASER"] = 1] = "ERASER";
})(MouseType || (MouseType = {}));
var PhotoCover = (function () {
    function PhotoCover(selector) {
        this.isMobile = navigator.userAgent.indexOf('iPhone') > -1 || navigator.userAgent.indexOf('Android') > -1;
        // cache window, document and body for speed up performance
        this.win = window;
        this.doc = document;
        this.body = document.body;
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');
        // init value
        this.mouseType = MouseType.PEN; // default mouse pointer
        this.radius = PhotoCover.DEFAULT_RADIUS; // default radius of pen
        this.maxWidth = PhotoCover.DEFAULT_MAX_WIDTH; // default max width of image
        this.color = PhotoCover.DEFAULT_COLOR; // default color of canvas
        this.linecap = PhotoCover.DEFAULT_LINECAP; // default linecap of line on canvas
        this.histories = []; // operate history
        this.bindedEvents = []; // registered events [node, type, function]
        if (typeof selector === 'object') {
            this.img = selector;
        }
        else if (typeof selector === 'string') {
            this.img = document.querySelector(selector);
        }
        // initial canvas and its size and position
        this.width = this.img.width;
        this.height = this.img.height;
        this.canvas.width = this.img.width;
        this.canvas.height = this.img.height;
        this.init();
    }
    PhotoCover.prototype.init = function () {
        var _this = this;
        var _a = [this.body, this.win], body = _a[0], win = _a[1];
        this.async();
        body.appendChild(this.canvas);
        if (!this.isMobile) {
            this.initMouse();
        }
        // async canvas position and size during browser resize
        var resize = (function () {
            _this.async();
        }).bind(this);
        win.addEventListener('resize', resize, false);
        this.bindedEvents.push([win, 'resize', resize]);
        var currentOperate = [];
        var canvasMouseDown = (function (e) {
            e.preventDefault();
            var _a = _this.getCoordinateByEvent(e), x = _a[0], y = _a[1];
            currentOperate = [];
            if (_this.isOnCanvas(x, y, true)) {
                _this.ctx.beginPath();
                currentOperate.push(['MOVE_TO', x, y]);
                currentOperate.push(_this.drawByEvent(e));
                _this.ctx.beginPath();
                currentOperate.push(['MOVE_TO', x, y]);
                if (!_this.isMobile) {
                    win.addEventListener('mousemove', canvasMouseMove, false);
                }
                else {
                    win.addEventListener('touchmove', canvasMouseMove, false);
                }
            }
        }).bind(this);
        var canvasMouseMove = (function (e) {
            e.preventDefault();
            currentOperate.push(_this.drawByEvent(e));
        }).bind(this);
        var canvasMouseUp = (function (e) {
            e.preventDefault();
            if (!_this.isMobile) {
                win.removeEventListener('mousemove', canvasMouseMove, false);
            }
            else {
                win.removeEventListener('touchmove', canvasMouseMove, false);
            }
            var _a = [e.pageX, e.pageY], x = _a[0], y = _a[1];
            if (_this.isOnCanvas(x, y)) {
                _this.histories.push(currentOperate);
                currentOperate = [];
            }
        }).bind(this);
        // canvas down
        if (!this.isMobile) {
            win.addEventListener('mousedown', canvasMouseDown, false);
            this.bindedEvents.push([win, 'mousedown', canvasMouseDown]);
            win.addEventListener('mouseup', canvasMouseUp, false);
            this.bindedEvents.push([win, 'mouseup', canvasMouseUp]);
        }
        else {
            win.addEventListener('touchstart', canvasMouseDown, false);
            this.bindedEvents.push([win, 'touchstart', canvasMouseDown]);
            win.addEventListener('touchend', canvasMouseUp, false);
            this.bindedEvents.push([win, 'touchend', canvasMouseUp]);
        }
    };
    // async x and y from image to canvas
    PhotoCover.prototype.async = function () {
        var coordinate = this.img.getBoundingClientRect();
        this.top = coordinate.top;
        this.left = coordinate.left;
        this.canvas.style.cssText = "\n      position: absolute;\n      left: " + (this.left + this.body.scrollLeft) + "px;\n      top: " + (this.top + this.body.scrollTop) + "px;\n      use-select: none;\n    ";
    };
    // initial mouse shape where mouse on canvas
    PhotoCover.prototype.initMouse = function () {
        var _this = this;
        var _a = [this.body, this.win], body = _a[0], win = _a[1];
        var mouse = document.createElement('div');
        mouse.style.cssText = "\n      display: none;\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 10001;\n      width: " + this.radius * 2 + "px;\n      height: " + this.radius * 2 + "px;\n      border: 1px solid red;\n      border-radius: 100%;\n    ";
        this.mouse = mouse;
        body.appendChild(mouse);
        var mouseMove = (function (e) {
            var _a = [e.pageX, e.pageY], x = _a[0], y = _a[1];
            var isOnCanvas = _this.isOnCanvas(x, y);
            mouse.style.transform = "translate(" + (x - _this.radius - 1) + "px, " + (y - _this.radius - 1) + "px)"; // minus border width of mouse type
            if (!isOnCanvas) {
                mouse.style.display = 'none';
                body.style.cursor = 'default';
            }
            else {
                mouse.style.display = 'block';
                body.style.cursor = 'none';
            }
        }).bind(this);
        // change mouse style
        if (!this.isMobile) {
            win.addEventListener('mousemove', mouseMove, false);
            this.bindedEvents.push([win, 'mousemove', mouseMove]);
        }
        else {
            win.addEventListener('touchmove', mouseMove, false);
            this.bindedEvents.push([win, 'touchmove', mouseMove]);
        }
    };
    PhotoCover.prototype.setRadius = function (radius) {
        if (radius < 2 || radius > 100) {
            return;
        }
        var mouse = this.mouse;
        this.radius = radius;
        mouse.style.width = radius * 2 + 'px';
        mouse.style.height = radius * 2 + 'px';
    };
    PhotoCover.prototype.zoomIn = function (radius) {
        if (radius === void 0) { radius = 2; }
        this.setRadius(this.radius + radius);
    };
    PhotoCover.prototype.zoomOut = function (radius) {
        if (radius === void 0) { radius = 2; }
        this.setRadius(this.radius - radius);
    };
    PhotoCover.prototype.drawCircle = function (x, y, radius) {
        var ctx = this.ctx;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(x + 1, y + 1, radius || this.radius, 0, 360);
        ctx.fill();
        ctx.closePath();
        return [MouseType.PEN, this.color, x, y, this.radius];
    };
    PhotoCover.prototype.drawLine = function (x, y, radius) {
        var ctx = this.ctx;
        ctx.lineCap = this.linecap;
        ctx.lineJoin = 'round';
        ctx.strokeStyle = this.color;
        ctx.lineWidth = (radius || this.radius) * 2;
        ctx.lineTo(x, y);
        ctx.stroke();
        return [MouseType.PEN, this.color, x, y, this.radius];
    };
    PhotoCover.prototype.drawByEvent = function (event) {
        var ctx = this.ctx;
        var _a = this.getCoordinateByEvent(event), x = _a[0], y = _a[1];
        if (this.mouseType === MouseType.PEN) {
            this.drawLine(x, y);
            return [MouseType.PEN, this.color, x, y, this.radius];
        }
        else if (this.mouseType === MouseType.ERASER) {
            x -= this.radius;
            y -= this.radius;
            var _b = [this.radius * 2, this.radius * 2], w = _b[0], h = _b[1];
            ctx.clearRect(x, y, w, h);
            return [MouseType.ERASER, x, y, w, h];
        }
        else {
            return [];
        }
    };
    PhotoCover.prototype.getCoordinateByEvent = function (event) {
        var x, y;
        var _a = [this.doc, this.body], doc = _a[0], body = _a[1];
        var canvas = this.canvas;
        if (this.isMobile) {
            event = event.changedTouches[0];
        }
        if (event.pageX || event.pageY) {
            x = event.pageX;
            y = event.pageY;
        }
        else {
            x = event.clientX + body.scrollLeft + doc.documentElement.scrollLeft;
            y = event.clientY + body.scrollTop + doc.documentElement.scrollTop;
        }
        x -= canvas.offsetLeft;
        y -= canvas.offsetTop;
        return [x, y];
    };
    PhotoCover.prototype.isOnCanvas = function (x, y, isRelative) {
        if (isRelative === void 0) { isRelative = false; }
        var body = this.body;
        var scrollTop = body.scrollTop;
        if (isRelative) {
            if (x < 0 || x > this.width || y < 0 || y > this.height) {
                return false;
            }
            else {
                return true;
            }
        }
        else {
            if (x < this.left || x > (this.left + this.width) || y < (scrollTop + this.top) || y > (scrollTop + this.top + this.height)) {
                return false;
            }
            else {
                return true;
            }
        }
    };
    PhotoCover.prototype.setMaxWidth = function (width) {
        this.maxWidth = width;
    };
    PhotoCover.prototype.setColor = function (color) {
        this.color = color;
    };
    /**
     * set tool as mouse type
     * @param tool MouseType
     */
    PhotoCover.prototype.setTool = function (tool) {
        this.mouseType = tool;
        if (tool === MouseType.PEN) {
            this.setPen();
        }
        else if (tool === MouseType.ERASER) {
            this.setEraser();
        }
    };
    PhotoCover.prototype.setPen = function () {
        Object.assign(this.mouse.style, {
            borderRadius: '100%',
            border: "1px solid " + PhotoCover.DEFAULT_PEN_BORDER_COLOR
        });
        this.mouseType = MouseType.PEN;
    };
    PhotoCover.prototype.setEraser = function () {
        Object.assign(this.mouse.style, {
            borderRadius: 0,
            border: "1px dashed " + PhotoCover.DEFAULT_ERASER_BORDER_COLOR
        });
        this.mouseType = MouseType.ERASER;
    };
    PhotoCover.prototype.undo = function () {
        var _this = this;
        var ctx = this.ctx;
        var color = this.color;
        ctx.save();
        ctx.clearRect(0, 0, this.width, this.height);
        this.histories.pop();
        this.histories.map(function (steps) {
            steps.map(function (step) {
                if (step[0] === MouseType.PEN) {
                    _this.color = step[1];
                    _this.drawLine(step[2], step[3], step[4]);
                }
                else if (step[0] === MouseType.ERASER) {
                    ctx.clearRect.apply(ctx, step.slice(1));
                }
                else if (step[0] === 'MOVE_TO') {
                    ctx.beginPath();
                    ctx.moveTo.apply(ctx, step.slice(1));
                }
            });
        });
        this.color = color;
        ctx.restore();
    };
    /**
     * get image origin size
     * @param  {String}   src      iamge source url
     * @param  {Function} callback callback function, width as first parameter and height as second
     * @return {undefined}
     */
    PhotoCover.prototype.getImageOriginSize = function (src, callback) {
        var img = new Image();
        img.onload = function () {
            var width = img.width;
            var height = img.height;
            callback && callback(width, height);
        };
        img.src = src;
    };
    PhotoCover.prototype.getDataURL = function (type, quality, callback) {
        var _this = this;
        if (type === void 0) { type = 'image/jpeg'; }
        if (quality === void 0) { quality = 0.8; }
        var src = this.img.src;
        this.getImageOriginSize(src, function (width, height) {
            var tempCanvas = document.createElement('canvas');
            tempCanvas.width = width;
            tempCanvas.height = height;
            var tempCtx = tempCanvas.getContext('2d');
            if (tempCtx) {
                tempCtx.drawImage(_this.img, 0, 0, width, height);
                tempCtx.drawImage(_this.canvas, 0, 0, width, height);
                callback && callback(tempCanvas.toDataURL(type, quality));
            }
        });
    };
    /**
     * remove dom that added into body,
     * remove all events that registered
     */
    PhotoCover.prototype.destroy = function () {
        this.canvas.parentNode && this.canvas.parentNode.removeChild(this.canvas);
        this.mouse.parentNode && this.mouse.parentNode.removeChild(this.mouse);
        this.img.src = '';
        this.bindedEvents.forEach(function (v) {
            v[0].removeEventListener(v[1], v[2], false);
        });
        // delete this
    };
    PhotoCover.DEFAULT_RADIUS = 20;
    PhotoCover.DEFAULT_MAX_WIDTH = 800;
    PhotoCover.DEFAULT_COLOR = 'black';
    PhotoCover.DEFAULT_PEN_BORDER_COLOR = 'red';
    PhotoCover.DEFAULT_ERASER_BORDER_COLOR = '#666';
    PhotoCover.DEFAULT_LINECAP = 'round';
    return PhotoCover;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBob3RvY292ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSyxTQUF5QjtBQUE5QixXQUFLLFNBQVM7SUFBRyx1Q0FBRyxDQUFBO0lBQUUsNkNBQU0sQ0FBQTtBQUFDLENBQUMsRUFBekIsU0FBUyxLQUFULFNBQVMsUUFBZ0I7QUFFOUI7SUFvQ0Usb0JBQVksUUFBbUM7UUE1QnRDLGFBQVEsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxTQUFTLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUU3RywyREFBMkQ7UUFDM0QsUUFBRyxHQUFXLE1BQU0sQ0FBQTtRQUNwQixRQUFHLEdBQWlCLFFBQVEsQ0FBQTtRQUM1QixTQUFJLEdBQWdCLFFBQVEsQ0FBQyxJQUFJLENBQUE7UUFHakMsV0FBTSxHQUFzQixRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBRzVELFFBQUcsR0FBNkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUE2QixDQUFBO1FBT3hGLGFBQWE7UUFDYixjQUFTLEdBQWMsU0FBUyxDQUFDLEdBQUcsQ0FBQSxDQUFJLHdCQUF3QjtRQUNoRSxXQUFNLEdBQUksVUFBVSxDQUFDLGNBQWMsQ0FBQSxDQUFJLHdCQUF3QjtRQUMvRCxhQUFRLEdBQUcsVUFBVSxDQUFDLGlCQUFpQixDQUFBLENBQUssNkJBQTZCO1FBQ3pFLFVBQUssR0FBRyxVQUFVLENBQUMsYUFBYSxDQUFBLENBQUksMEJBQTBCO1FBQzlELFlBQU8sR0FBRyxVQUFVLENBQUMsZUFBZSxDQUFBLENBQUksb0NBQW9DO1FBRTVFLGNBQVMsR0FBWSxFQUFFLENBQUEsQ0FBSSxrQkFBa0I7UUFDN0MsaUJBQVksR0FBWSxFQUFFLENBQUEsQ0FBSSwyQ0FBMkM7UUFJdkUsRUFBRSxDQUFDLENBQUMsT0FBTyxRQUFRLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztZQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsUUFBUSxDQUFBO1FBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxRQUFRLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztZQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQXFCLENBQUE7UUFBQyxDQUFDO1FBRTFHLDJDQUEyQztRQUMzQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFBO1FBQzNCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUE7UUFDN0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUE7UUFDbEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUE7UUFFcEMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFBO0lBQ2IsQ0FBQztJQUVPLHlCQUFJLEdBQVo7UUFBQSxpQkEwRUM7UUF4RUssSUFBQSwwQkFBbUMsRUFBbEMsWUFBSSxFQUFFLFdBQUcsQ0FBeUI7UUFFdkMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFBO1FBQ1osSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7UUFFN0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQTtRQUFDLENBQUM7UUFFeEMsdURBQXVEO1FBQ3ZELElBQUksTUFBTSxHQUFHLENBQUM7WUFDWixLQUFJLENBQUMsS0FBSyxFQUFFLENBQUE7UUFDZCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDYixHQUFHLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUM3QyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQTtRQUcvQyxJQUFJLGNBQWMsR0FBWSxFQUFFLENBQUE7UUFFaEMsSUFBSSxlQUFlLEdBQUcsQ0FBQyxVQUFDLENBQU07WUFDNUIsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFBO1lBRVosSUFBQSxrQ0FBcUMsRUFBcEMsU0FBQyxFQUFFLFNBQUMsQ0FBZ0M7WUFFM0MsY0FBYyxHQUFHLEVBQUUsQ0FBQTtZQUVuQixFQUFFLENBQUMsQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUVoQyxLQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFBO2dCQUNwQixjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUN0QyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFFeEMsS0FBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQTtnQkFDcEIsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFFdEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztvQkFBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLGVBQWUsRUFBRSxLQUFLLENBQUMsQ0FBQTtnQkFBQyxDQUFDO2dCQUNqRixJQUFJLENBQUMsQ0FBQztvQkFBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLGVBQWUsRUFBRSxLQUFLLENBQUMsQ0FBQTtnQkFBQyxDQUFDO1lBQ3BFLENBQUM7UUFFSCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFYixJQUFJLGVBQWUsR0FBRyxDQUFDLFVBQUMsQ0FBTTtZQUM1QixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUE7WUFDbEIsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDMUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBRWIsSUFBSSxhQUFhLEdBQUcsQ0FBQyxVQUFDLENBQU07WUFDMUIsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFBO1lBRWxCLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxlQUFlLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFBQyxDQUFDO1lBQ3BGLElBQUksQ0FBQyxDQUFDO2dCQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLEVBQUUsZUFBZSxFQUFFLEtBQUssQ0FBQyxDQUFBO1lBQUMsQ0FBQztZQUVqRSxJQUFBLHVCQUEyQixFQUExQixTQUFDLEVBQUUsU0FBQyxDQUFzQjtZQUUvQixFQUFFLENBQUMsQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFBO2dCQUNuQyxjQUFjLEdBQUcsRUFBRSxDQUFBO1lBQ3JCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFYixjQUFjO1FBQ2QsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNuQixHQUFHLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLGVBQWUsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUN6RCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxXQUFXLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQTtZQUUzRCxHQUFHLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUNyRCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxTQUFTLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQTtRQUN6RCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixHQUFHLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLGVBQWUsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUMxRCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxZQUFZLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQTtZQUU1RCxHQUFHLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUN0RCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxVQUFVLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQTtRQUMxRCxDQUFDO0lBQ0gsQ0FBQztJQUVELHFDQUFxQztJQUM3QiwwQkFBSyxHQUFiO1FBQ0UsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSxDQUFBO1FBQ2pELElBQUksQ0FBQyxHQUFHLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQTtRQUN6QixJQUFJLENBQUMsSUFBSSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUE7UUFFM0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLCtDQUVsQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSwwQkFDakMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsd0NBRXRDLENBQUE7SUFDSCxDQUFDO0lBRUQsNENBQTRDO0lBQ3BDLDhCQUFTLEdBQWpCO1FBQUEsaUJBeUNDO1FBeENLLElBQUEsMEJBQW1DLEVBQWxDLFlBQUksRUFBRSxXQUFHLENBQXlCO1FBQ3ZDLElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDekMsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsMkhBTVgsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLDJCQUNkLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyx3RUFHMUIsQ0FBQTtRQUNELElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBO1FBRWxCLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUE7UUFFdkIsSUFBSSxTQUFTLEdBQUcsQ0FBQyxVQUFDLENBQU07WUFDbEIsSUFBQSx1QkFBMkIsRUFBMUIsU0FBQyxFQUFFLFNBQUMsQ0FBc0I7WUFDL0IsSUFBSSxVQUFVLEdBQUcsS0FBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7WUFFdEMsS0FBSyxDQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsZ0JBQWEsQ0FBQyxHQUFHLEtBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxjQUFPLENBQUMsR0FBRyxLQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsU0FBSyxDQUFBLENBQUMsbUNBQW1DO1lBRTNILEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztnQkFDaEIsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFBO2dCQUM1QixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUE7WUFDL0IsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQTtnQkFDN0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO1lBQzVCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFYixxQkFBcUI7UUFDckIsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNuQixHQUFHLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUNuRCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQTtRQUN2RCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixHQUFHLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUNuRCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQTtRQUN2RCxDQUFDO0lBQ0gsQ0FBQztJQUVELDhCQUFTLEdBQVQsVUFBVSxNQUFjO1FBQ3RCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0IsTUFBTSxDQUFBO1FBQ1IsQ0FBQztRQUVELElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7UUFDdEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUE7UUFFcEIsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsTUFBTSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUE7UUFDckMsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUE7SUFDeEMsQ0FBQztJQUVELDJCQUFNLEdBQU4sVUFBTyxNQUFpQjtRQUFqQix1QkFBQSxFQUFBLFVBQWlCO1FBQ3RCLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsQ0FBQTtJQUN0QyxDQUFDO0lBRUQsNEJBQU8sR0FBUCxVQUFRLE1BQWlCO1FBQWpCLHVCQUFBLEVBQUEsVUFBaUI7UUFDdkIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxDQUFBO0lBQ3RDLENBQUM7SUFFRCwrQkFBVSxHQUFWLFVBQVcsQ0FBUyxFQUFFLENBQVMsRUFBRSxNQUFlO1FBQzlDLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUE7UUFDbEIsR0FBRyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQzNCLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQTtRQUNmLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUNwRCxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDVixHQUFHLENBQUMsU0FBUyxFQUFFLENBQUE7UUFFZixNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDdkQsQ0FBQztJQUVELDZCQUFRLEdBQVIsVUFBUyxDQUFTLEVBQUUsQ0FBUyxFQUFFLE1BQWU7UUFDNUMsSUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQTtRQUVwQixHQUFHLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7UUFDMUIsR0FBRyxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUE7UUFDdEIsR0FBRyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1FBQzVCLEdBQUcsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUMzQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUNoQixHQUFHLENBQUMsTUFBTSxFQUFFLENBQUE7UUFFWixNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDdkQsQ0FBQztJQUVELGdDQUFXLEdBQVgsVUFBWSxLQUFVO1FBQ3BCLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUE7UUFDZCxJQUFBLHFDQUF5QyxFQUF4QyxTQUFDLEVBQUUsU0FBQyxDQUFvQztRQUU3QyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1lBQ25CLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUN2RCxDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLEtBQUssU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDL0MsQ0FBQyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUE7WUFDaEIsQ0FBQyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUE7WUFDWixJQUFBLHVDQUEyQyxFQUExQyxTQUFDLEVBQUUsU0FBQyxDQUFzQztZQUMvQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1lBQ3pCLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDdkMsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sTUFBTSxDQUFDLEVBQUUsQ0FBQTtRQUNYLENBQUM7SUFDSCxDQUFDO0lBRUQseUNBQW9CLEdBQXBCLFVBQXFCLEtBQVU7UUFDN0IsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ0osSUFBQSwwQkFBbUMsRUFBbEMsV0FBRyxFQUFFLFlBQUksQ0FBeUI7UUFDdkMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQTtRQUV4QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQUMsQ0FBQztRQUV0RCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQy9CLENBQUMsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFBO1lBQ2YsQ0FBQyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUE7UUFDakIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sQ0FBQyxHQUFHLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQTtZQUNwRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFBO1FBQ3BFLENBQUM7UUFFRCxDQUFDLElBQUksTUFBTSxDQUFDLFVBQVUsQ0FBQTtRQUN0QixDQUFDLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQTtRQUVyQixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDZixDQUFDO0lBR0QsK0JBQVUsR0FBVixVQUFXLENBQVMsRUFBRSxDQUFTLEVBQUUsVUFBMEI7UUFBMUIsMkJBQUEsRUFBQSxrQkFBMEI7UUFDekQsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQTtRQUNwQixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFBO1FBRTlCLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDZixFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUE7WUFBQyxDQUFDO1lBQ3pFLElBQUksQ0FBQyxDQUFDO2dCQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUE7WUFBQyxDQUFDO1FBQ3RCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFBQyxNQUFNLENBQUMsS0FBSyxDQUFBO1lBQUMsQ0FBQztZQUM3SSxJQUFJLENBQUMsQ0FBQztnQkFBQyxNQUFNLENBQUMsSUFBSSxDQUFBO1lBQUMsQ0FBQztRQUN0QixDQUFDO0lBQ0gsQ0FBQztJQUVELGdDQUFXLEdBQVgsVUFBWSxLQUFhO1FBQ3ZCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFBO0lBQ3ZCLENBQUM7SUFFRCw2QkFBUSxHQUFSLFVBQVMsS0FBYTtRQUNwQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQTtJQUNwQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsNEJBQU8sR0FBUCxVQUFRLElBQWU7UUFDckIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUE7UUFFckIsRUFBRSxDQUFDLENBQUMsSUFBSSxLQUFLLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzNCLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQTtRQUNmLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxLQUFLLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQTtRQUNsQixDQUFDO0lBQ0gsQ0FBQztJQUVELDJCQUFNLEdBQU47UUFDRyxNQUFjLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFO1lBQ3ZDLFlBQVksRUFBRSxNQUFNO1lBQ3BCLE1BQU0sRUFBRSxlQUFhLFVBQVUsQ0FBQyx3QkFBMEI7U0FDM0QsQ0FBQyxDQUFBO1FBRUYsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFBO0lBQ2hDLENBQUM7SUFFRCw4QkFBUyxHQUFUO1FBQ0csTUFBYyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRTtZQUN2QyxZQUFZLEVBQUUsQ0FBQztZQUNmLE1BQU0sRUFBRSxnQkFBYyxVQUFVLENBQUMsMkJBQTZCO1NBQy9ELENBQUMsQ0FBQTtRQUVGLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQTtJQUNuQyxDQUFDO0lBRUQseUJBQUksR0FBSjtRQUFBLGlCQXlCQztRQXhCQyxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFBO1FBQ2xCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7UUFFdEIsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFBO1FBRVYsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQzVDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUE7UUFFcEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsVUFBQyxLQUFpQjtZQUNuQyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQUMsSUFBZ0I7Z0JBQ3pCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDOUIsS0FBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7b0JBQ3BCLEtBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFDMUMsQ0FBQztnQkFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUN4QyxHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUN6QyxDQUFDO2dCQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztvQkFDakMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFBO29CQUNmLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQ3RDLENBQUM7WUFDSCxDQUFDLENBQUMsQ0FBQTtRQUNKLENBQUMsQ0FBQyxDQUFBO1FBRUYsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUE7UUFDbEIsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFBO0lBQ2YsQ0FBQztJQUdEOzs7OztPQUtHO0lBQ0gsdUNBQWtCLEdBQWxCLFVBQW1CLEdBQVcsRUFBRSxRQUFtQjtRQUNqRCxJQUFJLEdBQUcsR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFBO1FBRXJCLEdBQUcsQ0FBQyxNQUFNLEdBQUc7WUFDWCxJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFBO1lBQ3JCLElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUE7WUFFdkIsUUFBUSxJQUFJLFFBQVEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDckMsQ0FBQyxDQUFBO1FBRUQsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUE7SUFDZixDQUFDO0lBRUQsK0JBQVUsR0FBVixVQUFXLElBQW1CLEVBQUUsT0FBYSxFQUFFLFFBQW1CO1FBQWxFLGlCQWdCQztRQWhCVSxxQkFBQSxFQUFBLG1CQUFtQjtRQUFFLHdCQUFBLEVBQUEsYUFBYTtRQUUzQyxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQTtRQUV0QixJQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLFVBQUMsS0FBYSxFQUFFLE1BQWM7WUFDekQsSUFBSSxVQUFVLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtZQUNqRCxVQUFVLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQTtZQUN4QixVQUFVLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQTtZQUMxQixJQUFJLE9BQU8sR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFBO1lBQ3pDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQ1osT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFBO2dCQUNoRCxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUE7Z0JBRW5ELFFBQVEsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtZQUMzRCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsNEJBQU8sR0FBUDtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDekUsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUV0RSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUE7UUFFakIsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBQSxDQUFDO1lBQ3pCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQzdDLENBQUMsQ0FBQyxDQUFBO1FBQ0YsY0FBYztJQUNoQixDQUFDO0lBL1lNLHlCQUFjLEdBQVUsRUFBRSxDQUFBO0lBQzFCLDRCQUFpQixHQUFVLEdBQUcsQ0FBQTtJQUM5Qix3QkFBYSxHQUFXLE9BQU8sQ0FBQTtJQUMvQixtQ0FBd0IsR0FBVyxLQUFLLENBQUE7SUFDeEMsc0NBQTJCLEdBQVUsTUFBTSxDQUFBO0lBQzNDLDBCQUFlLEdBQVcsT0FBTyxDQUFBO0lBMlkxQyxpQkFBQztDQWpaRCxBQWlaQyxJQUFBIiwiZmlsZSI6InBob3RvY292ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJlbnVtIE1vdXNlVHlwZSB7IFBFTiwgRVJBU0VSIH1cclxuXHJcbmNsYXNzIFBob3RvQ292ZXIge1xyXG4gIHN0YXRpYyBERUZBVUxUX1JBRElVUzpudW1iZXIgPSAyMFxyXG4gIHN0YXRpYyBERUZBVUxUX01BWF9XSURUSDpudW1iZXIgPSA4MDBcclxuICBzdGF0aWMgREVGQVVMVF9DT0xPUjogc3RyaW5nID0gJ2JsYWNrJ1xyXG4gIHN0YXRpYyBERUZBVUxUX1BFTl9CT1JERVJfQ09MT1I6IHN0cmluZyA9ICdyZWQnXHJcbiAgc3RhdGljIERFRkFVTFRfRVJBU0VSX0JPUkRFUl9DT0xPUjpzdHJpbmcgPSAnIzY2NidcclxuICBzdGF0aWMgREVGQVVMVF9MSU5FQ0FQOiBzdHJpbmcgPSAncm91bmQnXHJcblxyXG4gIHJlYWRvbmx5IGlzTW9iaWxlID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdpUGhvbmUnKSA+IC0xIHx8IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQW5kcm9pZCcpID4gLTFcclxuXHJcbiAgLy8gY2FjaGUgd2luZG93LCBkb2N1bWVudCBhbmQgYm9keSBmb3Igc3BlZWQgdXAgcGVyZm9ybWFuY2VcclxuICB3aW46IFdpbmRvdyA9IHdpbmRvd1xyXG4gIGRvYzogSFRNTERvY3VtZW50ID0gZG9jdW1lbnRcclxuICBib2R5OiBIVE1MRWxlbWVudCA9IGRvY3VtZW50LmJvZHlcclxuXHJcbiAgbW91c2U6IEhUTUxEaXZFbGVtZW50ICAgLy8gbW91c2UgcG9pbnRlciBvbiBjYW52YXNcclxuICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcclxuICBpbWc6IEhUTUxJbWFnZUVsZW1lbnQgIC8vIGltYWdlIHRoYXQgeW91IHdhbnQgdG8gY2hhbmdlIFxyXG5cclxuICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJykgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEXHJcblxyXG4gIHdpZHRoOiBudW1iZXIgICAgLy8gd2lkdGggb2YgaW1hZ2UgYWZ0ZXIgcmVuZGVyXHJcbiAgaGVpZ2h0OiBudW1iZXIgIC8vIGhlaWdodCBvZiBpbWFnZSBhZnRlciByZW5kZXJcclxuICBsZWZ0OiBudW1iZXIgICAgLy8gYWJzb2x1dGUgbGVmdCByZWxhdGl2ZSBib2R5IG9mIGltYWdlXHJcbiAgdG9wOiBudW1iZXIgICAgIC8vIGFic29sdXRlIHRvcCByZWxhdGl2ZSBib2R5IG9mIGltYWdlXHJcblxyXG4gIC8vIGluaXQgdmFsdWVcclxuICBtb3VzZVR5cGU6IE1vdXNlVHlwZSA9IE1vdXNlVHlwZS5QRU4gICAgLy8gZGVmYXVsdCBtb3VzZSBwb2ludGVyXHJcbiAgcmFkaXVzID0gIFBob3RvQ292ZXIuREVGQVVMVF9SQURJVVMgICAgLy8gZGVmYXVsdCByYWRpdXMgb2YgcGVuXHJcbiAgbWF4V2lkdGggPSBQaG90b0NvdmVyLkRFRkFVTFRfTUFYX1dJRFRIICAgICAvLyBkZWZhdWx0IG1heCB3aWR0aCBvZiBpbWFnZVxyXG4gIGNvbG9yID0gUGhvdG9Db3Zlci5ERUZBVUxUX0NPTE9SICAgIC8vIGRlZmF1bHQgY29sb3Igb2YgY2FudmFzXHJcbiAgbGluZWNhcCA9IFBob3RvQ292ZXIuREVGQVVMVF9MSU5FQ0FQICAgIC8vIGRlZmF1bHQgbGluZWNhcCBvZiBsaW5lIG9uIGNhbnZhc1xyXG5cclxuICBoaXN0b3JpZXM6IGFueVtdW10gPSBbXSAgICAvLyBvcGVyYXRlIGhpc3RvcnlcclxuICBiaW5kZWRFdmVudHM6IGFueVtdW10gPSBbXSAgICAvLyByZWdpc3RlcmVkIGV2ZW50cyBbbm9kZSwgdHlwZSwgZnVuY3Rpb25dXHJcblxyXG4gIGNvbnN0cnVjdG9yKHNlbGVjdG9yOiBIVE1MSW1hZ2VFbGVtZW50IHwgc3RyaW5nKSB7XHJcblxyXG4gICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ29iamVjdCcpIHsgdGhpcy5pbWcgPSBzZWxlY3RvciB9XHJcbiAgICBlbHNlIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICdzdHJpbmcnKSB7IHRoaXMuaW1nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvcikgYXMgSFRNTEltYWdlRWxlbWVudCB9XHJcbiAgICBcclxuICAgIC8vIGluaXRpYWwgY2FudmFzIGFuZCBpdHMgc2l6ZSBhbmQgcG9zaXRpb25cclxuICAgIHRoaXMud2lkdGggPSB0aGlzLmltZy53aWR0aFxyXG4gICAgdGhpcy5oZWlnaHQgPSB0aGlzLmltZy5oZWlnaHRcclxuICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy5pbWcud2lkdGhcclxuICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMuaW1nLmhlaWdodFxyXG5cclxuICAgIHRoaXMuaW5pdCgpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluaXQoKTogdm9pZCB7XHJcblxyXG4gICAgbGV0IFtib2R5LCB3aW5dID0gW3RoaXMuYm9keSwgdGhpcy53aW5dXHJcblxyXG4gICAgdGhpcy5hc3luYygpXHJcbiAgICBib2R5LmFwcGVuZENoaWxkKHRoaXMuY2FudmFzKVxyXG5cclxuICAgIGlmICghdGhpcy5pc01vYmlsZSkgeyB0aGlzLmluaXRNb3VzZSgpIH1cclxuXHJcbiAgICAvLyBhc3luYyBjYW52YXMgcG9zaXRpb24gYW5kIHNpemUgZHVyaW5nIGJyb3dzZXIgcmVzaXplXHJcbiAgICBsZXQgcmVzaXplID0gKCgpID0+IHtcclxuICAgICAgdGhpcy5hc3luYygpXHJcbiAgICB9KS5iaW5kKHRoaXMpXHJcbiAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgcmVzaXplLCBmYWxzZSlcclxuICAgIHRoaXMuYmluZGVkRXZlbnRzLnB1c2goW3dpbiwgJ3Jlc2l6ZScsIHJlc2l6ZV0pXHJcblxyXG5cclxuICAgIGxldCBjdXJyZW50T3BlcmF0ZTogYW55W11bXSA9IFtdXHJcblxyXG4gICAgbGV0IGNhbnZhc01vdXNlRG93biA9ICgoZTogYW55KSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxyXG5cclxuICAgICAgY29uc3QgW3gsIHldID0gdGhpcy5nZXRDb29yZGluYXRlQnlFdmVudChlKVxyXG5cclxuICAgICAgY3VycmVudE9wZXJhdGUgPSBbXVxyXG5cclxuICAgICAgaWYgKHRoaXMuaXNPbkNhbnZhcyh4LCB5LCB0cnVlKSkge1xyXG5cclxuICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKVxyXG4gICAgICAgIGN1cnJlbnRPcGVyYXRlLnB1c2goWydNT1ZFX1RPJywgeCwgeV0pXHJcbiAgICAgICAgY3VycmVudE9wZXJhdGUucHVzaCh0aGlzLmRyYXdCeUV2ZW50KGUpKVxyXG5cclxuICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKVxyXG4gICAgICAgIGN1cnJlbnRPcGVyYXRlLnB1c2goWydNT1ZFX1RPJywgeCwgeV0pXHJcblxyXG4gICAgICAgIGlmICghdGhpcy5pc01vYmlsZSkgeyB3aW4uYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgY2FudmFzTW91c2VNb3ZlLCBmYWxzZSkgfVxyXG4gICAgICAgIGVsc2UgeyB3aW4uYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgY2FudmFzTW91c2VNb3ZlLCBmYWxzZSkgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgfSkuYmluZCh0aGlzKVxyXG5cclxuICAgIGxldCBjYW52YXNNb3VzZU1vdmUgPSAoKGU6IGFueSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcclxuICAgICAgY3VycmVudE9wZXJhdGUucHVzaCh0aGlzLmRyYXdCeUV2ZW50KGUpKVxyXG4gICAgfSkuYmluZCh0aGlzKVxyXG5cclxuICAgIGxldCBjYW52YXNNb3VzZVVwID0gKChlOiBhbnkpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXHJcblxyXG4gICAgICBpZiAoIXRoaXMuaXNNb2JpbGUpIHsgd2luLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGNhbnZhc01vdXNlTW92ZSwgZmFsc2UpIH1cclxuICAgICAgZWxzZSB7IHdpbi5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBjYW52YXNNb3VzZU1vdmUsIGZhbHNlKSB9XHJcbiAgICAgIFxyXG4gICAgICBsZXQgW3gsIHldID0gW2UucGFnZVgsIGUucGFnZVldXHJcblxyXG4gICAgICBpZiAodGhpcy5pc09uQ2FudmFzKHgsIHkpKSB7XHJcbiAgICAgICAgdGhpcy5oaXN0b3JpZXMucHVzaChjdXJyZW50T3BlcmF0ZSlcclxuICAgICAgICBjdXJyZW50T3BlcmF0ZSA9IFtdXHJcbiAgICAgIH1cclxuICAgIH0pLmJpbmQodGhpcylcclxuXHJcbiAgICAvLyBjYW52YXMgZG93blxyXG4gICAgaWYgKCF0aGlzLmlzTW9iaWxlKSB7XHJcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBjYW52YXNNb3VzZURvd24sIGZhbHNlKVxyXG4gICAgICB0aGlzLmJpbmRlZEV2ZW50cy5wdXNoKFt3aW4sICdtb3VzZWRvd24nLCBjYW52YXNNb3VzZURvd25dKVxyXG5cclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBjYW52YXNNb3VzZVVwLCBmYWxzZSlcclxuICAgICAgdGhpcy5iaW5kZWRFdmVudHMucHVzaChbd2luLCAnbW91c2V1cCcsIGNhbnZhc01vdXNlVXBdKSBcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgY2FudmFzTW91c2VEb3duLCBmYWxzZSlcclxuICAgICAgdGhpcy5iaW5kZWRFdmVudHMucHVzaChbd2luLCAndG91Y2hzdGFydCcsIGNhbnZhc01vdXNlRG93bl0pXHJcblxyXG4gICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBjYW52YXNNb3VzZVVwLCBmYWxzZSlcclxuICAgICAgdGhpcy5iaW5kZWRFdmVudHMucHVzaChbd2luLCAndG91Y2hlbmQnLCBjYW52YXNNb3VzZVVwXSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIGFzeW5jIHggYW5kIHkgZnJvbSBpbWFnZSB0byBjYW52YXNcclxuICBwcml2YXRlIGFzeW5jKCkge1xyXG4gICAgbGV0IGNvb3JkaW5hdGUgPSB0aGlzLmltZy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxyXG4gICAgdGhpcy50b3AgPSBjb29yZGluYXRlLnRvcFxyXG4gICAgdGhpcy5sZWZ0ID0gY29vcmRpbmF0ZS5sZWZ0XHJcblxyXG4gICAgdGhpcy5jYW52YXMuc3R5bGUuY3NzVGV4dCA9IGBcclxuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xyXG4gICAgICBsZWZ0OiAke3RoaXMubGVmdCArIHRoaXMuYm9keS5zY3JvbGxMZWZ0fXB4O1xyXG4gICAgICB0b3A6ICR7dGhpcy50b3AgKyB0aGlzLmJvZHkuc2Nyb2xsVG9wfXB4O1xyXG4gICAgICB1c2Utc2VsZWN0OiBub25lO1xyXG4gICAgYFxyXG4gIH1cclxuXHJcbiAgLy8gaW5pdGlhbCBtb3VzZSBzaGFwZSB3aGVyZSBtb3VzZSBvbiBjYW52YXNcclxuICBwcml2YXRlIGluaXRNb3VzZSgpIHtcclxuICAgIGxldCBbYm9keSwgd2luXSA9IFt0aGlzLmJvZHksIHRoaXMud2luXVxyXG4gICAgbGV0IG1vdXNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuICAgIG1vdXNlLnN0eWxlLmNzc1RleHQgPSBgXHJcbiAgICAgIGRpc3BsYXk6IG5vbmU7XHJcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICAgICAgbGVmdDogMDtcclxuICAgICAgdG9wOiAwO1xyXG4gICAgICB6LWluZGV4OiAxMDAwMTtcclxuICAgICAgd2lkdGg6ICR7dGhpcy5yYWRpdXMgKiAyfXB4O1xyXG4gICAgICBoZWlnaHQ6ICR7dGhpcy5yYWRpdXMgKiAyfXB4O1xyXG4gICAgICBib3JkZXI6IDFweCBzb2xpZCByZWQ7XHJcbiAgICAgIGJvcmRlci1yYWRpdXM6IDEwMCU7XHJcbiAgICBgXHJcbiAgICB0aGlzLm1vdXNlID0gbW91c2VcclxuXHJcbiAgICBib2R5LmFwcGVuZENoaWxkKG1vdXNlKVxyXG5cclxuICAgIGxldCBtb3VzZU1vdmUgPSAoKGU6IGFueSkgPT4ge1xyXG4gICAgICBsZXQgW3gsIHldID0gW2UucGFnZVgsIGUucGFnZVldXHJcbiAgICAgIGxldCBpc09uQ2FudmFzID0gdGhpcy5pc09uQ2FudmFzKHgsIHkpXHJcblxyXG4gICAgICBtb3VzZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7eCAtIHRoaXMucmFkaXVzIC0gMX1weCwgJHt5IC0gdGhpcy5yYWRpdXMgLSAxfXB4KWAgLy8gbWludXMgYm9yZGVyIHdpZHRoIG9mIG1vdXNlIHR5cGVcclxuXHJcbiAgICAgIGlmICghaXNPbkNhbnZhcykge1xyXG4gICAgICAgIG1vdXNlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcclxuICAgICAgICBib2R5LnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0J1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1vdXNlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snXHJcbiAgICAgICAgYm9keS5zdHlsZS5jdXJzb3IgPSAnbm9uZSdcclxuICAgICAgfVxyXG4gICAgfSkuYmluZCh0aGlzKVxyXG5cclxuICAgIC8vIGNoYW5nZSBtb3VzZSBzdHlsZVxyXG4gICAgaWYgKCF0aGlzLmlzTW9iaWxlKSB7XHJcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBtb3VzZU1vdmUsIGZhbHNlKVxyXG4gICAgICB0aGlzLmJpbmRlZEV2ZW50cy5wdXNoKFt3aW4sICdtb3VzZW1vdmUnLCBtb3VzZU1vdmVdKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIG1vdXNlTW92ZSwgZmFsc2UpXHJcbiAgICAgIHRoaXMuYmluZGVkRXZlbnRzLnB1c2goW3dpbiwgJ3RvdWNobW92ZScsIG1vdXNlTW92ZV0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRSYWRpdXMocmFkaXVzOiBudW1iZXIpIHtcclxuICAgIGlmIChyYWRpdXMgPCAyIHx8IHJhZGl1cyA+IDEwMCkge1xyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICBsZXQgbW91c2UgPSB0aGlzLm1vdXNlXHJcbiAgICB0aGlzLnJhZGl1cyA9IHJhZGl1c1xyXG5cclxuICAgIG1vdXNlLnN0eWxlLndpZHRoID0gcmFkaXVzICogMiArICdweCdcclxuICAgIG1vdXNlLnN0eWxlLmhlaWdodCA9IHJhZGl1cyAqIDIgKyAncHgnXHJcbiAgfVxyXG5cclxuICB6b29tSW4ocmFkaXVzOm51bWJlciA9IDIpIHtcclxuICAgIHRoaXMuc2V0UmFkaXVzKHRoaXMucmFkaXVzICsgcmFkaXVzKVxyXG4gIH1cclxuXHJcbiAgem9vbU91dChyYWRpdXM6bnVtYmVyID0gMikge1xyXG4gICAgdGhpcy5zZXRSYWRpdXModGhpcy5yYWRpdXMgLSByYWRpdXMpXHJcbiAgfVxyXG5cclxuICBkcmF3Q2lyY2xlKHg6IG51bWJlciwgeTogbnVtYmVyLCByYWRpdXM/OiBudW1iZXIpOiBhbnlbXSB7XHJcbiAgICBsZXQgY3R4ID0gdGhpcy5jdHhcclxuICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvbG9yO1xyXG4gICAgY3R4LmJlZ2luUGF0aCgpXHJcbiAgICBjdHguYXJjKHggKyAxLCB5ICsgMSwgcmFkaXVzIHx8IHRoaXMucmFkaXVzLCAwLCAzNjApXHJcbiAgICBjdHguZmlsbCgpXHJcbiAgICBjdHguY2xvc2VQYXRoKClcclxuXHJcbiAgICByZXR1cm4gW01vdXNlVHlwZS5QRU4sIHRoaXMuY29sb3IsIHgsIHksIHRoaXMucmFkaXVzXVxyXG4gIH1cclxuXHJcbiAgZHJhd0xpbmUoeDogbnVtYmVyLCB5OiBudW1iZXIsIHJhZGl1cz86IG51bWJlcik6IGFueVtdIHtcclxuICAgIGNvbnN0IGN0eCA9IHRoaXMuY3R4XHJcblxyXG4gICAgY3R4LmxpbmVDYXAgPSB0aGlzLmxpbmVjYXBcclxuICAgIGN0eC5saW5lSm9pbiA9ICdyb3VuZCdcclxuICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMuY29sb3JcclxuICAgIGN0eC5saW5lV2lkdGggPSAocmFkaXVzIHx8IHRoaXMucmFkaXVzKSAqIDJcclxuICAgIGN0eC5saW5lVG8oeCwgeSlcclxuICAgIGN0eC5zdHJva2UoKVxyXG5cclxuICAgIHJldHVybiBbTW91c2VUeXBlLlBFTiwgdGhpcy5jb2xvciwgeCwgeSwgdGhpcy5yYWRpdXNdXHJcbiAgfVxyXG5cclxuICBkcmF3QnlFdmVudChldmVudDogYW55KTogQXJyYXk8YW55PiB7XHJcbiAgICBsZXQgY3R4ID0gdGhpcy5jdHhcclxuICAgIGxldCBbeCwgeV0gPSB0aGlzLmdldENvb3JkaW5hdGVCeUV2ZW50KGV2ZW50KVxyXG5cclxuICAgIGlmICh0aGlzLm1vdXNlVHlwZSA9PT0gTW91c2VUeXBlLlBFTikge1xyXG4gICAgICB0aGlzLmRyYXdMaW5lKHgsIHkpXHJcbiAgICAgIHJldHVybiBbTW91c2VUeXBlLlBFTiwgdGhpcy5jb2xvciwgeCwgeSwgdGhpcy5yYWRpdXNdXHJcbiAgICB9IGVsc2UgaWYgKHRoaXMubW91c2VUeXBlID09PSBNb3VzZVR5cGUuRVJBU0VSKSB7XHJcbiAgICAgIHggLT0gdGhpcy5yYWRpdXNcclxuICAgICAgeSAtPSB0aGlzLnJhZGl1c1xyXG4gICAgICBsZXQgW3csIGhdID0gW3RoaXMucmFkaXVzICogMiwgdGhpcy5yYWRpdXMgKiAyXVxyXG4gICAgICBjdHguY2xlYXJSZWN0KHgsIHksIHcsIGgpXHJcbiAgICAgIHJldHVybiBbTW91c2VUeXBlLkVSQVNFUiwgeCwgeSwgdywgaF1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBbXVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0Q29vcmRpbmF0ZUJ5RXZlbnQoZXZlbnQ6IGFueSkge1xyXG4gICAgbGV0IHgsIHlcclxuICAgIGxldCBbZG9jLCBib2R5XSA9IFt0aGlzLmRvYywgdGhpcy5ib2R5XVxyXG4gICAgbGV0IGNhbnZhcyA9IHRoaXMuY2FudmFzXHJcblxyXG4gICAgaWYgKHRoaXMuaXNNb2JpbGUpIHsgZXZlbnQgPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXSB9XHJcblxyXG4gICAgaWYgKGV2ZW50LnBhZ2VYIHx8IGV2ZW50LnBhZ2VZKSB7XHJcbiAgICAgIHggPSBldmVudC5wYWdlWFxyXG4gICAgICB5ID0gZXZlbnQucGFnZVlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHggPSBldmVudC5jbGllbnRYICsgYm9keS5zY3JvbGxMZWZ0ICsgZG9jLmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0XHJcbiAgICAgIHkgPSBldmVudC5jbGllbnRZICsgYm9keS5zY3JvbGxUb3AgKyBkb2MuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcFxyXG4gICAgfVxyXG5cclxuICAgIHggLT0gY2FudmFzLm9mZnNldExlZnRcclxuICAgIHkgLT0gY2FudmFzLm9mZnNldFRvcFxyXG5cclxuICAgIHJldHVybiBbeCwgeV1cclxuICB9XHJcblxyXG5cclxuICBpc09uQ2FudmFzKHg6IG51bWJlciwgeTogbnVtYmVyLCBpc1JlbGF0aXZlOmJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgbGV0IGJvZHkgPSB0aGlzLmJvZHlcclxuICAgIGxldCBzY3JvbGxUb3AgPSBib2R5LnNjcm9sbFRvcFxyXG5cclxuICAgIGlmIChpc1JlbGF0aXZlKSB7XHJcbiAgICAgIGlmICh4IDwgMCB8fCB4ID4gdGhpcy53aWR0aCB8fCB5IDwgMCB8fCB5ID4gdGhpcy5oZWlnaHQpIHsgcmV0dXJuIGZhbHNlIH1cclxuICAgICAgZWxzZSB7IHJldHVybiB0cnVlIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICh4IDwgdGhpcy5sZWZ0IHx8IHggPiAodGhpcy5sZWZ0ICsgdGhpcy53aWR0aCkgfHwgeSA8IChzY3JvbGxUb3AgKyB0aGlzLnRvcCkgfHwgeSA+IChzY3JvbGxUb3AgKyB0aGlzLnRvcCArIHRoaXMuaGVpZ2h0KSkgeyByZXR1cm4gZmFsc2UgfVxyXG4gICAgICBlbHNlIHsgcmV0dXJuIHRydWUgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0TWF4V2lkdGgod2lkdGg6IG51bWJlcikge1xyXG4gICAgdGhpcy5tYXhXaWR0aCA9IHdpZHRoXHJcbiAgfVxyXG5cclxuICBzZXRDb2xvcihjb2xvcjogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmNvbG9yID0gY29sb3JcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHNldCB0b29sIGFzIG1vdXNlIHR5cGVcclxuICAgKiBAcGFyYW0gdG9vbCBNb3VzZVR5cGVcclxuICAgKi9cclxuICBzZXRUb29sKHRvb2w6IE1vdXNlVHlwZSkge1xyXG4gICAgdGhpcy5tb3VzZVR5cGUgPSB0b29sXHJcblxyXG4gICAgaWYgKHRvb2wgPT09IE1vdXNlVHlwZS5QRU4pIHtcclxuICAgICAgdGhpcy5zZXRQZW4oKVxyXG4gICAgfSBlbHNlIGlmICh0b29sID09PSBNb3VzZVR5cGUuRVJBU0VSKSB7XHJcbiAgICAgIHRoaXMuc2V0RXJhc2VyKClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldFBlbigpIHtcclxuICAgIChPYmplY3QgYXMgYW55KS5hc3NpZ24odGhpcy5tb3VzZS5zdHlsZSwge1xyXG4gICAgICBib3JkZXJSYWRpdXM6ICcxMDAlJyxcclxuICAgICAgYm9yZGVyOiBgMXB4IHNvbGlkICR7UGhvdG9Db3Zlci5ERUZBVUxUX1BFTl9CT1JERVJfQ09MT1J9YFxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLm1vdXNlVHlwZSA9IE1vdXNlVHlwZS5QRU5cclxuICB9XHJcblxyXG4gIHNldEVyYXNlcigpIHtcclxuICAgIChPYmplY3QgYXMgYW55KS5hc3NpZ24odGhpcy5tb3VzZS5zdHlsZSwge1xyXG4gICAgICBib3JkZXJSYWRpdXM6IDAsXHJcbiAgICAgIGJvcmRlcjogYDFweCBkYXNoZWQgJHtQaG90b0NvdmVyLkRFRkFVTFRfRVJBU0VSX0JPUkRFUl9DT0xPUn1gXHJcbiAgICB9KVxyXG5cclxuICAgIHRoaXMubW91c2VUeXBlID0gTW91c2VUeXBlLkVSQVNFUlxyXG4gIH1cclxuXHJcbiAgdW5kbygpIHtcclxuICAgIGxldCBjdHggPSB0aGlzLmN0eFxyXG4gICAgbGV0IGNvbG9yID0gdGhpcy5jb2xvclxyXG5cclxuICAgIGN0eC5zYXZlKClcclxuXHJcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KVxyXG4gICAgdGhpcy5oaXN0b3JpZXMucG9wKClcclxuXHJcbiAgICB0aGlzLmhpc3Rvcmllcy5tYXAoKHN0ZXBzOiBBcnJheTxhbnk+KSA9PiB7XHJcbiAgICAgIHN0ZXBzLm1hcCgoc3RlcDogQXJyYXk8YW55PikgPT4ge1xyXG4gICAgICAgIGlmIChzdGVwWzBdID09PSBNb3VzZVR5cGUuUEVOKSB7XHJcbiAgICAgICAgICB0aGlzLmNvbG9yID0gc3RlcFsxXVxyXG4gICAgICAgICAgdGhpcy5kcmF3TGluZShzdGVwWzJdLCBzdGVwWzNdLCBzdGVwWzRdKVxyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RlcFswXSA9PT0gTW91c2VUeXBlLkVSQVNFUikge1xyXG4gICAgICAgICAgY3R4LmNsZWFyUmVjdC5hcHBseShjdHgsIHN0ZXAuc2xpY2UoMSkpXHJcbiAgICAgICAgfSBlbHNlIGlmIChzdGVwWzBdID09PSAnTU9WRV9UTycpIHtcclxuICAgICAgICAgIGN0eC5iZWdpblBhdGgoKVxyXG4gICAgICAgICAgY3R4Lm1vdmVUby5hcHBseShjdHgsIHN0ZXAuc2xpY2UoMSkpXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLmNvbG9yID0gY29sb3JcclxuICAgIGN0eC5yZXN0b3JlKClcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBnZXQgaW1hZ2Ugb3JpZ2luIHNpemVcclxuICAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgc3JjICAgICAgaWFtZ2Ugc291cmNlIHVybFxyXG4gICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayBjYWxsYmFjayBmdW5jdGlvbiwgd2lkdGggYXMgZmlyc3QgcGFyYW1ldGVyIGFuZCBoZWlnaHQgYXMgc2Vjb25kXHJcbiAgICogQHJldHVybiB7dW5kZWZpbmVkfVxyXG4gICAqL1xyXG4gIGdldEltYWdlT3JpZ2luU2l6ZShzcmM6IHN0cmluZywgY2FsbGJhY2s/OiBGdW5jdGlvbikge1xyXG4gICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpXHJcblxyXG4gICAgaW1nLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgbGV0IHdpZHRoID0gaW1nLndpZHRoXHJcbiAgICAgIGxldCBoZWlnaHQgPSBpbWcuaGVpZ2h0XHJcblxyXG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh3aWR0aCwgaGVpZ2h0KVxyXG4gICAgfVxyXG5cclxuICAgIGltZy5zcmMgPSBzcmNcclxuICB9XHJcblxyXG4gIGdldERhdGFVUkwodHlwZSA9ICdpbWFnZS9qcGVnJywgcXVhbGl0eSA9IDAuOCwgY2FsbGJhY2s/OiBGdW5jdGlvbikge1xyXG5cclxuICAgIGxldCBzcmMgPSB0aGlzLmltZy5zcmNcclxuXHJcbiAgICB0aGlzLmdldEltYWdlT3JpZ2luU2l6ZShzcmMsICh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikgPT4ge1xyXG4gICAgICBsZXQgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpXHJcbiAgICAgIHRlbXBDYW52YXMud2lkdGggPSB3aWR0aFxyXG4gICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IGhlaWdodFxyXG4gICAgICBsZXQgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxyXG4gICAgICBpZiAodGVtcEN0eCkge1xyXG4gICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKHRoaXMuaW1nLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KVxyXG4gICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKHRoaXMuY2FudmFzLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KVxyXG5cclxuICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh0ZW1wQ2FudmFzLnRvRGF0YVVSTCh0eXBlLCBxdWFsaXR5KSlcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHJlbW92ZSBkb20gdGhhdCBhZGRlZCBpbnRvIGJvZHksXHJcbiAgICogcmVtb3ZlIGFsbCBldmVudHMgdGhhdCByZWdpc3RlcmVkXHJcbiAgICovXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIHRoaXMuY2FudmFzLnBhcmVudE5vZGUgJiYgdGhpcy5jYW52YXMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmNhbnZhcylcclxuICAgIHRoaXMubW91c2UucGFyZW50Tm9kZSAmJiB0aGlzLm1vdXNlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5tb3VzZSlcclxuXHJcbiAgICB0aGlzLmltZy5zcmMgPSAnJ1xyXG5cclxuICAgIHRoaXMuYmluZGVkRXZlbnRzLmZvckVhY2godiA9PiB7XHJcbiAgICAgIHZbMF0ucmVtb3ZlRXZlbnRMaXN0ZW5lcih2WzFdLCB2WzJdLCBmYWxzZSlcclxuICAgIH0pXHJcbiAgICAvLyBkZWxldGUgdGhpc1xyXG4gIH1cclxufVxyXG4iXX0=
