var MouseType;
(function (MouseType) {
    MouseType[MouseType["PEN"] = 0] = "PEN";
    MouseType[MouseType["ERASER"] = 1] = "ERASER";
})(MouseType || (MouseType = {}));
var PhotoCover = (function () {
    function PhotoCover(selector) {
        this.isMobile = navigator.userAgent.indexOf('iPhone') > -1 || navigator.userAgent.indexOf('Android') > -1;
        // Window | DOM
        this.win = window;
        this.doc = document;
        this.body = document.body;
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');
        // init value
        this.mouseType = MouseType.PEN;
        this.radius = PhotoCover.DEFAULT_RADIUS;
        this.maxWidth = PhotoCover.DEFAULT_MAX_WIDTH;
        this.color = PhotoCover.DEFAULT_COLOR;
        this.linecap = PhotoCover.DEFAULT_LINECAP;
        this.operateHistories = [];
        this.registeredEvents = [];
        if (typeof selector === 'object') {
            this.img = selector;
        }
        else if (typeof selector === 'string') {
            this.img = document.querySelector(selector);
        }
        // initial canvas and its size and position
        this.width = this.img.width;
        this.height = this.img.height;
        this.init();
    }
    PhotoCover.prototype.init = function () {
        var _this = this;
        var _a = [this.body, this.win, this.img], body = _a[0], win = _a[1], img = _a[2];
        this.async();
        this.canvas.width = img.width;
        this.canvas.height = img.height;
        body.appendChild(this.canvas);
        if (!this.isMobile) {
            this.initMouse();
        }
        // async canvas position and size during browser resize
        var resize = (function (e) {
            _this.async();
        }).bind(this);
        win.addEventListener('resize', resize, false);
        this.pushRegisteredEvents(win, 'resize', resize);
        var currentOperate = [];
        var canvasMouseDown = (function (e) {
            e.preventDefault();
            var _a = _this.getCoordinateByEvent(e), x = _a[0], y = _a[1];
            _this.ctx.moveTo(x, y);
            currentOperate = [];
            if (_this.isOnCanvas(x, y, true)) {
                _this.ctx.beginPath();
                currentOperate.push(['MOVE_TO', x, y]);
                if (!_this.isMobile) {
                    win.addEventListener('mousemove', canvasMouseMove, false);
                }
                else {
                    win.addEventListener('touchmove', canvasMouseMove, false);
                }
            }
        }).bind(this);
        var canvasMouseMove = (function (e) {
            e.preventDefault();
            currentOperate.push(_this.drawByEvent(e));
        }).bind(this);
        var canvasMouseUp = (function (e) {
            e.preventDefault();
            if (!_this.isMobile) {
                win.removeEventListener('mousemove', canvasMouseMove, false);
            }
            else {
                win.removeEventListener('touchmove', canvasMouseMove, false);
            }
            var coordinate = _this.getCoordinateByEvent(e);
            var _a = [e.pageX, e.pageY], x = _a[0], y = _a[1];
            if (_this.isOnCanvas(x, y)) {
                _this.operateHistories.push(currentOperate);
                currentOperate = [];
                console.log(_this.operateHistories);
            }
        }).bind(this);
        // canvas down
        if (!this.isMobile) {
            win.addEventListener('mousedown', canvasMouseDown, false);
            this.pushRegisteredEvents(win, 'mousedown', canvasMouseDown);
            win.addEventListener('mouseup', canvasMouseUp, false);
            this.pushRegisteredEvents(win, 'mouseup', canvasMouseUp);
        }
        else {
            win.addEventListener('touchstart', canvasMouseDown, false);
            this.pushRegisteredEvents(win, 'touchstart', canvasMouseDown);
            win.addEventListener('touchend', canvasMouseUp, false);
            this.pushRegisteredEvents(win, 'touchend', canvasMouseUp);
        }
    };
    // async x and y from image to canvas
    PhotoCover.prototype.async = function () {
        var coordinate = this.img.getBoundingClientRect();
        this.top = coordinate.top;
        this.left = coordinate.left;
        this.canvas.style.cssText = "\n      position: absolute;\n      left: " + (this.left + this.body.scrollLeft) + "px;\n      top: " + (this.top + this.body.scrollTop) + "px;\n      use-select: none;\n    ";
    };
    /**
     * save binds events
     * @param  {DOM} _element  DOM that you bind event
     * @param  {String} _event  event name
     * @param  {Function} _function event function
     * @return {Boolean} true when save success
     */
    PhotoCover.prototype.pushRegisteredEvents = function (_element, _event, _function) {
        this.registeredEvents.push({
            'element': _element,
            'event': _event,
            'function': _function
        });
        return true;
    };
    // initial mouse shape where mouse on canvas
    PhotoCover.prototype.initMouse = function (type) {
        var _this = this;
        var _a = [this.body, this.win], body = _a[0], win = _a[1];
        var mouse = document.createElement('div');
        mouse.style.cssText = "\n      display: none;\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 10001;\n      width: " + this.radius * 2 + "px;\n      height: " + this.radius * 2 + "px;\n      border: 1px solid red;\n      border-radius: 100%;\n    ";
        this.mouse = mouse;
        body.appendChild(mouse);
        var mouseMove = (function (e) {
            var _a = [e.pageX, e.pageY], x = _a[0], y = _a[1];
            var isOnCanvas = _this.isOnCanvas(x, y);
            mouse.style.transform = "translate(" + (x - _this.radius) + "px, " + (y - _this.radius) + "px)";
            if (!isOnCanvas) {
                mouse.style.display = 'none';
                body.style.cursor = 'default';
            }
            else {
                mouse.style.display = 'block';
                body.style.cursor = 'none';
            }
        }).bind(this);
        // change mouse style
        if (!this.isMobile) {
            win.addEventListener('mousemove', mouseMove, false);
            this.pushRegisteredEvents(win, 'mousemove', mouseMove);
        }
        else {
            win.addEventListener('touchmove', mouseMove, false);
            this.pushRegisteredEvents(win, 'touchmove', mouseMove);
        }
    };
    PhotoCover.prototype.setRadius = function (radius) {
        if (radius < 2 || radius > 100) {
            return;
        }
        var mouse = this.mouse;
        this.radius = radius;
        mouse.style.width = radius * 2 + 'px';
        mouse.style.height = radius * 2 + 'px';
    };
    PhotoCover.prototype.zoomIn = function (radius) {
        if (radius === void 0) { radius = 2; }
        this.setRadius(this.radius + radius);
    };
    PhotoCover.prototype.zoomOut = function (radius) {
        if (radius === void 0) { radius = 2; }
        this.setRadius(this.radius - radius);
    };
    PhotoCover.prototype.drawCircle = function (x, y, radius) {
        var ctx = this.ctx;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(x + 1, y + 1, radius || this.radius, 0, 360);
        ctx.fill();
        ctx.closePath();
    };
    PhotoCover.prototype.drawLine = function (x, y, radius) {
        var ctx = this.ctx;
        ctx.lineCap = this.linecap;
        ctx.lineJoin = 'round';
        ctx.strokeStyle = this.color;
        ctx.lineWidth = (radius || this.radius) * 2;
        ctx.lineTo(x, y);
        ctx.stroke();
    };
    PhotoCover.prototype.getCoordinateByEvent = function (event) {
        var x, y;
        var _a = [this.doc, this.body], doc = _a[0], body = _a[1];
        var canvas = this.canvas;
        if (this.isMobile) {
            event = event.changedTouches[0];
        }
        if (event.pageX || event.pageY) {
            x = event.pageX;
            y = event.pageY;
        }
        else {
            x = event.clientX + body.scrollLeft + doc.documentElement.scrollLeft;
            y = event.clientY + body.scrollTop + doc.documentElement.scrollTop;
        }
        x -= canvas.offsetLeft;
        y -= canvas.offsetTop;
        return [x, y];
    };
    PhotoCover.prototype.drawByEvent = function (event) {
        var ctx = this.ctx;
        var _a = this.getCoordinateByEvent(event), x = _a[0], y = _a[1];
        if (this.mouseType === MouseType.PEN) {
            this.drawLine(x, y);
            return [MouseType.PEN, this.color, x, y, this.radius];
        }
        else if (this.mouseType === MouseType.ERASER) {
            x -= this.radius;
            y -= this.radius;
            var _b = [this.radius * 2, this.radius * 2], w = _b[0], h = _b[1];
            ctx.clearRect(x, y, w, h);
            return [MouseType.ERASER, x, y, w, h];
        }
        else {
            return [];
        }
    };
    PhotoCover.prototype.isOnCanvas = function (x, y, isRelative) {
        if (isRelative === void 0) { isRelative = false; }
        var body = this.body;
        var scrollTop = body.scrollTop;
        if (isRelative) {
            if (x < 0 || x > this.width || y < 0 || y > this.height) {
                return false;
            }
            else {
                return true;
            }
        }
        else {
            if (x < this.left || x > (this.left + this.width) || y < (scrollTop + this.top) || y > (scrollTop + this.top + this.height)) {
                return false;
            }
            else {
                return true;
            }
        }
    };
    PhotoCover.prototype.setMaxWidth = function (width) {
        this.maxWidth = width;
    };
    PhotoCover.prototype.setColor = function (color) {
        this.color = color;
    };
    /**
     * set tool as mouse type
     * @param tool MouseType
     */
    PhotoCover.prototype.setTool = function (tool) {
        this.mouseType = tool;
        if (tool === MouseType.PEN) {
            this.setPen();
        }
        else if (tool === MouseType.ERASER) {
            this.setEraser();
        }
    };
    PhotoCover.prototype.setPen = function () {
        Object.assign(this.mouse.style, {
            borderRadius: '100%',
            border: "1px solid " + PhotoCover.DEFAULT_PEN_BORDER_COLOR
        });
        this.mouseType = MouseType.PEN;
    };
    PhotoCover.prototype.setEraser = function () {
        Object.assign(this.mouse.style, {
            borderRadius: 0,
            border: "1px dashed " + PhotoCover.DEFAULT_ERASER_BORDER_COLOR
        });
        this.mouseType = MouseType.ERASER;
    };
    PhotoCover.prototype.undo = function () {
        var _this = this;
        var ctx = this.ctx;
        var color = this.color;
        ctx.save();
        ctx.clearRect(0, 0, this.width, this.height);
        this.operateHistories.pop();
        this.operateHistories.map(function (steps) {
            steps.map(function (step) {
                if (step[0] === MouseType.PEN) {
                    _this.color = step[1];
                    _this.drawLine(step[2], step[3], step[4]);
                }
                else if (step[0] === MouseType.ERASER) {
                    ctx.clearRect.apply(ctx, step.slice(1));
                }
                else if (step[0] === 'MOVE_TO') {
                    ctx.beginPath();
                    ctx.moveTo.apply(ctx, step.slice(1));
                }
            });
        });
        console.log(this.operateHistories.length);
        this.color = color;
        ctx.restore();
    };
    /**
     * get image origin size
     * @param  {String}   src      iamge source url
     * @param  {Function} callback callback function, width as first parameter and height as second
     * @return {undefined}
     */
    PhotoCover.prototype.getImageOriginSize = function (src, callback) {
        var img = new Image();
        img.onload = function () {
            var width = img.width;
            var height = img.height;
            callback && callback(width, height);
        };
        img.src = src;
    };
    PhotoCover.prototype.getDataURL = function (type, quality, callback) {
        var _this = this;
        if (type === void 0) { type = 'image/jpeg'; }
        if (quality === void 0) { quality = 0.8; }
        var src = this.img.src;
        this.getImageOriginSize(src, function (width, height) {
            var tempCanvas = document.createElement('canvas');
            tempCanvas.width = width;
            tempCanvas.height = height;
            var tempCtx = tempCanvas.getContext('2d');
            if (tempCtx) {
                tempCtx.drawImage(_this.img, 0, 0, width, height);
                tempCtx.drawImage(_this.canvas, 0, 0, width, height);
                callback && callback(tempCanvas.toDataURL(type, quality));
            }
        });
    };
    /**
     * remove dom that added into body,
     * remove all events that registered
     */
    PhotoCover.prototype.destroy = function () {
        this.canvas.parentNode && this.canvas.parentNode.removeChild(this.canvas);
        this.mouse.parentNode && this.mouse.parentNode.removeChild(this.mouse);
        this.img.src = '';
        this.registeredEvents.forEach(function (v) {
            v.element.removeEventListener(v.event, v["function"], false);
        });
        // delete this
    };
    PhotoCover.DEFAULT_RADIUS = 20;
    PhotoCover.DEFAULT_MAX_WIDTH = 800;
    PhotoCover.DEFAULT_COLOR = 'black';
    PhotoCover.DEFAULT_PEN_BORDER_COLOR = 'red';
    PhotoCover.DEFAULT_ERASER_BORDER_COLOR = '#666';
    PhotoCover.DEFAULT_LINECAP = 'round';
    return PhotoCover;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,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TUFBTSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ3pFLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7UUFFdEUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFBO1FBRWpCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsVUFBQSxDQUFDO1lBQzdCLENBQUMsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsVUFBUSxDQUFBLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDM0QsQ0FBQyxDQUFDLENBQUE7UUFDRixjQUFjO0lBQ2hCLENBQUM7SUFoYU0seUJBQWMsR0FBVSxFQUFFLENBQUE7SUFDMUIsNEJBQWlCLEdBQVUsR0FBRyxDQUFBO0lBQzlCLHdCQUFhLEdBQVcsT0FBTyxDQUFBO0lBQy9CLG1DQUF3QixHQUFXLEtBQUssQ0FBQTtJQUN4QyxzQ0FBMkIsR0FBVSxNQUFNLENBQUE7SUFDM0MsMEJBQWUsR0FBVyxPQUFPLENBQUE7SUE0WjFDLGlCQUFDO0NBbGFELEFBa2FDLElBQUEiLCJmaWxlIjoicGhvdG9jb3Zlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImVudW0gTW91c2VUeXBlIHsgUEVOLCBFUkFTRVIgfVxyXG5cclxuY2xhc3MgUGhvdG9Db3ZlciB7XHJcbiAgc3RhdGljIERFRkFVTFRfUkFESVVTOm51bWJlciA9IDIwXHJcbiAgc3RhdGljIERFRkFVTFRfTUFYX1dJRFRIOm51bWJlciA9IDgwMFxyXG4gIHN0YXRpYyBERUZBVUxUX0NPTE9SOiBzdHJpbmcgPSAnYmxhY2snXHJcbiAgc3RhdGljIERFRkFVTFRfUEVOX0JPUkRFUl9DT0xPUjogc3RyaW5nID0gJ3JlZCdcclxuICBzdGF0aWMgREVGQVVMVF9FUkFTRVJfQk9SREVSX0NPTE9SOnN0cmluZyA9ICcjNjY2J1xyXG4gIHN0YXRpYyBERUZBVUxUX0xJTkVDQVA6IHN0cmluZyA9ICdyb3VuZCdcclxuXHJcbiAgcmVhZG9ubHkgaXNNb2JpbGUgPSBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ2lQaG9uZScpID4gLTEgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdBbmRyb2lkJykgPiAtMVxyXG5cclxuICAvLyBXaW5kb3cgfCBET01cclxuICB3aW46IFdpbmRvdyA9IHdpbmRvd1xyXG4gIGRvYzogSFRNTERvY3VtZW50ID0gZG9jdW1lbnRcclxuICBib2R5OiBIVE1MRWxlbWVudCA9IGRvY3VtZW50LmJvZHlcclxuICBtb3VzZTogSFRNTERpdkVsZW1lbnQgXHJcbiAgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpXHJcbiAgaW1nOiBIVE1MSW1hZ2VFbGVtZW50IFxyXG5cclxuICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJykgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEXHJcblxyXG4gIHdpZHRoOiBudW1iZXJcclxuICBoZWlnaHQ6IG51bWJlclxyXG4gIGxlZnQ6IG51bWJlclxyXG4gIHRvcDogbnVtYmVyXHJcblxyXG4gIC8vIGluaXQgdmFsdWVcclxuICBtb3VzZVR5cGU6IE1vdXNlVHlwZSA9IE1vdXNlVHlwZS5QRU5cclxuICByYWRpdXMgPSAgUGhvdG9Db3Zlci5ERUZBVUxUX1JBRElVU1xyXG4gIG1heFdpZHRoID0gUGhvdG9Db3Zlci5ERUZBVUxUX01BWF9XSURUSFxyXG4gIGNvbG9yID0gUGhvdG9Db3Zlci5ERUZBVUxUX0NPTE9SXHJcbiAgbGluZWNhcCA9IFBob3RvQ292ZXIuREVGQVVMVF9MSU5FQ0FQXHJcblxyXG4gIG9wZXJhdGVIaXN0b3JpZXM6IEFycmF5PEFycmF5PGFueT4+ID0gW11cclxuICByZWdpc3RlcmVkRXZlbnRzOiBBcnJheTxhbnk+ID0gW11cclxuXHJcbiAgY29uc3RydWN0b3Ioc2VsZWN0b3I6IEhUTUxJbWFnZUVsZW1lbnQgfCBzdHJpbmcpIHtcclxuXHJcbiAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnb2JqZWN0JykgeyB0aGlzLmltZyA9IHNlbGVjdG9yIH1cclxuICAgIGVsc2UgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHsgdGhpcy5pbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSBhcyBIVE1MSW1hZ2VFbGVtZW50IH1cclxuICAgIFxyXG4gICAgLy8gaW5pdGlhbCBjYW52YXMgYW5kIGl0cyBzaXplIGFuZCBwb3NpdGlvblxyXG4gICAgdGhpcy53aWR0aCA9IHRoaXMuaW1nLndpZHRoXHJcbiAgICB0aGlzLmhlaWdodCA9IHRoaXMuaW1nLmhlaWdodFxyXG5cclxuICAgIHRoaXMuaW5pdCgpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluaXQoKTogdm9pZCB7XHJcblxyXG4gICAgbGV0IFtib2R5LCB3aW4sIGltZ10gPSBbdGhpcy5ib2R5LCB0aGlzLndpbiwgdGhpcy5pbWddXHJcblxyXG4gICAgdGhpcy5hc3luYygpXHJcblxyXG4gICAgdGhpcy5jYW52YXMud2lkdGggPSBpbWcud2lkdGhcclxuICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHRcclxuXHJcbiAgICBib2R5LmFwcGVuZENoaWxkKHRoaXMuY2FudmFzKVxyXG5cclxuICAgIGlmICghdGhpcy5pc01vYmlsZSkgeyB0aGlzLmluaXRNb3VzZSgpIH1cclxuXHJcbiAgICAvLyBhc3luYyBjYW52YXMgcG9zaXRpb24gYW5kIHNpemUgZHVyaW5nIGJyb3dzZXIgcmVzaXplXHJcbiAgICBsZXQgcmVzaXplID0gKChlOiBhbnkpID0+IHtcclxuICAgICAgdGhpcy5hc3luYygpXHJcbiAgICB9KS5iaW5kKHRoaXMpXHJcbiAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgcmVzaXplLCBmYWxzZSlcclxuICAgIHRoaXMucHVzaFJlZ2lzdGVyZWRFdmVudHMod2luLCAncmVzaXplJywgcmVzaXplKVxyXG5cclxuXHJcbiAgICBsZXQgY3VycmVudE9wZXJhdGU6IEFycmF5PEFycmF5PGFueT4+ID0gW11cclxuXHJcbiAgICBsZXQgY2FudmFzTW91c2VEb3duID0gKChlOiBhbnkpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXHJcblxyXG4gICAgICBjb25zdCBbeCwgeV0gPSB0aGlzLmdldENvb3JkaW5hdGVCeUV2ZW50KGUpXHJcbiAgICAgIHRoaXMuY3R4Lm1vdmVUbyh4LCB5KVxyXG5cclxuICAgICAgY3VycmVudE9wZXJhdGUgPSBbXVxyXG5cclxuICAgICAgaWYgKHRoaXMuaXNPbkNhbnZhcyh4LCB5LCB0cnVlKSkge1xyXG5cclxuICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKVxyXG4gICAgICAgIGN1cnJlbnRPcGVyYXRlLnB1c2goWydNT1ZFX1RPJywgeCwgeV0pXHJcblxyXG4gICAgICAgIGlmICghdGhpcy5pc01vYmlsZSkgeyB3aW4uYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgY2FudmFzTW91c2VNb3ZlLCBmYWxzZSkgfVxyXG4gICAgICAgIGVsc2UgeyB3aW4uYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgY2FudmFzTW91c2VNb3ZlLCBmYWxzZSkgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgfSkuYmluZCh0aGlzKVxyXG5cclxuICAgIGxldCBjYW52YXNNb3VzZU1vdmUgPSAoKGU6IGFueSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcclxuICAgICAgY3VycmVudE9wZXJhdGUucHVzaCh0aGlzLmRyYXdCeUV2ZW50KGUpKVxyXG4gICAgfSkuYmluZCh0aGlzKVxyXG5cclxuICAgIGxldCBjYW52YXNNb3VzZVVwID0gKChlOiBhbnkpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXHJcblxyXG4gICAgICBpZiAoIXRoaXMuaXNNb2JpbGUpIHsgd2luLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGNhbnZhc01vdXNlTW92ZSwgZmFsc2UpIH1cclxuICAgICAgZWxzZSB7IHdpbi5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBjYW52YXNNb3VzZU1vdmUsIGZhbHNlKSB9XHJcbiAgICAgIFxyXG4gICAgICBsZXQgY29vcmRpbmF0ZSA9IHRoaXMuZ2V0Q29vcmRpbmF0ZUJ5RXZlbnQoZSlcclxuICAgICAgbGV0IFt4LCB5XSA9IFtlLnBhZ2VYLCBlLnBhZ2VZXVxyXG5cclxuICAgICAgaWYgKHRoaXMuaXNPbkNhbnZhcyh4LCB5KSkge1xyXG4gICAgICAgIHRoaXMub3BlcmF0ZUhpc3Rvcmllcy5wdXNoKGN1cnJlbnRPcGVyYXRlKVxyXG4gICAgICAgIGN1cnJlbnRPcGVyYXRlID0gW11cclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLm9wZXJhdGVIaXN0b3JpZXMpXHJcbiAgICAgIH1cclxuICAgIH0pLmJpbmQodGhpcylcclxuXHJcbiAgICAvLyBjYW52YXMgZG93blxyXG4gICAgaWYgKCF0aGlzLmlzTW9iaWxlKSB7XHJcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBjYW52YXNNb3VzZURvd24sIGZhbHNlKVxyXG4gICAgICB0aGlzLnB1c2hSZWdpc3RlcmVkRXZlbnRzKHdpbiwgJ21vdXNlZG93bicsIGNhbnZhc01vdXNlRG93bilcclxuXHJcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgY2FudmFzTW91c2VVcCwgZmFsc2UpXHJcbiAgICAgIHRoaXMucHVzaFJlZ2lzdGVyZWRFdmVudHMod2luLCAnbW91c2V1cCcsIGNhbnZhc01vdXNlVXApIFxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBjYW52YXNNb3VzZURvd24sIGZhbHNlKVxyXG4gICAgICB0aGlzLnB1c2hSZWdpc3RlcmVkRXZlbnRzKHdpbiwgJ3RvdWNoc3RhcnQnLCBjYW52YXNNb3VzZURvd24pXHJcblxyXG4gICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBjYW52YXNNb3VzZVVwLCBmYWxzZSlcclxuICAgICAgdGhpcy5wdXNoUmVnaXN0ZXJlZEV2ZW50cyh3aW4sICd0b3VjaGVuZCcsIGNhbnZhc01vdXNlVXApXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBhc3luYyB4IGFuZCB5IGZyb20gaW1hZ2UgdG8gY2FudmFzXHJcbiAgcHJpdmF0ZSBhc3luYygpIHtcclxuICAgIGxldCBjb29yZGluYXRlID0gdGhpcy5pbWcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcclxuICAgIHRoaXMudG9wID0gY29vcmRpbmF0ZS50b3BcclxuICAgIHRoaXMubGVmdCA9IGNvb3JkaW5hdGUubGVmdFxyXG5cclxuICAgIHRoaXMuY2FudmFzLnN0eWxlLmNzc1RleHQgPSBgXHJcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICAgICAgbGVmdDogJHt0aGlzLmxlZnQgKyB0aGlzLmJvZHkuc2Nyb2xsTGVmdH1weDtcclxuICAgICAgdG9wOiAke3RoaXMudG9wICsgdGhpcy5ib2R5LnNjcm9sbFRvcH1weDtcclxuICAgICAgdXNlLXNlbGVjdDogbm9uZTtcclxuICAgIGBcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHNhdmUgYmluZHMgZXZlbnRzXHJcbiAgICogQHBhcmFtICB7RE9NfSBfZWxlbWVudCAgRE9NIHRoYXQgeW91IGJpbmQgZXZlbnRcclxuICAgKiBAcGFyYW0gIHtTdHJpbmd9IF9ldmVudCAgZXZlbnQgbmFtZVxyXG4gICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBfZnVuY3Rpb24gZXZlbnQgZnVuY3Rpb25cclxuICAgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlIHdoZW4gc2F2ZSBzdWNjZXNzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwdXNoUmVnaXN0ZXJlZEV2ZW50cyhfZWxlbWVudDogV2luZG93IHwgTm9kZSwgX2V2ZW50OiBhbnksIF9mdW5jdGlvbjogRnVuY3Rpb24pIHtcclxuXHJcbiAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMucHVzaCh7XHJcbiAgICAgICdlbGVtZW50JzogX2VsZW1lbnQsXHJcbiAgICAgICdldmVudCc6IF9ldmVudCxcclxuICAgICAgJ2Z1bmN0aW9uJzogX2Z1bmN0aW9uXHJcbiAgICB9KVxyXG5cclxuICAgIHJldHVybiB0cnVlXHJcblxyXG4gIH1cclxuXHJcbiAgLy8gaW5pdGlhbCBtb3VzZSBzaGFwZSB3aGVyZSBtb3VzZSBvbiBjYW52YXNcclxuICBwcml2YXRlIGluaXRNb3VzZSh0eXBlPzogc3RyaW5nKSB7XHJcbiAgICBsZXQgW2JvZHksIHdpbl0gPSBbdGhpcy5ib2R5LCB0aGlzLndpbl1cclxuICAgIGxldCBtb3VzZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXHJcbiAgICBtb3VzZS5zdHlsZS5jc3NUZXh0ID0gYFxyXG4gICAgICBkaXNwbGF5OiBub25lO1xyXG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XHJcbiAgICAgIGxlZnQ6IDA7XHJcbiAgICAgIHRvcDogMDtcclxuICAgICAgei1pbmRleDogMTAwMDE7XHJcbiAgICAgIHdpZHRoOiAke3RoaXMucmFkaXVzICogMn1weDtcclxuICAgICAgaGVpZ2h0OiAke3RoaXMucmFkaXVzICogMn1weDtcclxuICAgICAgYm9yZGVyOiAxcHggc29saWQgcmVkO1xyXG4gICAgICBib3JkZXItcmFkaXVzOiAxMDAlO1xyXG4gICAgYFxyXG4gICAgdGhpcy5tb3VzZSA9IG1vdXNlXHJcblxyXG4gICAgYm9keS5hcHBlbmRDaGlsZChtb3VzZSlcclxuXHJcbiAgICBsZXQgbW91c2VNb3ZlID0gKChlOiBhbnkpID0+IHtcclxuICAgICAgbGV0IFt4LCB5XSA9IFtlLnBhZ2VYLCBlLnBhZ2VZXVxyXG4gICAgICBsZXQgaXNPbkNhbnZhcyA9IHRoaXMuaXNPbkNhbnZhcyh4LCB5KVxyXG5cclxuICAgICAgbW91c2Uuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3ggLSB0aGlzLnJhZGl1c31weCwgJHt5IC0gdGhpcy5yYWRpdXN9cHgpYFxyXG5cclxuICAgICAgaWYgKCFpc09uQ2FudmFzKSB7XHJcbiAgICAgICAgbW91c2Uuc3R5bGUuZGlzcGxheSA9ICdub25lJ1xyXG4gICAgICAgIGJvZHkuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbW91c2Uuc3R5bGUuZGlzcGxheSA9ICdibG9jaydcclxuICAgICAgICBib2R5LnN0eWxlLmN1cnNvciA9ICdub25lJ1xyXG4gICAgICB9XHJcbiAgICB9KS5iaW5kKHRoaXMpXHJcblxyXG4gICAgLy8gY2hhbmdlIG1vdXNlIHN0eWxlXHJcbiAgICBpZiAoIXRoaXMuaXNNb2JpbGUpIHtcclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG1vdXNlTW92ZSwgZmFsc2UpXHJcbiAgICAgIHRoaXMucHVzaFJlZ2lzdGVyZWRFdmVudHMod2luLCAnbW91c2Vtb3ZlJywgbW91c2VNb3ZlKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIG1vdXNlTW92ZSwgZmFsc2UpXHJcbiAgICAgIHRoaXMucHVzaFJlZ2lzdGVyZWRFdmVudHMod2luLCAndG91Y2htb3ZlJywgbW91c2VNb3ZlKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0UmFkaXVzKHJhZGl1czogbnVtYmVyKSB7XHJcbiAgICBpZiAocmFkaXVzIDwgMiB8fCByYWRpdXMgPiAxMDApIHtcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgbGV0IG1vdXNlID0gdGhpcy5tb3VzZVxyXG4gICAgdGhpcy5yYWRpdXMgPSByYWRpdXNcclxuXHJcbiAgICBtb3VzZS5zdHlsZS53aWR0aCA9IHJhZGl1cyAqIDIgKyAncHgnXHJcbiAgICBtb3VzZS5zdHlsZS5oZWlnaHQgPSByYWRpdXMgKiAyICsgJ3B4J1xyXG4gIH1cclxuXHJcbiAgem9vbUluKHJhZGl1cyA9IDIpIHtcclxuICAgIHRoaXMuc2V0UmFkaXVzKHRoaXMucmFkaXVzICsgcmFkaXVzKVxyXG4gIH1cclxuXHJcbiAgem9vbU91dChyYWRpdXMgPSAyKSB7XHJcbiAgICB0aGlzLnNldFJhZGl1cyh0aGlzLnJhZGl1cyAtIHJhZGl1cylcclxuICB9XHJcblxyXG4gIGRyYXdDaXJjbGUoeDogbnVtYmVyLCB5OiBudW1iZXIsIHJhZGl1cz86IG51bWJlcikge1xyXG4gICAgbGV0IGN0eCA9IHRoaXMuY3R4XHJcbiAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5jb2xvcjtcclxuICAgIGN0eC5iZWdpblBhdGgoKVxyXG4gICAgY3R4LmFyYyh4ICsgMSwgeSArIDEsIHJhZGl1cyB8fCB0aGlzLnJhZGl1cywgMCwgMzYwKVxyXG4gICAgY3R4LmZpbGwoKVxyXG4gICAgY3R4LmNsb3NlUGF0aCgpXHJcbiAgfVxyXG5cclxuICBkcmF3TGluZSh4OiBudW1iZXIsIHk6IG51bWJlciwgcmFkaXVzPzogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBjdHggPSB0aGlzLmN0eFxyXG5cclxuICAgIGN0eC5saW5lQ2FwID0gdGhpcy5saW5lY2FwXHJcbiAgICBjdHgubGluZUpvaW4gPSAncm91bmQnXHJcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yXHJcbiAgICBjdHgubGluZVdpZHRoID0gKHJhZGl1cyB8fCB0aGlzLnJhZGl1cykgKiAyXHJcbiAgICBjdHgubGluZVRvKHgsIHkpXHJcbiAgICBjdHguc3Ryb2tlKClcclxuICB9XHJcblxyXG5cclxuICBnZXRDb29yZGluYXRlQnlFdmVudChldmVudDogYW55KSB7XHJcbiAgICBsZXQgeCwgeVxyXG4gICAgbGV0IFtkb2MsIGJvZHldID0gW3RoaXMuZG9jLCB0aGlzLmJvZHldXHJcbiAgICBsZXQgY2FudmFzID0gdGhpcy5jYW52YXNcclxuXHJcbiAgICBpZiAodGhpcy5pc01vYmlsZSkgeyBldmVudCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdIH1cclxuXHJcbiAgICBpZiAoZXZlbnQucGFnZVggfHwgZXZlbnQucGFnZVkpIHtcclxuICAgICAgeCA9IGV2ZW50LnBhZ2VYXHJcbiAgICAgIHkgPSBldmVudC5wYWdlWVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgeCA9IGV2ZW50LmNsaWVudFggKyBib2R5LnNjcm9sbExlZnQgKyBkb2MuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnRcclxuICAgICAgeSA9IGV2ZW50LmNsaWVudFkgKyBib2R5LnNjcm9sbFRvcCArIGRvYy5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wXHJcbiAgICB9XHJcblxyXG4gICAgeCAtPSBjYW52YXMub2Zmc2V0TGVmdFxyXG4gICAgeSAtPSBjYW52YXMub2Zmc2V0VG9wXHJcblxyXG4gICAgcmV0dXJuIFt4LCB5XVxyXG4gIH1cclxuXHJcbiAgZHJhd0J5RXZlbnQoZXZlbnQ6IGFueSk6IEFycmF5PGFueT4ge1xyXG4gICAgbGV0IGN0eCA9IHRoaXMuY3R4XHJcbiAgICBsZXQgW3gsIHldID0gdGhpcy5nZXRDb29yZGluYXRlQnlFdmVudChldmVudClcclxuXHJcbiAgICBpZiAodGhpcy5tb3VzZVR5cGUgPT09IE1vdXNlVHlwZS5QRU4pIHtcclxuICAgICAgdGhpcy5kcmF3TGluZSh4LCB5KVxyXG4gICAgICByZXR1cm4gW01vdXNlVHlwZS5QRU4sIHRoaXMuY29sb3IsIHgsIHksIHRoaXMucmFkaXVzXVxyXG4gICAgfSBlbHNlIGlmICh0aGlzLm1vdXNlVHlwZSA9PT0gTW91c2VUeXBlLkVSQVNFUikge1xyXG4gICAgICB4IC09IHRoaXMucmFkaXVzXHJcbiAgICAgIHkgLT0gdGhpcy5yYWRpdXNcclxuICAgICAgbGV0IFt3LCBoXSA9IFt0aGlzLnJhZGl1cyAqIDIsIHRoaXMucmFkaXVzICogMl1cclxuICAgICAgY3R4LmNsZWFyUmVjdCh4LCB5LCB3LCBoKVxyXG4gICAgICByZXR1cm4gW01vdXNlVHlwZS5FUkFTRVIsIHgsIHksIHcsIGhdXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gW11cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlzT25DYW52YXMoeDogbnVtYmVyLCB5OiBudW1iZXIsIGlzUmVsYXRpdmU6Ym9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICBsZXQgYm9keSA9IHRoaXMuYm9keVxyXG4gICAgbGV0IHNjcm9sbFRvcCA9IGJvZHkuc2Nyb2xsVG9wXHJcblxyXG4gICAgaWYgKGlzUmVsYXRpdmUpIHtcclxuICAgICAgaWYgKHggPCAwIHx8IHggPiB0aGlzLndpZHRoIHx8IHkgPCAwIHx8IHkgPiB0aGlzLmhlaWdodCkgeyByZXR1cm4gZmFsc2UgfVxyXG4gICAgICBlbHNlIHsgcmV0dXJuIHRydWUgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHggPCB0aGlzLmxlZnQgfHwgeCA+ICh0aGlzLmxlZnQgKyB0aGlzLndpZHRoKSB8fCB5IDwgKHNjcm9sbFRvcCArIHRoaXMudG9wKSB8fCB5ID4gKHNjcm9sbFRvcCArIHRoaXMudG9wICsgdGhpcy5oZWlnaHQpKSB7IHJldHVybiBmYWxzZSB9XHJcbiAgICAgIGVsc2UgeyByZXR1cm4gdHJ1ZSB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRNYXhXaWR0aCh3aWR0aDogbnVtYmVyKSB7XHJcbiAgICB0aGlzLm1heFdpZHRoID0gd2lkdGhcclxuICB9XHJcblxyXG4gIHNldENvbG9yKGNvbG9yOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvclxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogc2V0IHRvb2wgYXMgbW91c2UgdHlwZVxyXG4gICAqIEBwYXJhbSB0b29sIE1vdXNlVHlwZVxyXG4gICAqL1xyXG4gIHNldFRvb2wodG9vbDogTW91c2VUeXBlKSB7XHJcbiAgICB0aGlzLm1vdXNlVHlwZSA9IHRvb2xcclxuXHJcbiAgICBpZiAodG9vbCA9PT0gTW91c2VUeXBlLlBFTikge1xyXG4gICAgICB0aGlzLnNldFBlbigpXHJcbiAgICB9IGVsc2UgaWYgKHRvb2wgPT09IE1vdXNlVHlwZS5FUkFTRVIpIHtcclxuICAgICAgdGhpcy5zZXRFcmFzZXIoKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0UGVuKCkge1xyXG4gICAgKE9iamVjdCBhcyBhbnkpLmFzc2lnbih0aGlzLm1vdXNlLnN0eWxlLCB7XHJcbiAgICAgIGJvcmRlclJhZGl1czogJzEwMCUnLFxyXG4gICAgICBib3JkZXI6IGAxcHggc29saWQgJHtQaG90b0NvdmVyLkRFRkFVTFRfUEVOX0JPUkRFUl9DT0xPUn1gXHJcbiAgICB9KVxyXG5cclxuICAgIHRoaXMubW91c2VUeXBlID0gTW91c2VUeXBlLlBFTlxyXG4gIH1cclxuXHJcbiAgc2V0RXJhc2VyKCkge1xyXG4gICAgKE9iamVjdCBhcyBhbnkpLmFzc2lnbih0aGlzLm1vdXNlLnN0eWxlLCB7XHJcbiAgICAgIGJvcmRlclJhZGl1czogMCxcclxuICAgICAgYm9yZGVyOiBgMXB4IGRhc2hlZCAke1Bob3RvQ292ZXIuREVGQVVMVF9FUkFTRVJfQk9SREVSX0NPTE9SfWBcclxuICAgIH0pXHJcblxyXG4gICAgdGhpcy5tb3VzZVR5cGUgPSBNb3VzZVR5cGUuRVJBU0VSXHJcbiAgfVxyXG5cclxuICB1bmRvKCkge1xyXG4gICAgbGV0IGN0eCA9IHRoaXMuY3R4XHJcbiAgICBsZXQgY29sb3IgPSB0aGlzLmNvbG9yXHJcblxyXG4gICAgY3R4LnNhdmUoKVxyXG5cclxuICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpXHJcbiAgICB0aGlzLm9wZXJhdGVIaXN0b3JpZXMucG9wKClcclxuXHJcbiAgICB0aGlzLm9wZXJhdGVIaXN0b3JpZXMubWFwKChzdGVwczogQXJyYXk8YW55PikgPT4ge1xyXG4gICAgICBzdGVwcy5tYXAoKHN0ZXA6IEFycmF5PGFueT4pID0+IHtcclxuICAgICAgICBpZiAoc3RlcFswXSA9PT0gTW91c2VUeXBlLlBFTikge1xyXG4gICAgICAgICAgdGhpcy5jb2xvciA9IHN0ZXBbMV1cclxuICAgICAgICAgIHRoaXMuZHJhd0xpbmUoc3RlcFsyXSwgc3RlcFszXSwgc3RlcFs0XSlcclxuICAgICAgICB9IGVsc2UgaWYgKHN0ZXBbMF0gPT09IE1vdXNlVHlwZS5FUkFTRVIpIHtcclxuICAgICAgICAgIGN0eC5jbGVhclJlY3QuYXBwbHkoY3R4LCBzdGVwLnNsaWNlKDEpKVxyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RlcFswXSA9PT0gJ01PVkVfVE8nKSB7XHJcbiAgICAgICAgICBjdHguYmVnaW5QYXRoKClcclxuICAgICAgICAgIGN0eC5tb3ZlVG8uYXBwbHkoY3R4LCBzdGVwLnNsaWNlKDEpKVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0pXHJcblxyXG4gICAgY29uc29sZS5sb2codGhpcy5vcGVyYXRlSGlzdG9yaWVzLmxlbmd0aClcclxuXHJcbiAgICB0aGlzLmNvbG9yID0gY29sb3JcclxuICAgIGN0eC5yZXN0b3JlKClcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBnZXQgaW1hZ2Ugb3JpZ2luIHNpemVcclxuICAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgc3JjICAgICAgaWFtZ2Ugc291cmNlIHVybFxyXG4gICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayBjYWxsYmFjayBmdW5jdGlvbiwgd2lkdGggYXMgZmlyc3QgcGFyYW1ldGVyIGFuZCBoZWlnaHQgYXMgc2Vjb25kXHJcbiAgICogQHJldHVybiB7dW5kZWZpbmVkfVxyXG4gICAqL1xyXG4gIGdldEltYWdlT3JpZ2luU2l6ZShzcmM6IHN0cmluZywgY2FsbGJhY2s/OiBGdW5jdGlvbikge1xyXG4gICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpXHJcblxyXG4gICAgaW1nLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgbGV0IHdpZHRoID0gaW1nLndpZHRoXHJcbiAgICAgIGxldCBoZWlnaHQgPSBpbWcuaGVpZ2h0XHJcblxyXG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh3aWR0aCwgaGVpZ2h0KVxyXG4gICAgfVxyXG5cclxuICAgIGltZy5zcmMgPSBzcmNcclxuICB9XHJcblxyXG4gIGdldERhdGFVUkwodHlwZSA9ICdpbWFnZS9qcGVnJywgcXVhbGl0eSA9IDAuOCwgY2FsbGJhY2s/OiBGdW5jdGlvbikge1xyXG5cclxuICAgIGxldCBzcmMgPSB0aGlzLmltZy5zcmNcclxuXHJcbiAgICB0aGlzLmdldEltYWdlT3JpZ2luU2l6ZShzcmMsICh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikgPT4ge1xyXG4gICAgICBsZXQgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpXHJcbiAgICAgIHRlbXBDYW52YXMud2lkdGggPSB3aWR0aFxyXG4gICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IGhlaWdodFxyXG4gICAgICBsZXQgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxyXG4gICAgICBpZiAodGVtcEN0eCkge1xyXG4gICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKHRoaXMuaW1nLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KVxyXG4gICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKHRoaXMuY2FudmFzLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KVxyXG5cclxuICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh0ZW1wQ2FudmFzLnRvRGF0YVVSTCh0eXBlLCBxdWFsaXR5KSlcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHJlbW92ZSBkb20gdGhhdCBhZGRlZCBpbnRvIGJvZHksXHJcbiAgICogcmVtb3ZlIGFsbCBldmVudHMgdGhhdCByZWdpc3RlcmVkXHJcbiAgICovXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIHRoaXMuY2FudmFzLnBhcmVudE5vZGUgJiYgdGhpcy5jYW52YXMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmNhbnZhcylcclxuICAgIHRoaXMubW91c2UucGFyZW50Tm9kZSAmJiB0aGlzLm1vdXNlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5tb3VzZSlcclxuXHJcbiAgICB0aGlzLmltZy5zcmMgPSAnJ1xyXG5cclxuICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cy5mb3JFYWNoKHYgPT4ge1xyXG4gICAgICB2LmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcih2LmV2ZW50LCB2LmZ1bmN0aW9uLCBmYWxzZSlcclxuICAgIH0pXHJcbiAgICAvLyBkZWxldGUgdGhpc1xyXG4gIH1cclxufVxyXG4iXX0=
