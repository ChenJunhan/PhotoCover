var MouseType;
(function (MouseType) {
    MouseType[MouseType["PEN"] = 0] = "PEN";
    MouseType[MouseType["ERASER"] = 1] = "ERASER";
})(MouseType || (MouseType = {}));
var PhotoCover = (function () {
    function PhotoCover(selector) {
        this.isMobile = navigator.userAgent.indexOf('iPhone') > -1 || navigator.userAgent.indexOf('Android') > -1;
        // cache window, document and body for speed up performance
        this.win = window;
        this.doc = document;
        this.body = document.body;
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');
        // init value
        this.mouseType = MouseType.PEN; // default mouse pointer
        this.radius = PhotoCover.DEFAULT_RADIUS; // default radius of pen
        this.maxWidth = PhotoCover.DEFAULT_MAX_WIDTH; // default max width of image
        this.color = PhotoCover.DEFAULT_COLOR; // default color of canvas
        this.lineCap = PhotoCover.DEFAULT_LINECAP; // default linecap of line on canvas
        this.lineJoin = PhotoCover.DEFAULT_LINEJOIN; // default lineJoin of line on canvas
        this.histories = []; // operate history
        this.bindedEvents = []; // registered events [node, type, function]
        if (typeof selector === 'object') {
            this.img = selector;
        }
        else if (typeof selector === 'string') {
            this.img = document.querySelector(selector);
        }
        // initial canvas and its size and position
        this.canvas.width = this.img.width;
        this.canvas.height = this.img.height;
        this.init();
    }
    PhotoCover.prototype.init = function () {
        var _this = this;
        var _a = [this.body, this.win], body = _a[0], win = _a[1];
        this.async();
        body.appendChild(this.canvas);
        if (!this.isMobile) {
            this.initMouse();
        }
        // async canvas position and size during browser resize
        var resize = (function () {
            _this.async();
        }).bind(this);
        win.addEventListener('resize', resize, false);
        this.bindedEvents.push([win, 'resize', resize]);
        var currentOperate = [];
        var canvasMouseDown = (function (e) {
            e.preventDefault();
            var _a = _this.getCoordinateByEvent(e), x = _a[0], y = _a[1];
            currentOperate = [];
            if (_this.isOnCanvas(e.pageX, e.pageY)) {
                _this.ctx.beginPath();
                currentOperate.push(['MOVE_TO', x, y]);
                currentOperate.push(_this.drawByEvent(e));
                _this.ctx.beginPath();
                currentOperate.push(['MOVE_TO', x, y]);
                if (!_this.isMobile) {
                    win.addEventListener('mousemove', canvasMouseMove, false);
                }
                else {
                    win.addEventListener('touchmove', canvasMouseMove, false);
                }
            }
        }).bind(this);
        var canvasMouseMove = (function (e) {
            e.preventDefault();
            currentOperate.push(_this.drawByEvent(e));
        }).bind(this);
        var canvasMouseUp = (function (e) {
            e.preventDefault();
            if (!_this.isMobile) {
                win.removeEventListener('mousemove', canvasMouseMove, false);
            }
            else {
                win.removeEventListener('touchmove', canvasMouseMove, false);
            }
            var _a = [e.pageX, e.pageY], x = _a[0], y = _a[1];
            if (_this.isOnCanvas(x, y)) {
                _this.histories.push(currentOperate);
                currentOperate = [];
            }
        }).bind(this);
        // canvas down
        if (!this.isMobile) {
            win.addEventListener('mousedown', canvasMouseDown, false);
            this.bindedEvents.push([win, 'mousedown', canvasMouseDown]);
            win.addEventListener('mouseup', canvasMouseUp, false);
            this.bindedEvents.push([win, 'mouseup', canvasMouseUp]);
        }
        else {
            win.addEventListener('touchstart', canvasMouseDown, false);
            this.bindedEvents.push([win, 'touchstart', canvasMouseDown]);
            win.addEventListener('touchend', canvasMouseUp, false);
            this.bindedEvents.push([win, 'touchend', canvasMouseUp]);
        }
    };
    // async x and y from image to canvas
    PhotoCover.prototype.async = function () {
        this.canvas.style.cssText = "\n      position: absolute;\n      left: " + this.img.offsetLeft + "px;\n      top: " + this.img.offsetTop + "px;\n      use-select: none;\n    ";
    };
    // initial mouse shape where mouse on canvas
    PhotoCover.prototype.initMouse = function () {
        var _this = this;
        var _a = [this.body, this.win], body = _a[0], win = _a[1];
        var mouse = document.createElement('div');
        mouse.style.cssText = "\n      display: none;\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 10001;\n      width: " + this.radius * 2 + "px;\n      height: " + this.radius * 2 + "px;\n      border: 1px solid red;\n      border-radius: 100%;\n    ";
        this.mouse = mouse;
        body.appendChild(mouse);
        var mouseMove = (function (e) {
            var _a = [e.pageX, e.pageY], x = _a[0], y = _a[1];
            var isOnCanvas = _this.isOnCanvas(x, y);
            mouse.style.transform = "translate(" + (x - _this.radius - 1) + "px, " + (y - _this.radius - 1) + "px)"; // minus border width of mouse type
            if (!isOnCanvas) {
                mouse.style.display = 'none';
                body.style.cursor = 'default';
            }
            else {
                mouse.style.display = 'block';
                body.style.cursor = 'none';
            }
        }).bind(this);
        // change mouse style
        if (!this.isMobile) {
            win.addEventListener('mousemove', mouseMove, false);
            this.bindedEvents.push([win, 'mousemove', mouseMove]);
        }
        else {
            win.addEventListener('touchmove', mouseMove, false);
            this.bindedEvents.push([win, 'touchmove', mouseMove]);
        }
    };
    PhotoCover.prototype.setRadius = function (radius) {
        if (radius < 2 || radius > 100) {
            return;
        }
        var mouse = this.mouse;
        this.radius = radius;
        mouse.style.width = radius * 2 + 'px';
        mouse.style.height = radius * 2 + 'px';
    };
    PhotoCover.prototype.zoomIn = function (radius) {
        if (radius === void 0) { radius = 2; }
        this.setRadius(this.radius + radius);
    };
    PhotoCover.prototype.zoomOut = function (radius) {
        if (radius === void 0) { radius = 2; }
        this.setRadius(this.radius - radius);
    };
    PhotoCover.prototype.lineTo = function (x, y) {
        var ctx = this.ctx;
        ctx.lineCap = this.lineCap;
        ctx.lineJoin = 'round';
        ctx.strokeStyle = this.color;
        ctx.lineWidth = this.radius * 2;
        ctx.lineTo(x, y);
        ctx.stroke();
    };
    PhotoCover.prototype.drawCircle = function (x, y, radius) {
        var ctx = this.ctx;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(x + 1, y + 1, radius || this.radius, 0, 360);
        ctx.fill();
        ctx.closePath();
        return [MouseType.PEN, this.color, x, y, this.radius];
    };
    PhotoCover.prototype.drawLine = function (x, y) {
        this.ctx.globalCompositeOperation = 'source-over';
        this.lineCap = 'round';
        this.lineJoin = 'round';
        this.lineTo(x, y);
        return [MouseType.PEN, this.color, x, y, this.radius];
    };
    PhotoCover.prototype.erase = function (x, y) {
        this.ctx.globalCompositeOperation = 'destination-out';
        this.lineCap = 'round';
        this.lineJoin = 'round';
        this.lineTo(x, y);
        return [MouseType.ERASER, x, y, this.radius];
    };
    PhotoCover.prototype.drawByEvent = function (event) {
        var _a = this.getCoordinateByEvent(event), x = _a[0], y = _a[1];
        if (this.mouseType === MouseType.PEN) {
            return this.drawLine(x, y);
        }
        else if (this.mouseType === MouseType.ERASER) {
            return this.erase(x, y);
        }
        else {
            return [];
        }
    };
    PhotoCover.prototype.getCoordinateByEvent = function (event) {
        var x, y;
        var _a = [this.win, this.canvas], win = _a[0], canvas = _a[1];
        if (this.isMobile) {
            event = event.changedTouches[0];
        }
        x = event.pageX - canvas.offsetLeft;
        y = event.pageY - canvas.offsetTop;
        console.log(win.pageYOffset);
        return [x, y];
    };
    PhotoCover.prototype.isOnCanvas = function (pageX, pageY) {
        if (pageX < this.img.offsetLeft ||
            pageX > (this.img.offsetLeft + this.img.width) ||
            pageY < this.img.offsetTop ||
            pageY > (this.img.offsetTop + this.img.height)) {
            return false;
        }
        return true;
    };
    PhotoCover.prototype.setMaxWidth = function (width) {
        this.maxWidth = width;
    };
    PhotoCover.prototype.setColor = function (color) {
        this.color = color;
    };
    /**
     * set tool as mouse type
     * @param tool MouseType
     */
    PhotoCover.prototype.setTool = function (tool) {
        this.mouseType = tool;
        if (tool === MouseType.PEN) {
            this.setPen();
        }
        else if (tool === MouseType.ERASER) {
            this.setEraser();
        }
    };
    PhotoCover.prototype.setPen = function () {
        Object.assign(this.mouse.style, {
            borderRadius: '100%',
            border: "1px solid " + PhotoCover.DEFAULT_PEN_BORDER_COLOR
        });
        this.mouseType = MouseType.PEN;
    };
    PhotoCover.prototype.setEraser = function () {
        Object.assign(this.mouse.style, {
            borderRadius: '100%',
            border: "1px dashed " + PhotoCover.DEFAULT_ERASER_BORDER_COLOR
        });
        this.mouseType = MouseType.ERASER;
    };
    PhotoCover.prototype.undo = function () {
        var _this = this;
        var ctx = this.ctx;
        var color = this.color;
        ctx.save();
        ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.histories.pop();
        this.histories.map(function (steps) {
            steps.map(function (step) {
                if (step[0] === MouseType.PEN) {
                    _this.color = step[1];
                    _this.setRadius(step[4]);
                    _this.drawLine(step[2], step[3]);
                }
                else if (step[0] === MouseType.ERASER) {
                    _this.setRadius(step[3]);
                    _this.erase(step[1], step[2]);
                }
                else if (step[0] === 'MOVE_TO') {
                    ctx.beginPath();
                    ctx.moveTo.apply(ctx, step.slice(1));
                }
            });
        });
        this.color = color;
        ctx.restore();
    };
    /**
     * get image origin size
     * @param  {String}   src      iamge source url
     * @param  {Function} callback callback function, width as first parameter and height as second
     * @return {undefined}
     */
    PhotoCover.prototype.getImageOriginSize = function (src, callback) {
        var img = new Image();
        img.onload = function () {
            var width = img.width;
            var height = img.height;
            callback && callback(width, height);
        };
        img.src = src;
    };
    PhotoCover.prototype.getDataURL = function (type, quality, callback) {
        var _this = this;
        if (type === void 0) { type = 'image/jpeg'; }
        if (quality === void 0) { quality = 0.8; }
        var src = this.img.src;
        this.getImageOriginSize(src, function (width, height) {
            var tempCanvas = document.createElement('canvas');
            tempCanvas.width = width;
            tempCanvas.height = height;
            var tempCtx = tempCanvas.getContext('2d');
            if (tempCtx) {
                tempCtx.drawImage(_this.img, 0, 0, width, height);
                tempCtx.drawImage(_this.canvas, 0, 0, width, height);
                callback && callback(tempCanvas.toDataURL(type, quality));
            }
        });
    };
    /**
     * remove dom that added into body,
     * remove all events that registered
     */
    PhotoCover.prototype.destroy = function () {
        this.canvas.parentNode && this.canvas.parentNode.removeChild(this.canvas);
        this.mouse.parentNode && this.mouse.parentNode.removeChild(this.mouse);
        this.img.src = '';
        this.bindedEvents.forEach(function (v) {
            v[0].removeEventListener(v[1], v[2], false);
        });
        // delete this
    };
    PhotoCover.DEFAULT_RADIUS = 20;
    PhotoCover.DEFAULT_MAX_WIDTH = 800;
    PhotoCover.DEFAULT_COLOR = 'black';
    PhotoCover.DEFAULT_PEN_BORDER_COLOR = 'red';
    PhotoCover.DEFAULT_ERASER_BORDER_COLOR = '#666';
    PhotoCover.DEFAULT_LINECAP = 'round';
    PhotoCover.DEFAULT_LINEJOIN = 'round';
    return PhotoCover;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QixHQUFVLE1BQU0sQ0FBQTtJQUMzQywwQkFBZSxHQUFXLE9BQU8sQ0FBQTtJQUNqQywyQkFBZ0IsR0FBVyxPQUFPLENBQUE7SUE4WDNDLGlCQUFDO0NBcllELEFBcVlDLElBQUEiLCJmaWxlIjoicGhvdG9jb3Zlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImVudW0gTW91c2VUeXBlIHsgUEVOLCBFUkFTRVIgfVxyXG5cclxuY2xhc3MgUGhvdG9Db3ZlciB7XHJcbiAgc3RhdGljIERFRkFVTFRfUkFESVVTOm51bWJlciA9IDIwXHJcbiAgc3RhdGljIERFRkFVTFRfTUFYX1dJRFRIOm51bWJlciA9IDgwMFxyXG4gIHN0YXRpYyBERUZBVUxUX0NPTE9SOiBzdHJpbmcgPSAnYmxhY2snXHJcbiAgc3RhdGljIERFRkFVTFRfUEVOX0JPUkRFUl9DT0xPUjogc3RyaW5nID0gJ3JlZCdcclxuICBzdGF0aWMgREVGQVVMVF9FUkFTRVJfQk9SREVSX0NPTE9SOnN0cmluZyA9ICcjNjY2J1xyXG4gIHN0YXRpYyBERUZBVUxUX0xJTkVDQVA6IHN0cmluZyA9ICdyb3VuZCdcclxuICBzdGF0aWMgREVGQVVMVF9MSU5FSk9JTjogc3RyaW5nID0gJ3JvdW5kJ1xyXG5cclxuICByZWFkb25seSBpc01vYmlsZSA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignaVBob25lJykgPiAtMSB8fCBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0FuZHJvaWQnKSA+IC0xXHJcblxyXG4gIC8vIGNhY2hlIHdpbmRvdywgZG9jdW1lbnQgYW5kIGJvZHkgZm9yIHNwZWVkIHVwIHBlcmZvcm1hbmNlXHJcbiAgd2luOiBXaW5kb3cgPSB3aW5kb3dcclxuICBkb2M6IEhUTUxEb2N1bWVudCA9IGRvY3VtZW50XHJcbiAgYm9keTogSFRNTEVsZW1lbnQgPSBkb2N1bWVudC5ib2R5XHJcblxyXG4gIG1vdXNlOiBIVE1MRGl2RWxlbWVudCAgIC8vIG1vdXNlIHBvaW50ZXIgb24gY2FudmFzXHJcbiAgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpXHJcbiAgaW1nOiBIVE1MSW1hZ2VFbGVtZW50ICAvLyBpbWFnZSB0aGF0IHlvdSB3YW50IHRvIGNoYW5nZSBcclxuXHJcbiAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRFxyXG5cclxuICAvLyBpbml0IHZhbHVlXHJcbiAgbW91c2VUeXBlOiBNb3VzZVR5cGUgPSBNb3VzZVR5cGUuUEVOICAgIC8vIGRlZmF1bHQgbW91c2UgcG9pbnRlclxyXG4gIHJhZGl1cyA9ICBQaG90b0NvdmVyLkRFRkFVTFRfUkFESVVTICAgIC8vIGRlZmF1bHQgcmFkaXVzIG9mIHBlblxyXG4gIG1heFdpZHRoID0gUGhvdG9Db3Zlci5ERUZBVUxUX01BWF9XSURUSCAgICAgLy8gZGVmYXVsdCBtYXggd2lkdGggb2YgaW1hZ2VcclxuICBjb2xvciA9IFBob3RvQ292ZXIuREVGQVVMVF9DT0xPUiAgICAvLyBkZWZhdWx0IGNvbG9yIG9mIGNhbnZhc1xyXG4gIGxpbmVDYXAgPSBQaG90b0NvdmVyLkRFRkFVTFRfTElORUNBUCAgICAvLyBkZWZhdWx0IGxpbmVjYXAgb2YgbGluZSBvbiBjYW52YXNcclxuICBsaW5lSm9pbiA9IFBob3RvQ292ZXIuREVGQVVMVF9MSU5FSk9JTiAvLyBkZWZhdWx0IGxpbmVKb2luIG9mIGxpbmUgb24gY2FudmFzXHJcblxyXG4gIGhpc3RvcmllczogYW55W11bXSA9IFtdICAgIC8vIG9wZXJhdGUgaGlzdG9yeVxyXG4gIGJpbmRlZEV2ZW50czogYW55W11bXSA9IFtdICAgIC8vIHJlZ2lzdGVyZWQgZXZlbnRzIFtub2RlLCB0eXBlLCBmdW5jdGlvbl1cclxuXHJcbiAgY29uc3RydWN0b3Ioc2VsZWN0b3I6IEhUTUxJbWFnZUVsZW1lbnQgfCBzdHJpbmcpIHtcclxuXHJcbiAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnb2JqZWN0JykgeyB0aGlzLmltZyA9IHNlbGVjdG9yIH1cclxuICAgIGVsc2UgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHsgdGhpcy5pbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSBhcyBIVE1MSW1hZ2VFbGVtZW50IH1cclxuICAgIFxyXG4gICAgLy8gaW5pdGlhbCBjYW52YXMgYW5kIGl0cyBzaXplIGFuZCBwb3NpdGlvblxyXG4gICAgdGhpcy5jYW52YXMud2lkdGggPSB0aGlzLmltZy53aWR0aFxyXG4gICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5pbWcuaGVpZ2h0XHJcblxyXG4gICAgdGhpcy5pbml0KClcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5pdCgpOiB2b2lkIHtcclxuXHJcbiAgICBsZXQgW2JvZHksIHdpbl0gPSBbdGhpcy5ib2R5LCB0aGlzLndpbl1cclxuXHJcbiAgICB0aGlzLmFzeW5jKClcclxuICAgIGJvZHkuYXBwZW5kQ2hpbGQodGhpcy5jYW52YXMpXHJcblxyXG4gICAgaWYgKCF0aGlzLmlzTW9iaWxlKSB7IHRoaXMuaW5pdE1vdXNlKCkgfVxyXG5cclxuICAgIC8vIGFzeW5jIGNhbnZhcyBwb3NpdGlvbiBhbmQgc2l6ZSBkdXJpbmcgYnJvd3NlciByZXNpemVcclxuICAgIGxldCByZXNpemUgPSAoKCkgPT4ge1xyXG4gICAgICB0aGlzLmFzeW5jKClcclxuICAgIH0pLmJpbmQodGhpcylcclxuICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCByZXNpemUsIGZhbHNlKVxyXG4gICAgdGhpcy5iaW5kZWRFdmVudHMucHVzaChbd2luLCAncmVzaXplJywgcmVzaXplXSlcclxuXHJcblxyXG4gICAgbGV0IGN1cnJlbnRPcGVyYXRlOiBhbnlbXVtdID0gW11cclxuXHJcbiAgICBsZXQgY2FudmFzTW91c2VEb3duID0gKChlOiBhbnkpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXHJcblxyXG4gICAgICBjb25zdCBbeCwgeV0gPSB0aGlzLmdldENvb3JkaW5hdGVCeUV2ZW50KGUpXHJcblxyXG4gICAgICBjdXJyZW50T3BlcmF0ZSA9IFtdXHJcblxyXG4gICAgICBpZiAodGhpcy5pc09uQ2FudmFzKGUucGFnZVgsIGUucGFnZVkpKSB7XHJcblxyXG4gICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpXHJcbiAgICAgICAgY3VycmVudE9wZXJhdGUucHVzaChbJ01PVkVfVE8nLCB4LCB5XSlcclxuICAgICAgICBjdXJyZW50T3BlcmF0ZS5wdXNoKHRoaXMuZHJhd0J5RXZlbnQoZSkpXHJcblxyXG4gICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpXHJcbiAgICAgICAgY3VycmVudE9wZXJhdGUucHVzaChbJ01PVkVfVE8nLCB4LCB5XSlcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmlzTW9iaWxlKSB7IHdpbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBjYW52YXNNb3VzZU1vdmUsIGZhbHNlKSB9XHJcbiAgICAgICAgZWxzZSB7IHdpbi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBjYW52YXNNb3VzZU1vdmUsIGZhbHNlKSB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICB9KS5iaW5kKHRoaXMpXHJcblxyXG4gICAgbGV0IGNhbnZhc01vdXNlTW92ZSA9ICgoZTogYW55KSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxyXG4gICAgICBjdXJyZW50T3BlcmF0ZS5wdXNoKHRoaXMuZHJhd0J5RXZlbnQoZSkpXHJcbiAgICB9KS5iaW5kKHRoaXMpXHJcblxyXG4gICAgbGV0IGNhbnZhc01vdXNlVXAgPSAoKGU6IGFueSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcclxuXHJcbiAgICAgIGlmICghdGhpcy5pc01vYmlsZSkgeyB3aW4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgY2FudmFzTW91c2VNb3ZlLCBmYWxzZSkgfVxyXG4gICAgICBlbHNlIHsgd2luLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGNhbnZhc01vdXNlTW92ZSwgZmFsc2UpIH1cclxuICAgICAgXHJcbiAgICAgIGxldCBbeCwgeV0gPSBbZS5wYWdlWCwgZS5wYWdlWV1cclxuXHJcbiAgICAgIGlmICh0aGlzLmlzT25DYW52YXMoeCwgeSkpIHtcclxuICAgICAgICB0aGlzLmhpc3Rvcmllcy5wdXNoKGN1cnJlbnRPcGVyYXRlKVxyXG4gICAgICAgIGN1cnJlbnRPcGVyYXRlID0gW11cclxuICAgICAgfVxyXG4gICAgfSkuYmluZCh0aGlzKVxyXG5cclxuICAgIC8vIGNhbnZhcyBkb3duXHJcbiAgICBpZiAoIXRoaXMuaXNNb2JpbGUpIHtcclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGNhbnZhc01vdXNlRG93biwgZmFsc2UpXHJcbiAgICAgIHRoaXMuYmluZGVkRXZlbnRzLnB1c2goW3dpbiwgJ21vdXNlZG93bicsIGNhbnZhc01vdXNlRG93bl0pXHJcblxyXG4gICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGNhbnZhc01vdXNlVXAsIGZhbHNlKVxyXG4gICAgICB0aGlzLmJpbmRlZEV2ZW50cy5wdXNoKFt3aW4sICdtb3VzZXVwJywgY2FudmFzTW91c2VVcF0pIFxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBjYW52YXNNb3VzZURvd24sIGZhbHNlKVxyXG4gICAgICB0aGlzLmJpbmRlZEV2ZW50cy5wdXNoKFt3aW4sICd0b3VjaHN0YXJ0JywgY2FudmFzTW91c2VEb3duXSlcclxuXHJcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGNhbnZhc01vdXNlVXAsIGZhbHNlKVxyXG4gICAgICB0aGlzLmJpbmRlZEV2ZW50cy5wdXNoKFt3aW4sICd0b3VjaGVuZCcsIGNhbnZhc01vdXNlVXBdKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gYXN5bmMgeCBhbmQgeSBmcm9tIGltYWdlIHRvIGNhbnZhc1xyXG4gIHByaXZhdGUgYXN5bmMoKSB7XHJcbiAgICB0aGlzLmNhbnZhcy5zdHlsZS5jc3NUZXh0ID0gYFxyXG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XHJcbiAgICAgIGxlZnQ6ICR7dGhpcy5pbWcub2Zmc2V0TGVmdH1weDtcclxuICAgICAgdG9wOiAke3RoaXMuaW1nLm9mZnNldFRvcH1weDtcclxuICAgICAgdXNlLXNlbGVjdDogbm9uZTtcclxuICAgIGBcclxuICB9XHJcblxyXG4gIC8vIGluaXRpYWwgbW91c2Ugc2hhcGUgd2hlcmUgbW91c2Ugb24gY2FudmFzXHJcbiAgcHJpdmF0ZSBpbml0TW91c2UoKSB7XHJcbiAgICBsZXQgW2JvZHksIHdpbl0gPSBbdGhpcy5ib2R5LCB0aGlzLndpbl1cclxuICAgIGxldCBtb3VzZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXHJcbiAgICBtb3VzZS5zdHlsZS5jc3NUZXh0ID0gYFxyXG4gICAgICBkaXNwbGF5OiBub25lO1xyXG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XHJcbiAgICAgIGxlZnQ6IDA7XHJcbiAgICAgIHRvcDogMDtcclxuICAgICAgei1pbmRleDogMTAwMDE7XHJcbiAgICAgIHdpZHRoOiAke3RoaXMucmFkaXVzICogMn1weDtcclxuICAgICAgaGVpZ2h0OiAke3RoaXMucmFkaXVzICogMn1weDtcclxuICAgICAgYm9yZGVyOiAxcHggc29saWQgcmVkO1xyXG4gICAgICBib3JkZXItcmFkaXVzOiAxMDAlO1xyXG4gICAgYFxyXG4gICAgdGhpcy5tb3VzZSA9IG1vdXNlXHJcblxyXG4gICAgYm9keS5hcHBlbmRDaGlsZChtb3VzZSlcclxuXHJcbiAgICBsZXQgbW91c2VNb3ZlID0gKChlOiBhbnkpID0+IHtcclxuICAgICAgbGV0IFt4LCB5XSA9IFtlLnBhZ2VYLCBlLnBhZ2VZXVxyXG4gICAgICBsZXQgaXNPbkNhbnZhcyA9IHRoaXMuaXNPbkNhbnZhcyh4LCB5KVxyXG5cclxuICAgICAgbW91c2Uuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3ggLSB0aGlzLnJhZGl1cyAtIDF9cHgsICR7eSAtIHRoaXMucmFkaXVzIC0gMX1weClgIC8vIG1pbnVzIGJvcmRlciB3aWR0aCBvZiBtb3VzZSB0eXBlXHJcblxyXG4gICAgICBpZiAoIWlzT25DYW52YXMpIHtcclxuICAgICAgICBtb3VzZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnXHJcbiAgICAgICAgYm9keS5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCdcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBtb3VzZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJ1xyXG4gICAgICAgIGJvZHkuc3R5bGUuY3Vyc29yID0gJ25vbmUnXHJcbiAgICAgIH1cclxuICAgIH0pLmJpbmQodGhpcylcclxuXHJcbiAgICAvLyBjaGFuZ2UgbW91c2Ugc3R5bGVcclxuICAgIGlmICghdGhpcy5pc01vYmlsZSkge1xyXG4gICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgbW91c2VNb3ZlLCBmYWxzZSlcclxuICAgICAgdGhpcy5iaW5kZWRFdmVudHMucHVzaChbd2luLCAnbW91c2Vtb3ZlJywgbW91c2VNb3ZlXSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBtb3VzZU1vdmUsIGZhbHNlKVxyXG4gICAgICB0aGlzLmJpbmRlZEV2ZW50cy5wdXNoKFt3aW4sICd0b3VjaG1vdmUnLCBtb3VzZU1vdmVdKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0UmFkaXVzKHJhZGl1czogbnVtYmVyKSB7XHJcbiAgICBpZiAocmFkaXVzIDwgMiB8fCByYWRpdXMgPiAxMDApIHtcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgbGV0IG1vdXNlID0gdGhpcy5tb3VzZVxyXG4gICAgdGhpcy5yYWRpdXMgPSByYWRpdXNcclxuXHJcbiAgICBtb3VzZS5zdHlsZS53aWR0aCA9IHJhZGl1cyAqIDIgKyAncHgnXHJcbiAgICBtb3VzZS5zdHlsZS5oZWlnaHQgPSByYWRpdXMgKiAyICsgJ3B4J1xyXG4gIH1cclxuXHJcbiAgem9vbUluKHJhZGl1czpudW1iZXIgPSAyKSB7XHJcbiAgICB0aGlzLnNldFJhZGl1cyh0aGlzLnJhZGl1cyArIHJhZGl1cylcclxuICB9XHJcblxyXG4gIHpvb21PdXQocmFkaXVzOm51bWJlciA9IDIpIHtcclxuICAgIHRoaXMuc2V0UmFkaXVzKHRoaXMucmFkaXVzIC0gcmFkaXVzKVxyXG4gIH1cclxuXHJcblxyXG4gIGxpbmVUbyh4OiBudW1iZXIsIHk6IG51bWJlcik6IHZvaWQge1xyXG4gICAgY29uc3QgY3R4ID0gdGhpcy5jdHhcclxuICAgIGN0eC5saW5lQ2FwID0gdGhpcy5saW5lQ2FwXHJcbiAgICBjdHgubGluZUpvaW4gPSAncm91bmQnXHJcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yXHJcbiAgICBjdHgubGluZVdpZHRoID0gdGhpcy5yYWRpdXMgKiAyXHJcbiAgICBjdHgubGluZVRvKHgsIHkpXHJcbiAgICBjdHguc3Ryb2tlKClcclxuICB9XHJcblxyXG4gIGRyYXdDaXJjbGUoeDogbnVtYmVyLCB5OiBudW1iZXIsIHJhZGl1cz86IG51bWJlcik6IGFueVtdIHtcclxuICAgIGxldCBjdHggPSB0aGlzLmN0eFxyXG4gICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29sb3I7XHJcbiAgICBjdHguYmVnaW5QYXRoKClcclxuICAgIGN0eC5hcmMoeCArIDEsIHkgKyAxLCByYWRpdXMgfHwgdGhpcy5yYWRpdXMsIDAsIDM2MClcclxuICAgIGN0eC5maWxsKClcclxuICAgIGN0eC5jbG9zZVBhdGgoKVxyXG5cclxuICAgIHJldHVybiBbTW91c2VUeXBlLlBFTiwgdGhpcy5jb2xvciwgeCwgeSwgdGhpcy5yYWRpdXNdXHJcbiAgfVxyXG5cclxuICBkcmF3TGluZSh4OiBudW1iZXIsIHk6IG51bWJlcik6IGFueVtdIHtcclxuICAgIHRoaXMuY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzb3VyY2Utb3ZlcidcclxuICAgIHRoaXMubGluZUNhcCA9ICdyb3VuZCdcclxuICAgIHRoaXMubGluZUpvaW4gPSAncm91bmQnXHJcbiAgICB0aGlzLmxpbmVUbyh4LCB5KVxyXG4gICAgcmV0dXJuIFtNb3VzZVR5cGUuUEVOLCB0aGlzLmNvbG9yLCB4LCB5LCB0aGlzLnJhZGl1c11cclxuICB9XHJcblxyXG4gIGVyYXNlKHg6IG51bWJlciwgeTogbnVtYmVyKTogYW55W10ge1xyXG4gICAgdGhpcy5jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2Rlc3RpbmF0aW9uLW91dCdcclxuICAgIHRoaXMubGluZUNhcCA9ICdyb3VuZCdcclxuICAgIHRoaXMubGluZUpvaW4gPSAncm91bmQnXHJcbiAgICB0aGlzLmxpbmVUbyh4LCB5KVxyXG4gICAgcmV0dXJuIFtNb3VzZVR5cGUuRVJBU0VSLCB4LCB5LCB0aGlzLnJhZGl1c11cclxuICB9XHJcblxyXG4gIGRyYXdCeUV2ZW50KGV2ZW50OiBhbnkpOiBhbnlbXSB7XHJcbiAgICBsZXQgW3gsIHldID0gdGhpcy5nZXRDb29yZGluYXRlQnlFdmVudChldmVudClcclxuXHJcbiAgICBpZiAodGhpcy5tb3VzZVR5cGUgPT09IE1vdXNlVHlwZS5QRU4pIHsgcmV0dXJuIHRoaXMuZHJhd0xpbmUoeCwgeSkgfVxyXG4gICAgZWxzZSBpZiAodGhpcy5tb3VzZVR5cGUgPT09IE1vdXNlVHlwZS5FUkFTRVIpIHsgcmV0dXJuIHRoaXMuZXJhc2UoeCwgeSkgfVxyXG4gICAgZWxzZSB7IHJldHVybiBbXSB9XHJcbiAgfVxyXG5cclxuICBnZXRDb29yZGluYXRlQnlFdmVudChldmVudDogYW55KSB7XHJcbiAgICBsZXQgeCwgeVxyXG4gICAgbGV0IFt3aW4sIGNhbnZhc10gPSBbdGhpcy53aW4sIHRoaXMuY2FudmFzXVxyXG5cclxuICAgIGlmICh0aGlzLmlzTW9iaWxlKSB7IGV2ZW50ID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0gfVxyXG5cclxuICAgIHggPSBldmVudC5wYWdlWCAtIGNhbnZhcy5vZmZzZXRMZWZ0XHJcbiAgICB5ID0gZXZlbnQucGFnZVkgLSBjYW52YXMub2Zmc2V0VG9wXHJcblxyXG4gICAgY29uc29sZS5sb2cod2luLnBhZ2VZT2Zmc2V0KVxyXG5cclxuICAgIHJldHVybiBbeCwgeV1cclxuICB9XHJcblxyXG5cclxuICBpc09uQ2FudmFzKHBhZ2VYOiBudW1iZXIsIHBhZ2VZOiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgIGlmIChcclxuICAgICAgcGFnZVggPCB0aGlzLmltZy5vZmZzZXRMZWZ0IHx8XHJcbiAgICAgIHBhZ2VYID4gKHRoaXMuaW1nLm9mZnNldExlZnQgKyB0aGlzLmltZy53aWR0aCkgfHxcclxuICAgICAgcGFnZVkgPCB0aGlzLmltZy5vZmZzZXRUb3AgfHxcclxuICAgICAgcGFnZVkgPiAodGhpcy5pbWcub2Zmc2V0VG9wICsgdGhpcy5pbWcuaGVpZ2h0KVxyXG4gICAgKSB7IHJldHVybiBmYWxzZX1cclxuXHJcbiAgICByZXR1cm4gdHJ1ZVxyXG4gIH1cclxuXHJcbiAgc2V0TWF4V2lkdGgod2lkdGg6IG51bWJlcikge1xyXG4gICAgdGhpcy5tYXhXaWR0aCA9IHdpZHRoXHJcbiAgfVxyXG5cclxuICBzZXRDb2xvcihjb2xvcjogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmNvbG9yID0gY29sb3JcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHNldCB0b29sIGFzIG1vdXNlIHR5cGVcclxuICAgKiBAcGFyYW0gdG9vbCBNb3VzZVR5cGVcclxuICAgKi9cclxuICBzZXRUb29sKHRvb2w6IE1vdXNlVHlwZSkge1xyXG4gICAgdGhpcy5tb3VzZVR5cGUgPSB0b29sXHJcblxyXG4gICAgaWYgKHRvb2wgPT09IE1vdXNlVHlwZS5QRU4pIHtcclxuICAgICAgdGhpcy5zZXRQZW4oKVxyXG4gICAgfSBlbHNlIGlmICh0b29sID09PSBNb3VzZVR5cGUuRVJBU0VSKSB7XHJcbiAgICAgIHRoaXMuc2V0RXJhc2VyKClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldFBlbigpIHtcclxuICAgIChPYmplY3QgYXMgYW55KS5hc3NpZ24odGhpcy5tb3VzZS5zdHlsZSwge1xyXG4gICAgICBib3JkZXJSYWRpdXM6ICcxMDAlJyxcclxuICAgICAgYm9yZGVyOiBgMXB4IHNvbGlkICR7UGhvdG9Db3Zlci5ERUZBVUxUX1BFTl9CT1JERVJfQ09MT1J9YFxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLm1vdXNlVHlwZSA9IE1vdXNlVHlwZS5QRU5cclxuICB9XHJcblxyXG4gIHNldEVyYXNlcigpIHtcclxuICAgIChPYmplY3QgYXMgYW55KS5hc3NpZ24odGhpcy5tb3VzZS5zdHlsZSwge1xyXG4gICAgICBib3JkZXJSYWRpdXM6ICcxMDAlJyxcclxuICAgICAgYm9yZGVyOiBgMXB4IGRhc2hlZCAke1Bob3RvQ292ZXIuREVGQVVMVF9FUkFTRVJfQk9SREVSX0NPTE9SfWBcclxuICAgIH0pXHJcblxyXG4gICAgdGhpcy5tb3VzZVR5cGUgPSBNb3VzZVR5cGUuRVJBU0VSXHJcbiAgfVxyXG5cclxuICB1bmRvKCkge1xyXG4gICAgbGV0IGN0eCA9IHRoaXMuY3R4XHJcbiAgICBsZXQgY29sb3IgPSB0aGlzLmNvbG9yXHJcblxyXG4gICAgY3R4LnNhdmUoKVxyXG5cclxuICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodClcclxuICAgIHRoaXMuaGlzdG9yaWVzLnBvcCgpXHJcblxyXG4gICAgdGhpcy5oaXN0b3JpZXMubWFwKChzdGVwczogQXJyYXk8YW55PikgPT4ge1xyXG4gICAgICBzdGVwcy5tYXAoKHN0ZXA6IEFycmF5PGFueT4pID0+IHtcclxuICAgICAgICBpZiAoc3RlcFswXSA9PT0gTW91c2VUeXBlLlBFTikge1xyXG4gICAgICAgICAgdGhpcy5jb2xvciA9IHN0ZXBbMV1cclxuICAgICAgICAgIHRoaXMuc2V0UmFkaXVzKHN0ZXBbNF0pXHJcbiAgICAgICAgICB0aGlzLmRyYXdMaW5lKHN0ZXBbMl0sIHN0ZXBbM10pXHJcbiAgICAgICAgfSBlbHNlIGlmIChzdGVwWzBdID09PSBNb3VzZVR5cGUuRVJBU0VSKSB7XHJcbiAgICAgICAgICB0aGlzLnNldFJhZGl1cyhzdGVwWzNdKVxyXG4gICAgICAgICAgdGhpcy5lcmFzZShzdGVwWzFdLCBzdGVwWzJdKVxyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RlcFswXSA9PT0gJ01PVkVfVE8nKSB7XHJcbiAgICAgICAgICBjdHguYmVnaW5QYXRoKClcclxuICAgICAgICAgIGN0eC5tb3ZlVG8uYXBwbHkoY3R4LCBzdGVwLnNsaWNlKDEpKVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0pXHJcblxyXG4gICAgdGhpcy5jb2xvciA9IGNvbG9yXHJcbiAgICBjdHgucmVzdG9yZSgpXHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogZ2V0IGltYWdlIG9yaWdpbiBzaXplXHJcbiAgICogQHBhcmFtICB7U3RyaW5nfSAgIHNyYyAgICAgIGlhbWdlIHNvdXJjZSB1cmxcclxuICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2FsbGJhY2sgY2FsbGJhY2sgZnVuY3Rpb24sIHdpZHRoIGFzIGZpcnN0IHBhcmFtZXRlciBhbmQgaGVpZ2h0IGFzIHNlY29uZFxyXG4gICAqIEByZXR1cm4ge3VuZGVmaW5lZH1cclxuICAgKi9cclxuICBnZXRJbWFnZU9yaWdpblNpemUoc3JjOiBzdHJpbmcsIGNhbGxiYWNrPzogRnVuY3Rpb24pIHtcclxuICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKVxyXG5cclxuICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgIGxldCB3aWR0aCA9IGltZy53aWR0aFxyXG4gICAgICBsZXQgaGVpZ2h0ID0gaW1nLmhlaWdodFxyXG5cclxuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sod2lkdGgsIGhlaWdodClcclxuICAgIH1cclxuXHJcbiAgICBpbWcuc3JjID0gc3JjXHJcbiAgfVxyXG5cclxuICBnZXREYXRhVVJMKHR5cGUgPSAnaW1hZ2UvanBlZycsIHF1YWxpdHkgPSAwLjgsIGNhbGxiYWNrPzogRnVuY3Rpb24pIHtcclxuXHJcbiAgICBsZXQgc3JjID0gdGhpcy5pbWcuc3JjXHJcblxyXG4gICAgdGhpcy5nZXRJbWFnZU9yaWdpblNpemUoc3JjLCAod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpID0+IHtcclxuICAgICAgbGV0IHRlbXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxyXG4gICAgICB0ZW1wQ2FudmFzLndpZHRoID0gd2lkdGhcclxuICAgICAgdGVtcENhbnZhcy5oZWlnaHQgPSBoZWlnaHRcclxuICAgICAgbGV0IHRlbXBDdHggPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJylcclxuICAgICAgaWYgKHRlbXBDdHgpIHtcclxuICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZSh0aGlzLmltZywgMCwgMCwgd2lkdGgsIGhlaWdodClcclxuICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZSh0aGlzLmNhbnZhcywgMCwgMCwgd2lkdGgsIGhlaWdodClcclxuXHJcbiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sodGVtcENhbnZhcy50b0RhdGFVUkwodHlwZSwgcXVhbGl0eSkpXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiByZW1vdmUgZG9tIHRoYXQgYWRkZWQgaW50byBib2R5LFxyXG4gICAqIHJlbW92ZSBhbGwgZXZlbnRzIHRoYXQgcmVnaXN0ZXJlZFxyXG4gICAqL1xyXG4gIGRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLmNhbnZhcy5wYXJlbnROb2RlICYmIHRoaXMuY2FudmFzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5jYW52YXMpXHJcbiAgICB0aGlzLm1vdXNlLnBhcmVudE5vZGUgJiYgdGhpcy5tb3VzZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubW91c2UpXHJcblxyXG4gICAgdGhpcy5pbWcuc3JjID0gJydcclxuXHJcbiAgICB0aGlzLmJpbmRlZEV2ZW50cy5mb3JFYWNoKHYgPT4ge1xyXG4gICAgICB2WzBdLnJlbW92ZUV2ZW50TGlzdGVuZXIodlsxXSwgdlsyXSwgZmFsc2UpXHJcbiAgICB9KVxyXG4gICAgLy8gZGVsZXRlIHRoaXNcclxuICB9XHJcbn1cclxuIl19
