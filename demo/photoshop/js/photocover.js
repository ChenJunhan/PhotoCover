var DEFAULT_OPTIONS = {
    RADIUS: 20,
    MAX_WIDTH: 800,
    COLOR: 'black',
    MOUSE: 'pen',
    PEN_BORDER_COLOR: 'red',
    ERASER_BORDER_COLOR: '#666',
    PEN: 'pen',
    ERASER: 'eraser',
    LINECAP: 'round'
};
var PhotoCover = (function () {
    function PhotoCover(selector) {
        this.win = window;
        this.doc = document;
        this.body = document.body;
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');
        this.radius = DEFAULT_OPTIONS.RADIUS; // radius of each circle of line
        this.maxWidth = DEFAULT_OPTIONS.MAX_WIDTH;
        this.color = DEFAULT_OPTIONS.COLOR; // draw color
        this.linecap = DEFAULT_OPTIONS.LINECAP; // 
        this.mouseType = DEFAULT_OPTIONS.MOUSE;
        this.isMobile = navigator.userAgent.indexOf('iPhone') > -1 || navigator.userAgent.indexOf('Android') > -1;
        this.operateHistories = [];
        this.registeredEvents = [];
        if (typeof selector === 'object') {
            this.img = selector;
        }
        else if (typeof selector === 'string') {
            this.img = document.querySelector(selector);
        }
        // initial canvas and its size and position
        this.width = this.img.width;
        this.height = this.img.height;
        this._init();
    }
    PhotoCover.prototype._init = function () {
        var _this = this;
        var _a = [this.body, this.win, this.img], body = _a[0], win = _a[1], img = _a[2];
        this._async();
        this.canvas.width = img.width;
        this.canvas.height = img.height;
        body.appendChild(this.canvas);
        if (!this.isMobile) {
            this._initMouse();
        }
        // async canvas position and size during browser resize
        var resize = (function (e) {
            _this._async();
        }).bind(this);
        win.addEventListener('resize', resize, false);
        this._pushRegisteredEvents(win, 'resize', resize);
        var currentOperate = [];
        var canvasMouseDown = (function (e) {
            e.preventDefault();
            var _a = _this.getCoordinateByEvent(e), x = _a[0], y = _a[1];
            _this.ctx.moveTo(x, y);
            currentOperate = [];
            if (_this.isOnCanvas(x, y, true)) {
                _this.ctx.beginPath();
                currentOperate.push(['MOVE_TO', x, y]);
                if (!_this.isMobile) {
                    win.addEventListener('mousemove', canvasMouseMove, false);
                }
                else {
                    win.addEventListener('touchmove', canvasMouseMove, false);
                }
            }
        }).bind(this);
        var canvasMouseMove = (function (e) {
            e.preventDefault();
            currentOperate.push(_this.drawByEvent(e));
        }).bind(this);
        var canvasMouseUp = (function (e) {
            e.preventDefault();
            if (!_this.isMobile) {
                win.removeEventListener('mousemove', canvasMouseMove, false);
            }
            else {
                win.removeEventListener('touchmove', canvasMouseMove, false);
            }
            var coordinate = _this.getCoordinateByEvent(e);
            var _a = [e.pageX, e.pageY], x = _a[0], y = _a[1];
            if (_this.isOnCanvas(x, y)) {
                _this.operateHistories.push(currentOperate);
                currentOperate = [];
                console.log(_this.operateHistories);
            }
        }).bind(this);
        // canvas down
        if (!this.isMobile) {
            win.addEventListener('mousedown', canvasMouseDown, false);
            this._pushRegisteredEvents(win, 'mousedown', canvasMouseDown);
            win.addEventListener('mouseup', canvasMouseUp, false);
            this._pushRegisteredEvents(win, 'mouseup', canvasMouseUp);
        }
        else {
            win.addEventListener('touchstart', canvasMouseDown, false);
            this._pushRegisteredEvents(win, 'touchstart', canvasMouseDown);
            win.addEventListener('touchend', canvasMouseUp, false);
            this._pushRegisteredEvents(win, 'touchend', canvasMouseUp);
        }
    };
    // async x and y from image to canvas
    PhotoCover.prototype._async = function () {
        var coordinate = this.img.getBoundingClientRect();
        this.top = coordinate.top;
        this.left = coordinate.left;
        this.canvas.style.cssText = "\n      position: absolute;\n      left: " + (this.left + this.body.scrollLeft) + "px;\n      top: " + (this.top + this.body.scrollTop) + "px;\n      use-select: none;\n    ";
    };
    /**
     * save binds events
     * @param  {DOM} _element  DOM that you bind event
     * @param  {String} _event  event name
     * @param  {Function} _function event function
     * @return {Boolean} true when save success
     */
    PhotoCover.prototype._pushRegisteredEvents = function (_element, _event, _function) {
        this.registeredEvents.push({
            'element': _element,
            'event': _event,
            'function': _function
        });
        return true;
    };
    // initial mouse shape where mouse on canvas
    PhotoCover.prototype._initMouse = function (type) {
        var _this = this;
        var _a = [this.body, this.win], body = _a[0], win = _a[1];
        var mouse = document.createElement('div');
        mouse.style.cssText = "\n      display: none;\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 10001;\n      width: " + this.radius * 2 + "px;\n      height: " + this.radius * 2 + "px;\n      border: 1px solid red;\n      border-radius: 100%;\n    ";
        this.mouse = mouse;
        body.appendChild(mouse);
        var mouseMove = (function (e) {
            var _a = [e.pageX, e.pageY], x = _a[0], y = _a[1];
            var isOnCanvas = _this.isOnCanvas(x, y);
            mouse.style.transform = "translate(" + (x - _this.radius) + "px, " + (y - _this.radius) + "px)";
            if (!isOnCanvas) {
                mouse.style.display = 'none';
                body.style.cursor = 'default';
            }
            else {
                mouse.style.display = 'block';
                body.style.cursor = 'none';
            }
        }).bind(this);
        // change mouse style
        if (!this.isMobile) {
            win.addEventListener('mousemove', mouseMove, false);
            this._pushRegisteredEvents(win, 'mousemove', mouseMove);
        }
        else {
            win.addEventListener('touchmove', mouseMove, false);
            this._pushRegisteredEvents(win, 'touchmove', mouseMove);
        }
    };
    PhotoCover.prototype.setRadius = function (radius) {
        if (radius < 2 || radius > 100) {
            return;
        }
        var mouse = this.mouse;
        this.radius = radius;
        mouse.style.width = radius * 2 + 'px';
        mouse.style.height = radius * 2 + 'px';
    };
    PhotoCover.prototype.zoomIn = function (radius) {
        if (radius === void 0) { radius = 2; }
        this.setRadius(this.radius + radius);
    };
    PhotoCover.prototype.zoomOut = function (radius) {
        if (radius === void 0) { radius = 2; }
        this.setRadius(this.radius - radius);
    };
    PhotoCover.prototype.drawCircle = function (x, y, radius) {
        var ctx = this.ctx;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(x + 1, y + 1, radius || this.radius, 0, 360);
        ctx.fill();
        ctx.closePath();
    };
    PhotoCover.prototype.drawLine = function (x, y, radius) {
        var ctx = this.ctx;
        ctx.lineCap = this.linecap;
        ctx.lineJoin = 'round';
        ctx.strokeStyle = this.color;
        ctx.lineWidth = (radius || this.radius) * 2;
        ctx.lineTo(x, y);
        ctx.stroke();
    };
    PhotoCover.prototype.getCoordinateByEvent = function (event) {
        var x, y;
        var _a = [this.doc, this.body], doc = _a[0], body = _a[1];
        var canvas = this.canvas;
        if (this.isMobile) {
            event = event.changedTouches[0];
        }
        if (event.pageX || event.pageY) {
            x = event.pageX;
            y = event.pageY;
        }
        else {
            x = event.clientX + body.scrollLeft + doc.documentElement.scrollLeft;
            y = event.clientY + body.scrollTop + doc.documentElement.scrollTop;
        }
        x -= canvas.offsetLeft;
        y -= canvas.offsetTop;
        return [x, y];
    };
    PhotoCover.prototype.drawByEvent = function (event) {
        var ctx = this.ctx;
        var _a = this.getCoordinateByEvent(event), x = _a[0], y = _a[1];
        if (this.mouseType === DEFAULT_OPTIONS.PEN) {
            this.drawLine(x, y);
            return [DEFAULT_OPTIONS.PEN, this.color, x, y, this.radius];
        }
        else if (this.mouseType === DEFAULT_OPTIONS.ERASER) {
            x -= this.radius;
            y -= this.radius;
            var _b = [this.radius * 2, this.radius * 2], w = _b[0], h = _b[1];
            ctx.clearRect(x, y, w, h);
            return [DEFAULT_OPTIONS.ERASER, x, y, w, h];
        }
        else {
            return [];
        }
    };
    PhotoCover.prototype.isOnCanvas = function (x, y, isRelative) {
        if (isRelative === void 0) { isRelative = false; }
        var body = this.body;
        var scrollTop = body.scrollTop;
        if (isRelative) {
            if (x < 0 || x > this.width || y < 0 || y > this.height) {
                return false;
            }
            else {
                return true;
            }
        }
        else {
            if (x < this.left || x > (this.left + this.width) || y < (scrollTop + this.top) || y > (scrollTop + this.top + this.height)) {
                return false;
            }
            else {
                return true;
            }
        }
    };
    PhotoCover.prototype.setMaxWidth = function (width) {
        this.maxWidth = width;
    };
    PhotoCover.prototype.setColor = function (color) {
        this.color = color;
    };
    // pen, eraser
    PhotoCover.prototype.setTool = function (tool) {
        this.mouseType = tool;
        if (tool.toLowerCase() === DEFAULT_OPTIONS.PEN) {
            this.setPen();
        }
        else if (tool.toLowerCase() === DEFAULT_OPTIONS.ERASER) {
            this.setEraser();
        }
    };
    PhotoCover.prototype.setPen = function () {
        Object.assign(this.mouse.style, {
            borderRadius: '100%',
            border: "1px solid " + DEFAULT_OPTIONS.PEN_BORDER_COLOR
        });
        this.mouseType = DEFAULT_OPTIONS.PEN;
    };
    PhotoCover.prototype.setEraser = function () {
        Object.assign(this.mouse.style, {
            borderRadius: 0,
            border: "1px dashed " + DEFAULT_OPTIONS.ERASER_BORDER_COLOR
        });
        this.mouseType = DEFAULT_OPTIONS.ERASER;
    };
    PhotoCover.prototype.undo = function () {
        var _this = this;
        var ctx = this.ctx;
        var color = this.color;
        ctx.save();
        ctx.clearRect(0, 0, this.width, this.height);
        this.operateHistories.pop();
        this.operateHistories.map(function (steps) {
            steps.map(function (step) {
                if (step[0] === DEFAULT_OPTIONS.PEN) {
                    _this.color = step[1];
                    _this.drawLine(step[2], step[3], step[4]);
                }
                else if (step[0] === DEFAULT_OPTIONS.ERASER) {
                    ctx.clearRect.apply(ctx, step.slice(1));
                }
                else if (step[0] === 'MOVE_TO') {
                    ctx.beginPath();
                    ctx.moveTo.apply(ctx, step.slice(1));
                }
            });
        });
        console.log(this.operateHistories.length);
        this.color = color;
        ctx.restore();
    };
    /**
     * get image origin size
     * @param  {String}   src      iamge source url
     * @param  {Function} callback callback function, width as first parameter and height as second
     * @return {undefined}
     */
    PhotoCover.prototype.getImageOriginSize = function (src, callback) {
        var img = new Image();
        img.onload = function () {
            var width = img.width;
            var height = img.height;
            callback && callback(width, height);
        };
        img.src = src;
    };
    PhotoCover.prototype.getDataURL = function (type, quality, callback) {
        var _this = this;
        if (type === void 0) { type = 'image/jpeg'; }
        if (quality === void 0) { quality = 0.8; }
        var src = this.img.src;
        this.getImageOriginSize(src, function (width, height) {
            var tempCanvas = document.createElement('canvas');
            tempCanvas.width = width;
            tempCanvas.height = height;
            var tempCtx = tempCanvas.getContext('2d');
            if (tempCtx) {
                tempCtx.drawImage(_this.img, 0, 0, width, height);
                tempCtx.drawImage(_this.canvas, 0, 0, width, height);
                callback && callback(tempCanvas.toDataURL(type, quality));
            }
        });
    };
    /**
     * remove dom that added into body,
     * remove all events that registered
     * @return {undefined}
     */
    PhotoCover.prototype.destroy = function () {
        this.canvas.parentNode && this.canvas.parentNode.removeChild(this.canvas);
        this.mouse.parentNode && this.mouse.parentNode.removeChild(this.mouse);
        this.img.src = '';
        this.registeredEvents.forEach(function (v) {
            v.element.removeEventListener(v.event, v["function"], false);
        });
        // delete this
    };
    return PhotoCover;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFRLElBQUksUUFBUSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUE7WUFDM0QsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVEOzs7O09BSUc7SUFDSCw0QkFBTyxHQUFQO1FBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUN6RSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBRXRFLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQTtRQUVqQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQztZQUM3QixDQUFDLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLFVBQVEsQ0FBQSxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQzNELENBQUMsQ0FBQyxDQUFBO1FBQ0YsY0FBYztJQUNoQixDQUFDO0lBQ0gsaUJBQUM7QUFBRCxDQXRaQSxBQXNaQyxJQUFBIiwiZmlsZSI6InBob3RvY292ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBERUZBVUxUX09QVElPTlMgPSB7XHJcbiAgUkFESVVTOiAyMCxcclxuICBNQVhfV0lEVEg6IDgwMCxcclxuICBDT0xPUjogJ2JsYWNrJyxcclxuICBNT1VTRTogJ3BlbicsXHJcbiAgUEVOX0JPUkRFUl9DT0xPUjogJ3JlZCcsXHJcbiAgRVJBU0VSX0JPUkRFUl9DT0xPUjogJyM2NjYnLFxyXG4gIFBFTjogJ3BlbicsXHJcbiAgRVJBU0VSOiAnZXJhc2VyJyxcclxuICBMSU5FQ0FQOiAncm91bmQnXHJcbn1cclxuXHJcbmNsYXNzIFBob3RvQ292ZXIge1xyXG4gIHdpbjogV2luZG93ID0gd2luZG93XHJcbiAgZG9jOiBIVE1MRG9jdW1lbnQgPSBkb2N1bWVudFxyXG4gIGJvZHk6IEhUTUxFbGVtZW50ID0gZG9jdW1lbnQuYm9keVxyXG5cclxuICBtb3VzZTogSFRNTERpdkVsZW1lbnQgXHJcbiAgd2lkdGg6IG51bWJlciAvLyB3aWR0aCBvZiBjYW52YXMgYW5kIGltYWdlXHJcbiAgaGVpZ2h0OiBudW1iZXIgLy8gaGVpZ2h0IG9mIGNhbnZhcyBhbmQgaW1hZ2VcclxuICBsZWZ0OiBudW1iZXIgIC8vIFxyXG4gIHRvcDogbnVtYmVyIFxyXG4gIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxyXG4gIGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKSBhcyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkRcclxuXHJcbiAgcmFkaXVzID0gREVGQVVMVF9PUFRJT05TLlJBRElVUyAgIC8vIHJhZGl1cyBvZiBlYWNoIGNpcmNsZSBvZiBsaW5lXHJcbiAgbWF4V2lkdGggPSBERUZBVUxUX09QVElPTlMuTUFYX1dJRFRIXHJcbiAgY29sb3IgPSBERUZBVUxUX09QVElPTlMuQ09MT1IgLy8gZHJhdyBjb2xvclxyXG4gIGxpbmVjYXA9IERFRkFVTFRfT1BUSU9OUy5MSU5FQ0FQIC8vIFxyXG4gIG1vdXNlVHlwZSA9IERFRkFVTFRfT1BUSU9OUy5NT1VTRVxyXG4gIHJlYWRvbmx5IGlzTW9iaWxlID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdpUGhvbmUnKSA+IC0xIHx8IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQW5kcm9pZCcpID4gLTFcclxuICBvcGVyYXRlSGlzdG9yaWVzOiBBcnJheTxBcnJheTxhbnk+PiA9IFtdXHJcbiAgaW1nOiBIVE1MSW1hZ2VFbGVtZW50IFxyXG5cclxuICByZWdpc3RlcmVkRXZlbnRzOiBBcnJheTxhbnk+ID0gW11cclxuXHJcbiAgY29uc3RydWN0b3Ioc2VsZWN0b3I6IEhUTUxJbWFnZUVsZW1lbnQgfCBzdHJpbmcpIHtcclxuXHJcbiAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnb2JqZWN0JykgeyB0aGlzLmltZyA9IHNlbGVjdG9yIH1cclxuICAgIGVsc2UgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHsgdGhpcy5pbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSBhcyBIVE1MSW1hZ2VFbGVtZW50IH1cclxuICAgIFxyXG4gICAgLy8gaW5pdGlhbCBjYW52YXMgYW5kIGl0cyBzaXplIGFuZCBwb3NpdGlvblxyXG4gICAgdGhpcy53aWR0aCA9IHRoaXMuaW1nLndpZHRoXHJcbiAgICB0aGlzLmhlaWdodCA9IHRoaXMuaW1nLmhlaWdodFxyXG5cclxuICAgIHRoaXMuX2luaXQoKVxyXG4gIH1cclxuXHJcbiAgX2luaXQoKTogdm9pZCB7XHJcblxyXG4gICAgbGV0IFtib2R5LCB3aW4sIGltZ10gPSBbdGhpcy5ib2R5LCB0aGlzLndpbiwgdGhpcy5pbWddXHJcblxyXG4gICAgdGhpcy5fYXN5bmMoKVxyXG5cclxuICAgIHRoaXMuY2FudmFzLndpZHRoID0gaW1nLndpZHRoXHJcbiAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSBpbWcuaGVpZ2h0XHJcblxyXG4gICAgYm9keS5hcHBlbmRDaGlsZCh0aGlzLmNhbnZhcylcclxuXHJcbiAgICBpZiAoIXRoaXMuaXNNb2JpbGUpIHsgdGhpcy5faW5pdE1vdXNlKCkgfVxyXG5cclxuICAgIC8vIGFzeW5jIGNhbnZhcyBwb3NpdGlvbiBhbmQgc2l6ZSBkdXJpbmcgYnJvd3NlciByZXNpemVcclxuICAgIGxldCByZXNpemUgPSAoKGU6IGFueSkgPT4ge1xyXG4gICAgICB0aGlzLl9hc3luYygpXHJcbiAgICB9KS5iaW5kKHRoaXMpXHJcbiAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgcmVzaXplLCBmYWxzZSlcclxuICAgIHRoaXMuX3B1c2hSZWdpc3RlcmVkRXZlbnRzKHdpbiwgJ3Jlc2l6ZScsIHJlc2l6ZSlcclxuXHJcblxyXG4gICAgbGV0IGN1cnJlbnRPcGVyYXRlOiBBcnJheTxBcnJheTxhbnk+PiA9IFtdXHJcblxyXG4gICAgbGV0IGNhbnZhc01vdXNlRG93biA9ICgoZTogYW55KSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxyXG5cclxuICAgICAgY29uc3QgW3gsIHldID0gdGhpcy5nZXRDb29yZGluYXRlQnlFdmVudChlKVxyXG4gICAgICB0aGlzLmN0eC5tb3ZlVG8oeCwgeSlcclxuXHJcbiAgICAgIGN1cnJlbnRPcGVyYXRlID0gW11cclxuXHJcbiAgICAgIGlmICh0aGlzLmlzT25DYW52YXMoeCwgeSwgdHJ1ZSkpIHtcclxuXHJcbiAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKClcclxuICAgICAgICBjdXJyZW50T3BlcmF0ZS5wdXNoKFsnTU9WRV9UTycsIHgsIHldKVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMuaXNNb2JpbGUpIHsgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGNhbnZhc01vdXNlTW92ZSwgZmFsc2UpIH1cclxuICAgICAgICBlbHNlIHsgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGNhbnZhc01vdXNlTW92ZSwgZmFsc2UpIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgIH0pLmJpbmQodGhpcylcclxuXHJcbiAgICBsZXQgY2FudmFzTW91c2VNb3ZlID0gKChlOiBhbnkpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXHJcbiAgICAgIGN1cnJlbnRPcGVyYXRlLnB1c2godGhpcy5kcmF3QnlFdmVudChlKSlcclxuICAgIH0pLmJpbmQodGhpcylcclxuXHJcbiAgICBsZXQgY2FudmFzTW91c2VVcCA9ICgoZTogYW55KSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxyXG5cclxuICAgICAgaWYgKCF0aGlzLmlzTW9iaWxlKSB7IHdpbi5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBjYW52YXNNb3VzZU1vdmUsIGZhbHNlKSB9XHJcbiAgICAgIGVsc2UgeyB3aW4ucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgY2FudmFzTW91c2VNb3ZlLCBmYWxzZSkgfVxyXG4gICAgICBcclxuICAgICAgbGV0IGNvb3JkaW5hdGUgPSB0aGlzLmdldENvb3JkaW5hdGVCeUV2ZW50KGUpXHJcbiAgICAgIGxldCBbeCwgeV0gPSBbZS5wYWdlWCwgZS5wYWdlWV1cclxuXHJcbiAgICAgIGlmICh0aGlzLmlzT25DYW52YXMoeCwgeSkpIHtcclxuICAgICAgICB0aGlzLm9wZXJhdGVIaXN0b3JpZXMucHVzaChjdXJyZW50T3BlcmF0ZSlcclxuICAgICAgICBjdXJyZW50T3BlcmF0ZSA9IFtdXHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5vcGVyYXRlSGlzdG9yaWVzKVxyXG4gICAgICB9XHJcbiAgICB9KS5iaW5kKHRoaXMpXHJcblxyXG4gICAgLy8gY2FudmFzIGRvd25cclxuICAgIGlmICghdGhpcy5pc01vYmlsZSkge1xyXG4gICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgY2FudmFzTW91c2VEb3duLCBmYWxzZSlcclxuICAgICAgdGhpcy5fcHVzaFJlZ2lzdGVyZWRFdmVudHMod2luLCAnbW91c2Vkb3duJywgY2FudmFzTW91c2VEb3duKVxyXG5cclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBjYW52YXNNb3VzZVVwLCBmYWxzZSlcclxuICAgICAgdGhpcy5fcHVzaFJlZ2lzdGVyZWRFdmVudHMod2luLCAnbW91c2V1cCcsIGNhbnZhc01vdXNlVXApIFxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBjYW52YXNNb3VzZURvd24sIGZhbHNlKVxyXG4gICAgICB0aGlzLl9wdXNoUmVnaXN0ZXJlZEV2ZW50cyh3aW4sICd0b3VjaHN0YXJ0JywgY2FudmFzTW91c2VEb3duKVxyXG5cclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgY2FudmFzTW91c2VVcCwgZmFsc2UpXHJcbiAgICAgIHRoaXMuX3B1c2hSZWdpc3RlcmVkRXZlbnRzKHdpbiwgJ3RvdWNoZW5kJywgY2FudmFzTW91c2VVcClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIGFzeW5jIHggYW5kIHkgZnJvbSBpbWFnZSB0byBjYW52YXNcclxuICBfYXN5bmMoKSB7XHJcbiAgICBsZXQgY29vcmRpbmF0ZSA9IHRoaXMuaW1nLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXHJcbiAgICB0aGlzLnRvcCA9IGNvb3JkaW5hdGUudG9wXHJcbiAgICB0aGlzLmxlZnQgPSBjb29yZGluYXRlLmxlZnRcclxuXHJcbiAgICB0aGlzLmNhbnZhcy5zdHlsZS5jc3NUZXh0ID0gYFxyXG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XHJcbiAgICAgIGxlZnQ6ICR7dGhpcy5sZWZ0ICsgdGhpcy5ib2R5LnNjcm9sbExlZnR9cHg7XHJcbiAgICAgIHRvcDogJHt0aGlzLnRvcCArIHRoaXMuYm9keS5zY3JvbGxUb3B9cHg7XHJcbiAgICAgIHVzZS1zZWxlY3Q6IG5vbmU7XHJcbiAgICBgXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBzYXZlIGJpbmRzIGV2ZW50c1xyXG4gICAqIEBwYXJhbSAge0RPTX0gX2VsZW1lbnQgIERPTSB0aGF0IHlvdSBiaW5kIGV2ZW50XHJcbiAgICogQHBhcmFtICB7U3RyaW5nfSBfZXZlbnQgIGV2ZW50IG5hbWVcclxuICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gX2Z1bmN0aW9uIGV2ZW50IGZ1bmN0aW9uXHJcbiAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSB3aGVuIHNhdmUgc3VjY2Vzc1xyXG4gICAqL1xyXG4gIF9wdXNoUmVnaXN0ZXJlZEV2ZW50cyhfZWxlbWVudDogV2luZG93IHwgTm9kZSwgX2V2ZW50OiBhbnksIF9mdW5jdGlvbjogRnVuY3Rpb24pIHtcclxuXHJcbiAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMucHVzaCh7XHJcbiAgICAgICdlbGVtZW50JzogX2VsZW1lbnQsXHJcbiAgICAgICdldmVudCc6IF9ldmVudCxcclxuICAgICAgJ2Z1bmN0aW9uJzogX2Z1bmN0aW9uXHJcbiAgICB9KVxyXG5cclxuICAgIHJldHVybiB0cnVlXHJcblxyXG4gIH1cclxuXHJcbiAgLy8gaW5pdGlhbCBtb3VzZSBzaGFwZSB3aGVyZSBtb3VzZSBvbiBjYW52YXNcclxuICBfaW5pdE1vdXNlKHR5cGU/OiBzdHJpbmcpIHtcclxuICAgIGxldCBbYm9keSwgd2luXSA9IFt0aGlzLmJvZHksIHRoaXMud2luXVxyXG4gICAgbGV0IG1vdXNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuICAgIG1vdXNlLnN0eWxlLmNzc1RleHQgPSBgXHJcbiAgICAgIGRpc3BsYXk6IG5vbmU7XHJcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICAgICAgbGVmdDogMDtcclxuICAgICAgdG9wOiAwO1xyXG4gICAgICB6LWluZGV4OiAxMDAwMTtcclxuICAgICAgd2lkdGg6ICR7dGhpcy5yYWRpdXMgKiAyfXB4O1xyXG4gICAgICBoZWlnaHQ6ICR7dGhpcy5yYWRpdXMgKiAyfXB4O1xyXG4gICAgICBib3JkZXI6IDFweCBzb2xpZCByZWQ7XHJcbiAgICAgIGJvcmRlci1yYWRpdXM6IDEwMCU7XHJcbiAgICBgXHJcbiAgICB0aGlzLm1vdXNlID0gbW91c2VcclxuXHJcbiAgICBib2R5LmFwcGVuZENoaWxkKG1vdXNlKVxyXG5cclxuICAgIGxldCBtb3VzZU1vdmUgPSAoKGU6IGFueSkgPT4ge1xyXG4gICAgICBsZXQgW3gsIHldID0gW2UucGFnZVgsIGUucGFnZVldXHJcbiAgICAgIGxldCBpc09uQ2FudmFzID0gdGhpcy5pc09uQ2FudmFzKHgsIHkpXHJcblxyXG4gICAgICBtb3VzZS5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7eCAtIHRoaXMucmFkaXVzfXB4LCAke3kgLSB0aGlzLnJhZGl1c31weClgXHJcblxyXG4gICAgICBpZiAoIWlzT25DYW52YXMpIHtcclxuICAgICAgICBtb3VzZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnXHJcbiAgICAgICAgYm9keS5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCdcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBtb3VzZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJ1xyXG4gICAgICAgIGJvZHkuc3R5bGUuY3Vyc29yID0gJ25vbmUnXHJcbiAgICAgIH1cclxuICAgIH0pLmJpbmQodGhpcylcclxuXHJcbiAgICAvLyBjaGFuZ2UgbW91c2Ugc3R5bGVcclxuICAgIGlmICghdGhpcy5pc01vYmlsZSkge1xyXG4gICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgbW91c2VNb3ZlLCBmYWxzZSlcclxuICAgICAgdGhpcy5fcHVzaFJlZ2lzdGVyZWRFdmVudHMod2luLCAnbW91c2Vtb3ZlJywgbW91c2VNb3ZlKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIG1vdXNlTW92ZSwgZmFsc2UpXHJcbiAgICAgIHRoaXMuX3B1c2hSZWdpc3RlcmVkRXZlbnRzKHdpbiwgJ3RvdWNobW92ZScsIG1vdXNlTW92ZSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldFJhZGl1cyhyYWRpdXM6IG51bWJlcikge1xyXG4gICAgaWYgKHJhZGl1cyA8IDIgfHwgcmFkaXVzID4gMTAwKSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIGxldCBtb3VzZSA9IHRoaXMubW91c2VcclxuICAgIHRoaXMucmFkaXVzID0gcmFkaXVzXHJcblxyXG4gICAgbW91c2Uuc3R5bGUud2lkdGggPSByYWRpdXMgKiAyICsgJ3B4J1xyXG4gICAgbW91c2Uuc3R5bGUuaGVpZ2h0ID0gcmFkaXVzICogMiArICdweCdcclxuICB9XHJcblxyXG4gIHpvb21JbihyYWRpdXMgPSAyKSB7XHJcbiAgICB0aGlzLnNldFJhZGl1cyh0aGlzLnJhZGl1cyArIHJhZGl1cylcclxuICB9XHJcblxyXG4gIHpvb21PdXQocmFkaXVzID0gMikge1xyXG4gICAgdGhpcy5zZXRSYWRpdXModGhpcy5yYWRpdXMgLSByYWRpdXMpXHJcbiAgfVxyXG5cclxuICBkcmF3Q2lyY2xlKHg6IG51bWJlciwgeTogbnVtYmVyLCByYWRpdXM/OiBudW1iZXIpIHtcclxuICAgIGxldCBjdHggPSB0aGlzLmN0eFxyXG4gICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29sb3I7XHJcbiAgICBjdHguYmVnaW5QYXRoKClcclxuICAgIGN0eC5hcmMoeCArIDEsIHkgKyAxLCByYWRpdXMgfHwgdGhpcy5yYWRpdXMsIDAsIDM2MClcclxuICAgIGN0eC5maWxsKClcclxuICAgIGN0eC5jbG9zZVBhdGgoKVxyXG4gIH1cclxuXHJcbiAgZHJhd0xpbmUoeDogbnVtYmVyLCB5OiBudW1iZXIsIHJhZGl1cz86IG51bWJlcikge1xyXG4gICAgY29uc3QgY3R4ID0gdGhpcy5jdHhcclxuXHJcbiAgICBjdHgubGluZUNhcCA9IHRoaXMubGluZWNhcFxyXG4gICAgY3R4LmxpbmVKb2luID0gJ3JvdW5kJ1xyXG4gICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5jb2xvclxyXG4gICAgY3R4LmxpbmVXaWR0aCA9IChyYWRpdXMgfHwgdGhpcy5yYWRpdXMpICogMlxyXG4gICAgY3R4LmxpbmVUbyh4LCB5KVxyXG4gICAgY3R4LnN0cm9rZSgpXHJcbiAgfVxyXG5cclxuXHJcbiAgZ2V0Q29vcmRpbmF0ZUJ5RXZlbnQoZXZlbnQ6IGFueSkge1xyXG4gICAgbGV0IHgsIHlcclxuICAgIGxldCBbZG9jLCBib2R5XSA9IFt0aGlzLmRvYywgdGhpcy5ib2R5XVxyXG4gICAgbGV0IGNhbnZhcyA9IHRoaXMuY2FudmFzXHJcblxyXG4gICAgaWYgKHRoaXMuaXNNb2JpbGUpIHsgZXZlbnQgPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXSB9XHJcblxyXG4gICAgaWYgKGV2ZW50LnBhZ2VYIHx8IGV2ZW50LnBhZ2VZKSB7XHJcbiAgICAgIHggPSBldmVudC5wYWdlWFxyXG4gICAgICB5ID0gZXZlbnQucGFnZVlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHggPSBldmVudC5jbGllbnRYICsgYm9keS5zY3JvbGxMZWZ0ICsgZG9jLmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0XHJcbiAgICAgIHkgPSBldmVudC5jbGllbnRZICsgYm9keS5zY3JvbGxUb3AgKyBkb2MuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcFxyXG4gICAgfVxyXG5cclxuICAgIHggLT0gY2FudmFzLm9mZnNldExlZnRcclxuICAgIHkgLT0gY2FudmFzLm9mZnNldFRvcFxyXG5cclxuICAgIHJldHVybiBbeCwgeV1cclxuICB9XHJcblxyXG4gIGRyYXdCeUV2ZW50KGV2ZW50OiBhbnkpOiBBcnJheTxhbnk+IHtcclxuICAgIGxldCBjdHggPSB0aGlzLmN0eFxyXG4gICAgbGV0IFt4LCB5XSA9IHRoaXMuZ2V0Q29vcmRpbmF0ZUJ5RXZlbnQoZXZlbnQpXHJcblxyXG4gICAgaWYgKHRoaXMubW91c2VUeXBlID09PSBERUZBVUxUX09QVElPTlMuUEVOKSB7XHJcbiAgICAgIHRoaXMuZHJhd0xpbmUoeCwgeSlcclxuICAgICAgcmV0dXJuIFtERUZBVUxUX09QVElPTlMuUEVOLCB0aGlzLmNvbG9yLCB4LCB5LCB0aGlzLnJhZGl1c11cclxuICAgIH0gZWxzZSBpZiAodGhpcy5tb3VzZVR5cGUgPT09IERFRkFVTFRfT1BUSU9OUy5FUkFTRVIpIHtcclxuICAgICAgeCAtPSB0aGlzLnJhZGl1c1xyXG4gICAgICB5IC09IHRoaXMucmFkaXVzXHJcbiAgICAgIGxldCBbdywgaF0gPSBbdGhpcy5yYWRpdXMgKiAyLCB0aGlzLnJhZGl1cyAqIDJdXHJcbiAgICAgIGN0eC5jbGVhclJlY3QoeCwgeSwgdywgaClcclxuICAgICAgcmV0dXJuIFtERUZBVUxUX09QVElPTlMuRVJBU0VSLCB4LCB5LCB3LCBoXVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIFtdXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpc09uQ2FudmFzKHg6IG51bWJlciwgeTogbnVtYmVyLCBpc1JlbGF0aXZlOmJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgbGV0IGJvZHkgPSB0aGlzLmJvZHlcclxuICAgIGxldCBzY3JvbGxUb3AgPSBib2R5LnNjcm9sbFRvcFxyXG5cclxuICAgIGlmIChpc1JlbGF0aXZlKSB7XHJcbiAgICAgIGlmICh4IDwgMCB8fCB4ID4gdGhpcy53aWR0aCB8fCB5IDwgMCB8fCB5ID4gdGhpcy5oZWlnaHQpIHsgcmV0dXJuIGZhbHNlIH1cclxuICAgICAgZWxzZSB7IHJldHVybiB0cnVlIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICh4IDwgdGhpcy5sZWZ0IHx8IHggPiAodGhpcy5sZWZ0ICsgdGhpcy53aWR0aCkgfHwgeSA8IChzY3JvbGxUb3AgKyB0aGlzLnRvcCkgfHwgeSA+IChzY3JvbGxUb3AgKyB0aGlzLnRvcCArIHRoaXMuaGVpZ2h0KSkgeyByZXR1cm4gZmFsc2UgfVxyXG4gICAgICBlbHNlIHsgcmV0dXJuIHRydWUgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0TWF4V2lkdGgod2lkdGg6IG51bWJlcikge1xyXG4gICAgdGhpcy5tYXhXaWR0aCA9IHdpZHRoXHJcbiAgfVxyXG5cclxuICBzZXRDb2xvcihjb2xvcjogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmNvbG9yID0gY29sb3JcclxuICB9XHJcblxyXG4gIC8vIHBlbiwgZXJhc2VyXHJcbiAgc2V0VG9vbCh0b29sOiBzdHJpbmcpIHtcclxuICAgIHRoaXMubW91c2VUeXBlID0gdG9vbFxyXG5cclxuICAgIGlmICh0b29sLnRvTG93ZXJDYXNlKCkgPT09IERFRkFVTFRfT1BUSU9OUy5QRU4pIHtcclxuICAgICAgdGhpcy5zZXRQZW4oKVxyXG4gICAgfSBlbHNlIGlmICh0b29sLnRvTG93ZXJDYXNlKCkgPT09IERFRkFVTFRfT1BUSU9OUy5FUkFTRVIpIHtcclxuICAgICAgdGhpcy5zZXRFcmFzZXIoKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIHNldFBlbigpIHtcclxuICAgIChPYmplY3QgYXMgYW55KS5hc3NpZ24odGhpcy5tb3VzZS5zdHlsZSwge1xyXG4gICAgICBib3JkZXJSYWRpdXM6ICcxMDAlJyxcclxuICAgICAgYm9yZGVyOiBgMXB4IHNvbGlkICR7REVGQVVMVF9PUFRJT05TLlBFTl9CT1JERVJfQ09MT1J9YFxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLm1vdXNlVHlwZSA9IERFRkFVTFRfT1BUSU9OUy5QRU5cclxuICB9XHJcblxyXG4gIHNldEVyYXNlcigpIHtcclxuICAgIChPYmplY3QgYXMgYW55KS5hc3NpZ24odGhpcy5tb3VzZS5zdHlsZSwge1xyXG4gICAgICBib3JkZXJSYWRpdXM6IDAsXHJcbiAgICAgIGJvcmRlcjogYDFweCBkYXNoZWQgJHtERUZBVUxUX09QVElPTlMuRVJBU0VSX0JPUkRFUl9DT0xPUn1gXHJcbiAgICB9KVxyXG5cclxuICAgIHRoaXMubW91c2VUeXBlID0gREVGQVVMVF9PUFRJT05TLkVSQVNFUlxyXG4gIH1cclxuXHJcbiAgdW5kbygpIHtcclxuICAgIGxldCBjdHggPSB0aGlzLmN0eFxyXG4gICAgbGV0IGNvbG9yID0gdGhpcy5jb2xvclxyXG5cclxuICAgIGN0eC5zYXZlKClcclxuXHJcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KVxyXG4gICAgdGhpcy5vcGVyYXRlSGlzdG9yaWVzLnBvcCgpXHJcblxyXG4gICAgdGhpcy5vcGVyYXRlSGlzdG9yaWVzLm1hcCgoc3RlcHM6IEFycmF5PGFueT4pID0+IHtcclxuICAgICAgc3RlcHMubWFwKChzdGVwOiBBcnJheTxhbnk+KSA9PiB7XHJcbiAgICAgICAgaWYgKHN0ZXBbMF0gPT09IERFRkFVTFRfT1BUSU9OUy5QRU4pIHtcclxuICAgICAgICAgIHRoaXMuY29sb3IgPSBzdGVwWzFdXHJcbiAgICAgICAgICB0aGlzLmRyYXdMaW5lKHN0ZXBbMl0sIHN0ZXBbM10sIHN0ZXBbNF0pXHJcbiAgICAgICAgfSBlbHNlIGlmIChzdGVwWzBdID09PSBERUZBVUxUX09QVElPTlMuRVJBU0VSKSB7XHJcbiAgICAgICAgICBjdHguY2xlYXJSZWN0LmFwcGx5KGN0eCwgc3RlcC5zbGljZSgxKSlcclxuICAgICAgICB9IGVsc2UgaWYgKHN0ZXBbMF0gPT09ICdNT1ZFX1RPJykge1xyXG4gICAgICAgICAgY3R4LmJlZ2luUGF0aCgpXHJcbiAgICAgICAgICBjdHgubW92ZVRvLmFwcGx5KGN0eCwgc3RlcC5zbGljZSgxKSlcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG5cclxuICAgIGNvbnNvbGUubG9nKHRoaXMub3BlcmF0ZUhpc3Rvcmllcy5sZW5ndGgpXHJcblxyXG4gICAgdGhpcy5jb2xvciA9IGNvbG9yXHJcbiAgICBjdHgucmVzdG9yZSgpXHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogZ2V0IGltYWdlIG9yaWdpbiBzaXplXHJcbiAgICogQHBhcmFtICB7U3RyaW5nfSAgIHNyYyAgICAgIGlhbWdlIHNvdXJjZSB1cmxcclxuICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2FsbGJhY2sgY2FsbGJhY2sgZnVuY3Rpb24sIHdpZHRoIGFzIGZpcnN0IHBhcmFtZXRlciBhbmQgaGVpZ2h0IGFzIHNlY29uZFxyXG4gICAqIEByZXR1cm4ge3VuZGVmaW5lZH1cclxuICAgKi9cclxuICBnZXRJbWFnZU9yaWdpblNpemUoc3JjOiBzdHJpbmcsIGNhbGxiYWNrPzogRnVuY3Rpb24pIHtcclxuICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKVxyXG5cclxuICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgIGxldCB3aWR0aCA9IGltZy53aWR0aFxyXG4gICAgICBsZXQgaGVpZ2h0ID0gaW1nLmhlaWdodFxyXG5cclxuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sod2lkdGgsIGhlaWdodClcclxuICAgIH1cclxuXHJcbiAgICBpbWcuc3JjID0gc3JjXHJcbiAgfVxyXG5cclxuICBnZXREYXRhVVJMKHR5cGUgPSAnaW1hZ2UvanBlZycsIHF1YWxpdHkgPSAwLjgsIGNhbGxiYWNrPzogRnVuY3Rpb24pIHtcclxuXHJcbiAgICBsZXQgc3JjID0gdGhpcy5pbWcuc3JjXHJcblxyXG4gICAgdGhpcy5nZXRJbWFnZU9yaWdpblNpemUoc3JjLCAod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpID0+IHtcclxuICAgICAgbGV0IHRlbXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxyXG4gICAgICB0ZW1wQ2FudmFzLndpZHRoID0gd2lkdGhcclxuICAgICAgdGVtcENhbnZhcy5oZWlnaHQgPSBoZWlnaHRcclxuICAgICAgbGV0IHRlbXBDdHggPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJylcclxuICAgICAgaWYgKHRlbXBDdHgpIHtcclxuICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZSh0aGlzLmltZywgMCwgMCwgd2lkdGgsIGhlaWdodClcclxuICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZSh0aGlzLmNhbnZhcywgMCwgMCwgd2lkdGgsIGhlaWdodClcclxuXHJcbiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sodGVtcENhbnZhcy50b0RhdGFVUkwodHlwZSwgcXVhbGl0eSkpXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiByZW1vdmUgZG9tIHRoYXQgYWRkZWQgaW50byBib2R5LFxyXG4gICAqIHJlbW92ZSBhbGwgZXZlbnRzIHRoYXQgcmVnaXN0ZXJlZFxyXG4gICAqIEByZXR1cm4ge3VuZGVmaW5lZH1cclxuICAgKi9cclxuICBkZXN0cm95KCkge1xyXG4gICAgdGhpcy5jYW52YXMucGFyZW50Tm9kZSAmJiB0aGlzLmNhbnZhcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuY2FudmFzKVxyXG4gICAgdGhpcy5tb3VzZS5wYXJlbnROb2RlICYmIHRoaXMubW91c2UucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLm1vdXNlKVxyXG5cclxuICAgIHRoaXMuaW1nLnNyYyA9ICcnXHJcblxyXG4gICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzLmZvckVhY2godiA9PiB7XHJcbiAgICAgIHYuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKHYuZXZlbnQsIHYuZnVuY3Rpb24sIGZhbHNlKVxyXG4gICAgfSlcclxuICAgIC8vIGRlbGV0ZSB0aGlzXHJcbiAgfVxyXG59XHJcbiJdfQ==
