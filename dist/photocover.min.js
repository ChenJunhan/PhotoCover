var MouseType;!function(t){t[t.PEN=0]="PEN",t[t.ERASER=1]="ERASER"}(MouseType||(MouseType={}));var PhotoCover=function(){function t(e){this.isMobile=navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("Android")>-1,this.win=window,this.doc=document,this.body=document.body,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.mouseType=MouseType.PEN,this.radius=t.DEFAULT_RADIUS,this.maxWidth=t.DEFAULT_MAX_WIDTH,this.color=t.DEFAULT_COLOR,this.lineCap=t.DEFAULT_LINECAP,this.lineJoin=t.DEFAULT_LINEJOIN,this.histories=[],this.bindedEvents=[],"object"==typeof e?this.img=e:"string"==typeof e&&(this.img=document.querySelector(e)),this.width=this.img.width,this.height=this.img.height,this.canvas.width=this.img.width,this.canvas.height=this.img.height,this.init()}return t.prototype.init=function(){var t=this,e=[this.body,this.win],i=e[0],s=e[1];this.async(),i.appendChild(this.canvas),this.isMobile||this.initMouse();var o=function(){t.async()}.bind(this);s.addEventListener("resize",o,!1),this.bindedEvents.push([s,"resize",o]);var n=[],h=function(e){e.preventDefault();var i=t.getCoordinateByEvent(e),o=i[0],h=i[1];n=[],t.isOnCanvas(o,h,!0)&&(t.ctx.beginPath(),n.push(["MOVE_TO",o,h]),n.push(t.drawByEvent(e)),t.ctx.beginPath(),n.push(["MOVE_TO",o,h]),t.isMobile?s.addEventListener("touchmove",r,!1):s.addEventListener("mousemove",r,!1))}.bind(this),r=function(e){e.preventDefault(),n.push(t.drawByEvent(e))}.bind(this),a=function(e){e.preventDefault(),t.isMobile?s.removeEventListener("touchmove",r,!1):s.removeEventListener("mousemove",r,!1);var i=[e.pageX,e.pageY],o=i[0],h=i[1];t.isOnCanvas(o,h)&&(t.histories.push(n),n=[])}.bind(this);this.isMobile?(s.addEventListener("touchstart",h,!1),this.bindedEvents.push([s,"touchstart",h]),s.addEventListener("touchend",a,!1),this.bindedEvents.push([s,"touchend",a])):(s.addEventListener("mousedown",h,!1),this.bindedEvents.push([s,"mousedown",h]),s.addEventListener("mouseup",a,!1),this.bindedEvents.push([s,"mouseup",a]))},t.prototype.async=function(){var t=this.img.getBoundingClientRect();this.top=t.top,this.left=t.left,this.canvas.style.cssText="\n      position: absolute;\n      left: "+(this.left+this.body.scrollLeft)+"px;\n      top: "+(this.top+this.body.scrollTop)+"px;\n      use-select: none;\n    "},t.prototype.initMouse=function(){var t=this,e=[this.body,this.win],i=e[0],s=e[1],o=document.createElement("div");o.style.cssText="\n      display: none;\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 10001;\n      width: "+2*this.radius+"px;\n      height: "+2*this.radius+"px;\n      border: 1px solid red;\n      border-radius: 100%;\n    ",this.mouse=o,i.appendChild(o);var n=function(e){var s=[e.pageX,e.pageY],n=s[0],h=s[1],r=t.isOnCanvas(n,h);o.style.transform="translate("+(n-t.radius-1)+"px, "+(h-t.radius-1)+"px)",r?(o.style.display="block",i.style.cursor="none"):(o.style.display="none",i.style.cursor="default")}.bind(this);this.isMobile?(s.addEventListener("touchmove",n,!1),this.bindedEvents.push([s,"touchmove",n])):(s.addEventListener("mousemove",n,!1),this.bindedEvents.push([s,"mousemove",n]))},t.prototype.setRadius=function(t){if(!(t<2||t>100)){var e=this.mouse;this.radius=t,e.style.width=2*t+"px",e.style.height=2*t+"px"}},t.prototype.zoomIn=function(t){void 0===t&&(t=2),this.setRadius(this.radius+t)},t.prototype.zoomOut=function(t){void 0===t&&(t=2),this.setRadius(this.radius-t)},t.prototype.lineTo=function(t,e){var i=this.ctx;i.lineCap=this.lineCap,i.lineJoin="round",i.strokeStyle=this.color,i.lineWidth=2*this.radius,i.lineTo(t,e),i.stroke()},t.prototype.drawCircle=function(t,e,i){var s=this.ctx;return s.fillStyle=this.color,s.beginPath(),s.arc(t+1,e+1,i||this.radius,0,360),s.fill(),s.closePath(),[MouseType.PEN,this.color,t,e,this.radius]},t.prototype.drawLine=function(t,e){return this.ctx.globalCompositeOperation="source-over",this.lineCap="round",this.lineJoin="round",this.lineTo(t,e),[MouseType.PEN,this.color,t,e,this.radius]},t.prototype.erase=function(t,e){return this.ctx.globalCompositeOperation="destination-out",this.lineCap="round",this.lineJoin="round",this.lineTo(t,e),[MouseType.ERASER,t,e,this.radius]},t.prototype.drawByEvent=function(t){var e=this.getCoordinateByEvent(t),i=e[0],s=e[1];return this.mouseType===MouseType.PEN?this.drawLine(i,s):this.mouseType===MouseType.ERASER?this.erase(i,s):[]},t.prototype.getCoordinateByEvent=function(t){var e,i,s=[this.doc,this.body],o=s[0],n=s[1],h=this.canvas;return this.isMobile&&(t=t.changedTouches[0]),t.pageX||t.pageY?(e=t.pageX,i=t.pageY):(e=t.clientX+n.scrollLeft+o.documentElement.scrollLeft,i=t.clientY+n.scrollTop+o.documentElement.scrollTop),e-=h.offsetLeft,i-=h.offsetTop,[e,i]},t.prototype.isOnCanvas=function(t,e,i){void 0===i&&(i=!1);var s=this.body,o=s.scrollTop;return i?!(t<0||t>this.width||e<0||e>this.height):!(t<this.left||t>this.left+this.width||e<o+this.top||e>o+this.top+this.height)},t.prototype.setMaxWidth=function(t){this.maxWidth=t},t.prototype.setColor=function(t){this.color=t},t.prototype.setTool=function(t){this.mouseType=t,t===MouseType.PEN?this.setPen():t===MouseType.ERASER&&this.setEraser()},t.prototype.setPen=function(){Object.assign(this.mouse.style,{borderRadius:"100%",border:"1px solid "+t.DEFAULT_PEN_BORDER_COLOR}),this.mouseType=MouseType.PEN},t.prototype.setEraser=function(){Object.assign(this.mouse.style,{borderRadius:"100%",border:"1px dashed "+t.DEFAULT_ERASER_BORDER_COLOR}),this.mouseType=MouseType.ERASER},t.prototype.undo=function(){var t=this,e=this.ctx,i=this.color;e.save(),e.clearRect(0,0,this.width,this.height),this.histories.pop(),this.histories.map(function(i){i.map(function(i){i[0]===MouseType.PEN?(t.color=i[1],t.setRadius(i[4]),t.drawLine(i[2],i[3])):i[0]===MouseType.ERASER?(t.setRadius(i[3]),t.erase(i[1],i[2])):"MOVE_TO"===i[0]&&(e.beginPath(),e.moveTo.apply(e,i.slice(1)))})}),this.color=i,e.restore()},t.prototype.getImageOriginSize=function(t,e){var i=new Image;i.onload=function(){var t=i.width,s=i.height;e&&e(t,s)},i.src=t},t.prototype.getDataURL=function(t,e,i){var s=this;void 0===t&&(t="image/jpeg"),void 0===e&&(e=.8);var o=this.img.src;this.getImageOriginSize(o,function(o,n){var h=document.createElement("canvas");h.width=o,h.height=n;var r=h.getContext("2d");r&&(r.drawImage(s.img,0,0,o,n),r.drawImage(s.canvas,0,0,o,n),i&&i(h.toDataURL(t,e)))})},t.prototype.destroy=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.mouse.parentNode&&this.mouse.parentNode.removeChild(this.mouse),this.img.src="",this.bindedEvents.forEach(function(t){t[0].removeEventListener(t[1],t[2],!1)})},t.DEFAULT_RADIUS=20,t.DEFAULT_MAX_WIDTH=800,t.DEFAULT_COLOR="black",t.DEFAULT_PEN_BORDER_COLOR="red",t.DEFAULT_ERASER_BORDER_COLOR="#666",t.DEFAULT_LINECAP="round",t.DEFAULT_LINEJOIN="round",t}();